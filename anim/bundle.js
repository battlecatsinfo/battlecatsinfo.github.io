(()=>{"use strict";class t{static t=new t;i;canvas;h;position;o;l;u;m;p;matrix=new Float32Array(16);g;$;static v(t){let i=t.toString();switch(i.length){case 3:return i;case 2:return"0"+i;default:return"00"+i}}M(t,i,s,h,e,n){this.matrix[0]=2/(i-t),this.matrix[1]=0,this.matrix[2]=0,this.matrix[3]=0,this.matrix[4]=0,this.matrix[5]=2/(h-s),this.matrix[6]=0,this.matrix[7]=0,this.matrix[8]=0,this.matrix[9]=0,this.matrix[10]=2/(e-n),this.matrix[11]=0,this.matrix[12]=(t+i)/(t-i),this.matrix[13]=(s+h)/(s-h),this.matrix[14]=(e+n)/(e-n),this.matrix[15]=1}scale(t,i){this.matrix[0]*=t,this.matrix[1]*=t,this.matrix[2]*=t,this.matrix[3]*=t,this.matrix[4]*=i,this.matrix[5]*=i,this.matrix[6]*=i,this.matrix[7]*=i}translate(t,i){this.matrix[12]=this.matrix[0]*t+this.matrix[4]*i+this.matrix[8]+this.matrix[12],this.matrix[13]=this.matrix[1]*t+this.matrix[5]*i+this.matrix[9]+this.matrix[13],this.matrix[14]=this.matrix[2]*t+this.matrix[6]*i+this.matrix[10]+this.matrix[14],this.matrix[15]=this.matrix[3]*t+this.matrix[7]*i+this.matrix[11]+this.matrix[15]}}class i{static t=new i;_=new Float32Array(8);I;P;A;F=!1;C;L;k;B;S=0;D=0;R(){this.C=t.t.canvas.width,this.L=0,this.B=t.t.canvas.height,this.k=0,this.F=!0}T(){this.F=!1,this.C=Math.max(0,this.C-10),this.L=this.L+10,this.B=Math.max(0,this.B-10),this.k=this.k+10}W(t){switch(t){case 0:this.I=WebGL2RenderingContext.SRC_ALPHA,this.P=WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA;break;case 1:this.I=WebGL2RenderingContext.SRC_ALPHA,this.P=WebGL2RenderingContext.ONE;break;case 3:this.I=WebGL2RenderingContext.ZERO,this.P=WebGL2RenderingContext.SRC_COLOR;break;case 4:this.I=WebGL2RenderingContext.ONE_MINUS_DST_COLOR,this.P=WebGL2RenderingContext.ONE}}G(t){this.A=t}U(i,s,h,e,n,a,o,r,l,c,u,f,d){if(this.F)return this.C=Math.min(s,e,a,r,this.C),this.L=Math.max(s,e,a,r,this.L),this.B=Math.min(h,n,o,l,this.B),void(this.k=Math.max(h,n,o,l,this.k));const m=t.t.h;this._[0]=s-this.S,this._[1]=h-this.D,this._[2]=e-this.S,this._[3]=n-this.D,this._[4]=r-this.S,this._[5]=l-this.D,this._[6]=a-this.S,this._[7]=o-this.D,m.blendFunc(this.I,this.P),m.bindBuffer(m.ARRAY_BUFFER,t.t.o),m.bufferData(m.ARRAY_BUFFER,this._,m.STATIC_DRAW),this._[0]=c,this._[1]=u,this._[2]=c,this._[3]=u+d,this._[4]=c+f,this._[5]=u,this._[6]=c+f,this._[7]=u+d;for(let t=0;t<8;)this._[t++]/=i.N,this._[t++]/=i.X;m.bindBuffer(m.ARRAY_BUFFER,t.t.u),m.bufferData(m.ARRAY_BUFFER,this._,m.STATIC_DRAW),m.bindTexture(m.TEXTURE_2D,i.Y),m.drawArrays(m.TRIANGLE_STRIP,0,4)}H(){const i=t.t.h;i.clearColor(0,0,0,0),i.bindBuffer(i.ARRAY_BUFFER,t.t.o),i.vertexAttribPointer(t.t.position,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(t.t.position),i.bindBuffer(i.ARRAY_BUFFER,t.t.u),i.vertexAttribPointer(t.t.l,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(t.t.l),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE_MINUS_SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE),i.blendEquation(i.FUNC_ADD),this.W(0)}setAlpha(i){t.t.h.vertexAttrib1f(t.t.m,i)}O(){const i=t.t.h;i.clear(i.COLOR_BUFFER_BIT)}}class s{x;y;width;height}class h{a;b;q=0;V(t){return parseInt(this.b[t])}async K(t){const i=await fetch(t);if(!i.ok)throw"File not found";this.a=await i.text()}Z(t){return this.b[t]}j(){if(this.q>=this.a.length)return null;let t=this.q;if(this.q=this.a.indexOf("\n",t),-1==this.q)return this.q=this.a.length,this.a.slice(t);let i=this.a.slice(t,this.q++);return i.includes("\r")?i.replaceAll("\r",""):i}J(t=","){let i=this.j();return i&&(this.b=i.split(t)),this.b}c(){return this.a}close(){}}class e extends h{}class n{Y;tt;it;N;X;name;st;ht;et(){return this.tt}async drawImage(i,s){let h=i.width;this.tt=h;let e=i.height;this.it=e;let n=1;for(;n<h;)n*=2;this.N=n;let a=1;for(;a<e;)a*=2;this.X=a;const o=document.createElement("canvas"),r=o.getContext("2d");o.width=n,o.height=a,r.drawImage(i,0,0);const l=t.t.h;this.Y=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.Y),0!=(8&s)?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR)),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,o)}async load(t,i,h=0){if(this.reset(),this.ht=h,null!=i)if(0!=(1&h)){let t=new e;await t.K(i),t.j(),t.j(),t.j(),t.J();let s=t.V(0);this.st=new Array(s);for(let i=0;i<s;i++)t.J(),this.st[i].x=t.V(0),this.st[i].y=t.V(1),this.st[i].width=t.V(2),this.st[i].height=t.V(3);t.close()}else{let t=new e;await t.K(i),t.j(),t.j(),t.j(),t.J();let h=t.V(0);this.st=new Array(h);for(let i=0;i<h;i++)t.J(),this.st[i]=new s,this.st[i].x=t.V(0),this.st[i].y=t.V(1),this.st[i].width=t.V(2),this.st[i].height=t.V(3);t.close()}let n=await fetch(t),a=await n.blob();await this.drawImage(await createImageBitmap(a),h),0!=(2&h)?(this.tt=Math.floor(this.tt/2),this.it=Math.floor(this.it/2)):0!=(4&h)&&(this.tt*=2,this.it*=2)}nt(){return Boolean(this.Y)}reset(){this.Y&&(t.t.h.deleteTexture(this.Y),this.Y=null)}}class a{frame;ot;rt;lt}class o{ct;ut;loop;ft;dt;wt=0;max=0;gt(){let t=0;if(this.ft&&(this.dt[0].frame<0||-1!=this.loop)){this.wt=-this.dt[0].frame;for(let t=0;t<this.ft;++t)this.dt[t].frame+=this.wt}return this.ft&&(t=this.dt[0].frame,this.max=this.dt[this.ft-1].frame),-1!=this.loop?this.loop>1?t+(this.max-t)*this.loop:this.max-this.wt:this.max-Math.min(this.wt,0)}}class r{yt;$t;vt;a(){let t=0;for(let i=0;i<this.$t;i++){if(-1==this.yt[i].loop)return-1;let s=(this.yt[i].dt[this.yt[i].ft-1].frame-this.yt[i].dt[0].frame)*this.yt[i].loop+1;s>t&&(t=s)}}async load(t){let i=new e;this.vt=0,await i.K(t),i.j();let s=parseInt(i.j());i.J(),this.$t=i.V(0),this.yt=new Array(this.$t);for(let t=0;t<this.$t;t++){i.J();const h=new o;this.yt[t]=h,h.ct=i.V(0),h.ut=i.V(1),h.loop=i.V(2),i.J(),h.ft=i.V(0),h.dt=new Array(h.ft);for(let t=0;t<h.ft;t++)i.J(),h.dt[t]=new a,h.dt[t].frame=i.V(0),h.dt[t].ot=i.V(1),h.dt[t].rt=i.V(2),h.dt[t].lt=s>=1?i.V(3):0;let e=h.gt();e>this.vt&&(this.vt=e)}i.close()}b(){let t=0;for(let i=0;i<this.$t;i++){let s=this.yt[i].dt[this.yt[i].ft-1].frame-this.yt[i].dt[0].frame;s>t&&(t=s)}return t}}class l{matrix=new Float32Array(9);constructor(){this.xt()}xt(){this.matrix[0]=1,this.matrix[1]=0,this.matrix[2]=0,this.matrix[3]=0,this.matrix[4]=1,this.matrix[5]=0,this.matrix[6]=0,this.matrix[7]=0,this.matrix[8]=1}Mt(t,i){this.xt(),this.matrix[0]=Math.cos(2*t*Math.PI/i),this.matrix[1]=-Math.sin(2*t*Math.PI/i),this.matrix[3]=Math.sin(2*t*Math.PI/i),this.matrix[4]=Math.cos(2*t*Math.PI/i)}bt(t,i,s){s.x=Math.floor(this.matrix[0]*t+this.matrix[1]*i+this.matrix[2]),s.y=Math.floor(this.matrix[3]*t+this.matrix[4]*i+this.matrix[5])}_t(t){let i=this.matrix[0]*t.matrix[0]+this.matrix[1]*t.matrix[3]+this.matrix[2]*t.matrix[6],s=this.matrix[0]*t.matrix[1]+this.matrix[1]*t.matrix[4]+this.matrix[2]*t.matrix[7],h=this.matrix[0]*t.matrix[2]+this.matrix[1]*t.matrix[5]+this.matrix[2]*t.matrix[8],e=this.matrix[3]*t.matrix[0]+this.matrix[4]*t.matrix[3]+this.matrix[5]*t.matrix[6],n=this.matrix[3]*t.matrix[1]+this.matrix[4]*t.matrix[4]+this.matrix[5]*t.matrix[7],a=this.matrix[3]*t.matrix[2]+this.matrix[4]*t.matrix[5]+this.matrix[5]*t.matrix[8],o=this.matrix[6]*t.matrix[0]+this.matrix[7]*t.matrix[3]+this.matrix[8]*t.matrix[6],r=this.matrix[6]*t.matrix[1]+this.matrix[7]*t.matrix[4]+this.matrix[8]*t.matrix[7],l=this.matrix[6]*t.matrix[2]+this.matrix[7]*t.matrix[5]+this.matrix[8]*t.matrix[8];this.matrix[0]=i,this.matrix[1]=s,this.matrix[2]=h,this.matrix[3]=e,this.matrix[4]=n,this.matrix[5]=a,this.matrix[6]=o,this.matrix[7]=r,this.matrix[8]=l}b(t,i){this.xt(),this.matrix[2]=t,this.matrix[5]=i}}class c{x=0;y=0}class u{It;Pt;At;Ft;Ct;Lt;kt;Bt;St;Dt;Rt;Tt;Wt;Gt;Ut;Nt;Xt;Yt;Ht;Ot;qt;s;Vt;zt;Et;Kt;rotation;Zt;alpha;jt;Jt;E=new Int32Array(8);Qt=new c;a=new l;ti=new l;ii=new l;si(t){let i,s;if(this.Ct+this.Lt!=-1)i=Math.floor(this.qt*this.Vt*t.yt[this.Ct+this.Lt].s/t.hi/t.hi),this.s=Math.floor(this.qt*this.Vt*t.yt[this.Ct+this.Lt].s/t.hi/t.hi),s=Math.floor(this.zt*this.Kt*t.yt[this.Ct+this.Lt].Et/t.hi/t.hi),this.Et=Math.floor(this.zt*this.Kt*t.yt[this.Ct+this.Lt].Et/t.hi/t.hi),this.Pt=Math.floor(this.alpha*this.At*t.yt[this.Ct+this.Lt].It/t.ei/t.ei),this.It=Math.floor(this.alpha*this.At*t.yt[this.Ct+this.Lt].It/t.ei/t.ei);else{i=this.qt*this.Vt/t.hi,this.s=i,s=this.zt*this.Kt/t.hi,this.Et=s;let h=this.alpha*this.At/t.ei;this.It=h,this.Pt=h}if(this.kt+this.Bt!=-1){let h=this.E,e=this.E,n=-(this.Xt+this.Ht)*i/t.hi;e[2]=n,h[0]=n;let a=this.E,o=this.E,r=i*t.ni.st[this.St+this.Dt].width/t.hi+this.E[0];o[6]=r,a[4]=r;let l=this.E,c=this.E,u=-(this.Yt+this.Ot)*s/t.hi;c[7]=u,l[1]=u;let f=this.E,d=this.E,m=s*t.ni.st[this.St+this.Dt].height/t.hi+this.E[1];d[5]=m,f[3]=m}this.ti.Mt(this.rotation+this.Zt,t.ai),this.Ct+this.Lt!=-1?this.ii.b((this.Wt+this.Ut)*t.yt[this.Ct+this.Lt].s/t.hi,(this.Gt+this.Nt)*t.yt[this.Ct+this.Lt].Et/t.hi):this.ii.b(this.Ut,this.Nt),this.a.xt(),this.Ct+this.Lt!=-1&&this.a._t(t.yt[this.Ct+this.Lt].a),this.a._t(this.ii),this.a._t(this.ti);for(let t=0;t<4;t++)this.a.bt(this.E[2*t],this.E[2*t+1],this.Qt),this.E[2*t]=this.Qt.x,this.E[2*t+1]=this.Qt.y}oi(t,i,s,h){this.a.bt((i-this.Xt-this.Ht)*this.s/t.hi,(s-this.Yt-this.Ot)*this.Et/t.hi,h)}ri(t,i,s,h){if(this.kt<0||this.St<0)return;i.W(this.Ft),1==this.Ft?i.setAlpha(0):i.setAlpha(this.Pt/t.ei);const e=t.ni,n=e.st[this.Dt+this.St];i.U(e,this.E[0]+s,this.E[1]+h,this.E[2]+s,this.E[3]+h,this.E[4]+s,this.E[5]+h,this.E[6]+s,this.E[7]+h,n.x,n.y,n.width,n.height)}}class f{a;b;c;d;e;f;li;It(){return this.a}ci(){return this.d}ui(){return this.e}}class d{ni;yt;$t;fi;e;hi;ai;ei;di;mi;wi(t){return this.di[t]}pi(t){this.ni=t}gi(t,s){const h=i.t;for(let i=0;i<this.$t;i++)this.yt[this.fi[i]].ri(this,h,t,s)}yi(t,i,s){let h=i,e=i;for(let s=i-1;s>=0&&3==t[s].rt;s--)h=s;for(let s=i+1;s<t.length&&3==t[e=s].rt;s++);let n=0;for(let i=h;i<=e;i++){let a=4096*t[i].ot;for(let n=h;n<=e;n++)i!=n&&(a*=(s-t[n].frame)/(t[i].frame-t[n].frame));n+=a}return Math.floor(n/4096)}$i(t,i=0){let s;for(let t=0;t<this.$t;t++){let i=this.yt[t];i.jt=1,i.Jt=1,i.Lt=0,i.Bt=0,i.Dt=0,i.Nt=0,i.Ut=0,i.Ot=0,i.Ht=0,i.Kt=this.hi,i.Vt=this.hi,i.Zt=0,i.At=this.ei}if(t)for(let h=0;h<t.$t;h++){s=0;const e=t.yt[h];let n=e.dt[0].frame,a=e.max,o=-1;if(i>=n&&(o=i<a||n==a?i:-1==e.loop||e.loop>=1&&(i-n)/(a-n)<e.loop?(i-n)%(a-n):a),o>=0){if(n==a)s=e.dt[0].ot;else if(o==a)s=e.dt[e.ft-1].ot;else{let t=0;for(;t<e.ft-1;){const i=e.dt[t],h=e.dt[t+1],n=i.frame,a=h.frame,r=i.rt;if(!(o<n||o>=a)){if(0==r){s=(h.ot-i.ot)*(o-n)/(a-n)+i.ot;break}if(1==r){s=i.ot;break}if(2==r){s=Math.floor(i.lt>=0?(1-Math.sqrt(1-Math.pow((o-n)/(a-n),i.lt)))*(h.ot-i.ot)+i.ot:Math.sqrt(1-Math.pow(1-(o-n)/(a-n),-i.lt))*(h.ot-i.ot)+i.ot);break}if(3==r){s=this.yi(e.dt,t,o);break}if(4==r){const t=(o-n)/(a-n);s=i.lt>0?1-Math.cos(t*Math.PI/2):i.lt<0?Math.sin(t*Math.PI/2):(1-Math.cos(t*Math.PI))/2;break}throw"Unhandled ease type: "+r.toString()}t++}}s=~~s;const t=this.yt[e.ct];switch(e.ut){case 0:t.Lt=s-t.Ct;continue;case 1:t.Bt=s-t.kt;continue;case 2:t.Dt=s-t.St;continue;case 3:t.Tt=s-t.Rt;continue;case 4:t.Ut=s;continue;case 5:t.Nt=s;continue;case 6:t.Ht=s;continue;case 7:t.Ot=s;continue;case 8:t.Kt=s,t.Vt=s;continue;case 9:t.Vt=s;continue;case 10:t.Kt=s;continue;case 11:t.Zt=s;continue;case 12:t.At=s;continue;case 13:t.jt=s?-1:1;continue;case 14:t.Jt=s?-1:1;continue;default:throw"Unhandled modification type: "+e.ut}}}for(let t=0;t<this.$t;t++)this.yt[t].si(this);for(let t=0;t<this.$t;t++)this.fi[t]=t,this.e[t]=this.yt[t].Rt;for(let t=1;t<this.$t;t++){let i=this.fi[t],s=this.e[t],h=t-1;for(;h>=0&&this.e[h]>s;)this.fi[h+1]=this.fi[h],this.e[h+1]=this.e[h],h--;this.fi[h+1]=i,this.e[h+1]=s}}async load(t){let i=new e;this.reset(),await i.K(t),i.j(),i.J();let s=i.V(0);i.J(),this.$t=i.V(0),this.yt=new Array(this.$t),this.fi=new Int32Array(this.$t),this.e=new Int32Array(this.$t);for(let t=0;t<this.$t;t++)i.J(),this.yt[t]=new u,this.yt[t].Ct=i.V(0),this.yt[t].kt=i.V(1),this.yt[t].St=i.V(2),this.yt[t].Rt=i.V(3),this.yt[t].Wt=i.V(4),this.yt[t].Gt=i.V(5),this.yt[t].Xt=i.V(6),this.yt[t].Yt=i.V(7),this.yt[t].qt=i.V(8),this.yt[t].zt=i.V(9),this.yt[t].rotation=i.V(10),this.yt[t].alpha=i.V(11),this.yt[t].Ft=s>=2?i.V(12):0;if(s>=1?(i.J(),this.hi=i.V(0),this.ai=i.V(1),this.ei=i.V(2)):(this.hi=100,this.ai=360,this.ei=255),s>=3){i.J(),this.mi=i.V(0),this.di=new Array(this.mi);for(let t=0;t<this.mi;t++)i.J(),this.di[t]=new f,this.di[t].b=i.V(0),this.di[t].a=this.yt[this.di[t].b],this.di[t].c=i.V(1),this.di[t].d=i.V(2),this.di[t].e=i.V(3),this.di[t].f=i.V(4),this.di[t].li=i.V(5)}else this.mi=0;i.close()}vi(){return this.yt[0]}xi(){return this.hi}reset(){this.yt=void 0,this.fi=void 0,this.e=void 0,this.di=void 0}}function m(){const i=t.t.canvas,s=t.t.h;t.t.M(0,i.width=i.clientWidth,i.height=i.clientHeight,0,-1,1),s.uniformMatrix4fv(t.t.p,!1,t.t.matrix),s.viewport(0,0,i.clientWidth,i.clientHeight),t.t.g=i.clientWidth/2,t.t.$=i.clientHeight/2+100}class w{static Mi=[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,2,2,3,3,3,3,3,3,3,2,3,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,2,2,3,3,3,3,3,3,3,3,3,3,2,2,3,3,3,3,3,2,3,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,3,3,3,3,2,2,2,2,2,2,3,3,3,3,3,3,3,2,2,3,2,3,3,2,2,3,2,3,2,3,3,2,2,3,2,2,3,3,3,3,3,3,2,3,2,3,2,2,2,2,2,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,2,2,2,2,2,2,2,2,3,3,3,3,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,3,3,2,3,3,3,3,2,2,3,2,2,2,2,2,3,3,3,2,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3,2,3,2,3,3,3,3,3,2,3,3,3,3,3,2,3,2,2,3,3,2,3,3,3,3,2,2,2,3,3,3,3,2,3,3,3,3,3,1,3,3,2,2,3,3,2,3,2,2,2,3,3,3,2,3,2,3,3,3,3,3,3,2,2,2,2,2,2,3,3,2,2,2,2,2,3,3,2,3,2,2,3,3,2,3,2,2,2,2,3,3,3,3,3,3,3,3,2,2,2,3,3,2,2,3,2,2,2,3,3,2,2,3,3,2,2,3,2,2,2,2,2,2,2,2,3,3,2,2,2,3,2,2,2,2,3,3,2,3,2,2,3,3,3,3,3,3,2,2,3,2,3,2,2,2,3,2,2,2,2,2,3,2,3,2,2,3,3,3,2,2,2,3,3,2,2,2,2,3,2,2,3,2,2,2,2,2,3,2,2,2,3,2,2,3,3,2,2,2,2,2,3,2,2,3,3,2,2,2,2,3,2,2,2,2,2,2,2,3,2,3,3,3,2,3,2,2,2,2,2,3,3,3,3,2,2,2,2,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,3,3,3,3,3,2,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,2,2,3,2,2,2,2,3,3,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,2,2,3,3,2,2,3,3,3,3,3,2,2,2,2,2,2,2,2,2,3,3,3,3,2,2,2,2,2,2,2,3,3,3,2,2,2,2,2,2,2,2,3,2,2,3,2,3,3,2,2,2,3,3,3,2,2,2,3,3,2,2,1,2,3,3,2,2,2,2,2,2,2,2,3,2,2,2,2,2,3,2,2,2,2,2,3,2,2,3,2,2,2,2,2,3,3,2,2,2,2,2,3,2,2,3,3,2];static bi={656:[1,0],658:[2,0],659:[7,0],663:[4,0],664:[3,0],665:[9,0],669:[9,0],670:[2,0],675:[7,0],676:[6,0],685:[1,0],691:[10,0],697:[8,0],700:[1,0],706:[7,0],707:[9,0],713:[8,0],716:[1,0],717:[6,0]};_i;Ii;Pi;Ai;Fi;Ci;Li;ki;Bi;Si;Di=!1;Ri;Ti;Wi;Gi;stopped=!0;Ui=0;Ni=0;Xi=new Array(2);Yi=new Array(3);Hi=new Array(3);stop=!1;Oi=30;qi;startTime;now;then;Vi;zi;Ei(){if(t.t.canvas=document.getElementById("canvas"),this.Pi=document.getElementById("animtype"),this._i=document.getElementById("next"),this.Ii=document.getElementById("pause"),this.Ai=document.getElementById("unitid"),this.Fi=document.getElementById("range"),this.Ci=document.getElementById("downloadImg"),this.Li=document.getElementById("downloadV"),this.ki=document.getElementById("icons"),t.t.h=t.t.canvas.getContext("webgl2"),!t.t.h&&(console.warn("WebGL2 is not available, fallback to webgl"),t.t.h=t.t.canvas.getContext("webgl"),!t.t.h))throw alert("您的瀏覽器不支援WebGL2"),"";this.zi=this.animate.bind(this);function s(i,s){const h=t.t.h.createShader(i);if(t.t.h.shaderSource(h,s),t.t.h.compileShader(h),!t.t.h.getShaderParameter(h,t.t.h.COMPILE_STATUS))throw alert(t.t.h.getShaderInfoLog(h)),"";return h}const h=t.t.h.createProgram();t.t.h.attachShader(h,s(t.t.h.VERTEX_SHADER,"\nattribute vec2 vertexPosition;\nattribute vec2 texturePosition;\nattribute float alphaC;\nuniform mat4 u_matrix;\n\nvarying float v_alpha;\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n\tgl_Position = u_matrix * vec4(vertexPosition, 0.0, 1.0);\n\tvTexturePosition = texturePosition;\n\tv_alpha = alphaC;\n}")),t.t.h.attachShader(h,s(t.t.h.FRAGMENT_SHADER,"\nprecision mediump float;\n\nuniform sampler2D sampler;\nvarying vec2 vTexturePosition;\nvarying float v_alpha;\n\nvoid main(void) {\n\tgl_FragColor = texture2D(sampler, vTexturePosition) * v_alpha;\n}")),t.t.h.linkProgram(h),t.t.h.useProgram(h),t.t.i=h,t.t.position=t.t.h.getAttribLocation(h,"vertexPosition"),t.t.l=t.t.h.getAttribLocation(h,"texturePosition"),t.t.p=t.t.h.getUniformLocation(h,"u_matrix"),t.t.o=t.t.h.createBuffer(),t.t.u=t.t.h.createBuffer(),t.t.m=t.t.h.getAttribLocation(h,"alphaC"),m(),window.onresize=m,i.t.H();for(let t=0;t<3;++t)this.Xi[t]=new n;for(let t=0;t<3;++t)this.Hi[t]=new d;for(let t=0;t<3;++t){const i=this.Yi[t]=new Array(4);for(let t=0;t<4;++t)i[t]=new r}this.Ai.onchange=this.Ki.bind(this);{const t=new URL(location.href).searchParams.get("id");if(t){const i=parseInt(t);isFinite(i)&&i&&(this.Ai.value=i.toString())}}this.Ki({currentTarget:this.Ai});let e=this;this.Ii.onclick=function(){e.stopped?(e.qi=1e3/e.Oi,e.startTime=e.then=window.performance.now(),e.stop=!1,e.stopped=!1,e.animate()):(e.Wi=NaN,e.stop=!0)},this._i.onclick=function(){e.stopped&&(e.Fi.value=(++e.Gi).toString(),e.Zi())},this.Fi.oninput=function(){e.stopped&&(e.Gi=parseInt(e.Fi.value),e.Zi())},this.Pi.oninput=function(){e.Gi=0,e.Zi(),e.Ui=e.Pi?.selectedIndex,e.Fi.max=e.Yi[e.Ni][e.Ui].vt.toString()},this.Ci.onclick=function(){const s=i.t;s.R(),e.Zi(),s.T();const h=document.createElement("canvas"),n=h.getContext("2d");h.width=Math.max(s.L-s.C,100),h.height=Math.max(s.k-s.B,100),s.S=s.C,s.D=s.B,e.Zi(),n.drawImage(t.t.h.canvas,0,0),h.toBlob((function(t){const i=document.createElement("a"),s=window.URL.createObjectURL(t);i.href=s,i.download=`Cat No.${e.Wi}.png`,i.click()}))},this.Li.onclick=function(){e.stop=!0,e.Gi=0;const s=t.t.h;let h=prompt("每禎延遲(毫秒)\n延遲 = 1000 / 禎率 = 1000 / 30 = 33.33...","33");if(!h)return;if(h=parseInt(h),!isFinite(h)||h<=0)return;let n=prompt("開始禎","0");if(!n)return;n=parseInt(n);const a=e.Yi[e.Ni][e.Ui].vt;if(!isFinite(n)||n<0||n>a)return;let o=prompt("結束禎",a.toString());if(!o)return;if(o=parseInt(o),!isFinite(o)||n>o)return;let r=prompt("精度(像素採樣間隔，越低品質越好，最低1)","10");if(!r)return;if(r=parseInt(r),!isFinite(r)||r<=0)return;const l=new window.GIF({'quality':r}),c=i.t;c.R();for(let t=n;t<=o;++t)e.Zi(),e.Gi=t;c.T();const u=document.createElement("canvas"),f=u.getContext("2d");u.width=Math.max(c.L-c.C,100),u.height=Math.max(c.k-c.B,100),c.S=c.C,c.D=c.B,s.clearColor(0,0,0,1);for(let t=n;t<=o;++t)e.Zi(),e.Gi=t,f.drawImage(s.canvas,0,0),l.frames.push({data:f.getImageData(0,0,u.width,u.height).data,delay:h,Ji:!1,Qi:-1});s.clearColor(0,0,0,0),c.S=c.D=0;let d=e.Fi?.max;e.Fi.value="0",l.on("progress",(function(t){e.Fi.value=(~~(1e3*t)).toString()})),l.on("finished",(function(t){const i=document.createElement("a"),s=window.URL.createObjectURL(t);i.href=s,i.download="animation.gif",i.click(),e.Fi.value=d})),l.options.width=u.width,l.options.height=u.height,l.render(),i.t.O()};for(let t of this.ki.children)t.onclick=function(t){const i=t.currentTarget;e.Ni=parseInt(i.getAttribute("data-i"));for(let t of e.ki?.children)t.className=t==i?"active":"";e.Fi.max=e.Yi[e.Ni][e.Ui].vt.toString(),e.Fi.value="0",e.Gi=0,e.stopped&&e.Zi()};t.t.canvas.addEventListener("mousedown",(function(t){e.Di=!0})),t.t.canvas.addEventListener("mouseup",(function(t){e.Di=!1})),t.t.canvas.addEventListener("mousemove",(function(i){e.Di&&(t.t.g+=i.movementX,t.t.$+=i.movementY,e.stopped&&e.Zi())})),t.t.canvas.addEventListener("touchstart",(function(t){e.Di=!0,e.Ri=t.touches[0].clientX,e.Ti=t.touches[0].clientY,t.preventDefault()})),t.t.canvas.addEventListener("touchend",(function(t){e.Di=!1,t.preventDefault()})),t.t.canvas.addEventListener("touchmove",(function(i){const{clientX:s,clientY:h}=i.changedTouches[0];t.t.g+=s-e.Ri,t.t.$+=h-e.Ti,e.Ri=s,e.Ti=h,e.stopped&&e.Zi(),i.preventDefault()})),(this.Bi=document.getElementById("color1")).oninput=function(){t.t.canvas.style.setProperty("background",`linear-gradient(${e.Bi.value},${e.Si.value})`,"important"),localStorage.setItem("color1",e.Bi.value),localStorage.setItem("color2",e.Si.value)},(this.Si=document.getElementById("color2")).oninput=function(){t.t.canvas.style.setProperty("background",`linear-gradient(${e.Bi.value},${e.Si.value})`,"important"),localStorage.setItem("color1",e.Bi.value),localStorage.setItem("color2",e.Si.value)};let a=localStorage.getItem("color1");if(a){let i=localStorage.getItem("color2");i&&(e.Bi.value=a,e.Si.value=i,t.t.canvas.style.setProperty("background",`linear-gradient(${a},${i})`,"important"))}}Zi(){let s=new c;const h=this.Hi[this.Ni],e=this.Ui,n=this.Yi[this.Ni][e];this.Gi>n.vt&&(this.Gi=0),h.$i(n,this.Gi);h.wi(0).It().oi(h,h.wi(0).ci(),h.wi(0).ui(),s),i.t.O(),h.gi(t.t.g-s.x,t.t.$-s.y)}async Ki(t){let i=parseInt(t.currentTarget.value);if(!isFinite(i))return;this.Wi=NaN,this.stop=!0;const s=new URL(location.href);s.searchParams.set("id",i.toString()),history.pushState({},"",s),await this.hs(i),this.Wi=i,this.stopped&&(this.stopped=!1,this.stop=!1,this.qi=1e3/this.Oi,this.startTime=this.then=window.performance.now(),this.Gi=0,this.animate())}animate(t){if(null!=t&&(this.Fi.value=this.Gi.toString()),this.stop)if(isNaN(this.Wi)){this.stopped=!0;let t=parseInt(this.Ai.value);if(!isFinite(t))return;this.Wi=t}else this.stop=!1,this.qi=1e3/this.Oi,this.startTime=this.then=window.performance.now(),this.Gi=0,this.stopped=!1,this.animate();else requestAnimationFrame(this.zi),this.now=performance.now(),this.Vi=this.now-this.then,this.Vi>this.qi&&(this.then=this.now-this.Vi%this.qi,this.Zi(),++this.Gi)}async hs(i){if(this.Ni=0,i<0){-0==(i=-(i+1))&&(i=0);let s=t.v(i);for(let t of this.Xi)t.reset();let h=new Array;h.push(this.Xi[0].load(`/data/enemy/${s}/${s}_e.png`,`/data/enemy/${s}/${s}_e.imgcut`,0));for(let t=0;t<4;++t)h.push(this.Yi[0][t].load(`/data/enemy/${s}/${s}_e0${t}.maanim`));const e=this.Hi[0];e.pi(this.Xi[0]),h.push(e.load(`/data/enemy/${s}/${s}_e.mamodel`)),await Promise.all(h),this.Hi[0].$i(),this.Fi.max=this.Yi[0][this.Ui].vt.toString();const n=this.ki?.children;return n[0].style.display="none",n[1].style.display="none",void(n[2].style.display="none")}let s=t.v(i);for(let t of this.Xi)t.reset();const h=w.Mi[i];let e=new Array;const n=w.bi[i.toString()]||[];for(let i=0;i<n.length;++i)n[i]=t.v(n[i]);for(let t=0;t<h;++t){if(null!=n[t]){e.push(this.Xi[t].load(`/data/img/m/${n[t]}/${n[t]}_m.png`,`/data/img/m/${n[t]}/${n[t]}_m.imgcut`,0));continue}const i="fcs"[t];e.push(this.Xi[t].load(`/data/unit/${s}/${i}/${s}_${i}.png`,`/data/unit/${s}/${i}/${s}_${i}.imgcut`,0))}for(let t=0;t<h;++t){if(null!=n[t]){for(let i=0;i<4;++i)e.push(this.Yi[t][i].load(`/data/img/m/${n[t]}/${n[t]}_m0${i}.maanim`));continue}const i="fcs"[t];for(let h=0;h<4;++h)e.push(this.Yi[t][h].load(`/data/unit/${s}/${i}/${s}_${i}0${h}.maanim`))}for(let t=0;t<h;++t){const i=this.Hi[t];if(null!=n[t]){i.pi(this.Xi[t]),e.push(i.load(`/data/img/m/${n[t]}/${n[t]}_m.mamodel`));continue}const h="fcs"[t];i.pi(this.Xi[t]),e.push(i.load(`/data/unit/${s}/${h}/${s}_${h}.mamodel`))}await Promise.all(e);const a=this.ki?.children;for(let t=0;t<3;++t){const i=a[t];if(t>=h)i.style.display="none";else if(i.style.display="block",null!=n[t])i.src=`/data/img/m/${n[t]}/uni${n[t]}_m00.png`;else{const h="fcs"[t];i.src=`/data/unit/${s}/${h}/uni${s}_${h}00.png`}i.className=t?"":"active"}for(let t of this.Hi)t.$i();this.Fi.max=this.Yi[0][this.Ui].vt.toString()}}(new w).Ei()})();