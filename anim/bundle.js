(()=>{"use strict";var t={n:i=>{var s=i&&i.t?()=>i.default:()=>i;return t.d(s,{a:s}),s},d:(i,s)=>{for(var h in s)t.i(s,h)&&!t.i(i,h)&&Object.defineProperty(i,h,{enumerable:!0,get:s[h]})},i:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};class i{static h=new i;o;canvas;l;position;u;m;p;v;g;_;M=new Float32Array(16);$;I;P;A;F;k;static T(t){var i=t.toString();switch(i.length){case 3:return i;case 2:return"0"+i;default:return"00"+i}}N(t,i,s,h,e,n){this.M[0]=2/(i-t),this.M[1]=0,this.M[2]=0,this.M[3]=0,this.M[4]=0,this.M[5]=2/(h-s),this.M[6]=0,this.M[7]=0,this.M[8]=0,this.M[9]=0,this.M[10]=2/(e-n),this.M[11]=0,this.M[12]=(t+i)/(t-i),this.M[13]=(s+h)/(s-h),this.M[14]=(e+n)/(e-n),this.M[15]=1}scale(t,i){this.M[0]*=t,this.M[1]*=t,this.M[2]*=t,this.M[3]*=t,this.M[4]*=i,this.M[5]*=i,this.M[6]*=i,this.M[7]*=i}translate(t,i){this.M[12]=this.M[0]*t+this.M[4]*i+this.M[8]+this.M[12],this.M[13]=this.M[1]*t+this.M[5]*i+this.M[9]+this.M[13],this.M[14]=this.M[2]*t+this.M[6]*i+this.M[10]+this.M[14],this.M[15]=this.M[3]*t+this.M[7]*i+this.M[11]+this.M[15]}}class s{static h=new s;B=!1;L;D;C;O;R=0;U=0;S=new Float32Array(8);H=new Float32Array(8);X(){this.L=i.h.canvas.width,this.D=0,this.O=i.h.canvas.height,this.C=0,this.B=!0}Y(){this.B=!1,this.L=this.L-10,this.D=this.D+10,this.O=this.O-10,this.C=this.C+10}q(t){var s=i.h.l;let h=1,e=s.ONE,n=s.ONE_MINUS_SRC_ALPHA;switch(t){case 1:n=s.ONE;break;case 2:e=s.ZERO,n=s.SRC_COLOR;break;case 3:e=s.ONE_MINUS_DST_COLOR,n=s.ONE,h=2}s.blendFunc(e,n),s.uniform1i(i.h.g,h)}G(t,s,h,e,n,o,a,r,c,l,u,f,d){if(this.B)this.L=Math.min(s,e,o,r,this.L),this.D=Math.max(s,e,o,r,this.D),this.O=Math.min(h,n,a,c,this.O),this.C=Math.max(h,n,a,c,this.C);else{var m=i.h.l;this.S[0]=s-this.R,this.S[1]=h-this.U,this.S[2]=e-this.R,this.S[3]=n-this.U,this.S[4]=r-this.R,this.S[5]=c-this.U,this.S[6]=o-this.R,this.S[7]=a-this.U,m.bindBuffer(m.ARRAY_BUFFER,i.h.u),m.bufferData(m.ARRAY_BUFFER,this.S,m.STATIC_DRAW),this.S[0]=l,this.S[1]=u,this.S[2]=l,this.S[3]=u+d,this.S[4]=l+f,this.S[5]=u,this.S[6]=l+f,this.S[7]=u+d;for(let i=0;i<8;)this.S[i++]/=t.W,this.S[i++]/=t.j;m.bindBuffer(m.ARRAY_BUFFER,i.h.p),m.bufferData(m.ARRAY_BUFFER,this.S,m.STATIC_DRAW),m.bindTexture(m.TEXTURE_2D,t.V),m.drawArrays(m.TRIANGLE_STRIP,0,4)}}setAlpha(t){i.h.l.uniform1f(i.h.v,t)}Z(){var t=i.h.l;t.blendFunc(t.ONE,t.ZERO),t.bindBuffer(t.ARRAY_BUFFER,i.h.u),t.bufferData(t.ARRAY_BUFFER,this.H,t.STATIC_DRAW),t.uniform1i(i.h.g,3),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}class h{x;y;width;height}class e{a;b;K=0;J(t){return parseInt(this.b[t])}async tt(t){t=await fetch(t);if(!t.ok)throw"File not found";this.a=await t.text()}it(t){return this.b[t]}st(){var t;return this.K>=this.a.length?null:(t=this.K,this.K=this.a.indexOf("\n",t),-1==this.K?(this.K=this.a.length,this.a.slice(t)):(t=this.a.slice(t,this.K++)).includes("\r")?t.replaceAll("\r",""):t)}ht(t=","){var i=this.st();return i&&(this.b=i.split(t)),this.b}c(){return this.a}close(){}}class n{V;W;j;name;et;async load(t,s,n=0){if(this.reset(),null!=s)if(0!=(1&n)){let t=new e,i=(await t.tt(s),t.st(),t.st(),t.st(),t.ht(),t.J(0));this.et=new Array(i);for(let s=0;s<i;s++)t.ht(),this.et[s].x=t.J(0),this.et[s].y=t.J(1),this.et[s].width=t.J(2),this.et[s].height=t.J(3);t.close()}else{let t=new e,i=(await t.tt(s),t.st(),t.st(),t.st(),t.ht(),t.J(0));this.et=new Array(i);for(let s=0;s<i;s++)t.ht(),this.et[s]=new h,this.et[s].x=t.J(0),this.et[s].y=t.J(1),this.et[s].width=t.J(2),this.et[s].height=t.J(3);t.close()}const o=i.h.l,a=document.createElement("img");a.crossOrigin="anonymous",a.src=t,await new Promise(function(t,i){a.onload=t,a.onerror=i}),this.W=a.naturalWidth,this.j=a.naturalHeight,this.V=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.V),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a)}reset(){this.V&&(i.h.l.deleteTexture(this.V),this.V=null)}}class o{frame;nt;ot;rt}class a{ct;lt;loop;ut;ft;dt=0;max=0;wt=0;vt=0;gt(){if(this.ut&&(this.ft[0].frame<0||-1!=this.loop)){this.dt=-this.ft[0].frame;for(let t=0;t<this.ut;++t)this.ft[t].frame+=this.dt}return this.ut&&(this.wt=this.ft[0].frame,this.max=this.ft[this.ut-1].frame),-1!=this.loop?1<this.loop?this.wt+(this.max-this.wt)*this.loop:this.max-this.dt:this.max-Math.min(this.dt,0)}yt(t){this.ut&&t[this.ct].bt(this.lt,this.ft[this.ut-1].nt)}}class r{_t;Mt;$t;async load(t){var i=new e;this.$t=0,await i.tt(t),i.st(),i.st(),i.ht(),this.Mt=i.J(0),this._t=new Array(this.Mt);for(let t=0;t<this.Mt;t++){i.ht();var s=new a;(this._t[t]=s).ct=i.J(0),s.lt=i.J(1),s.loop=i.J(2),i.ht(),s.ut=i.J(0),s.ft=new Array(s.ut);for(let t=0;t<s.ut;t++)i.ht(),s.ft[t]=new o,s.ft[t].frame=i.J(0),s.ft[t].nt=i.J(1),s.ft[t].ot=i.J(2),s.ft[t].rt=i.J(3);var h=s.gt();h>this.$t&&(this.$t=h)}i.close()}}class c{M=new Float32Array(6);constructor(){this.xt()}xt(){this.M[0]=1,this.M[1]=0,this.M[2]=0,this.M[3]=0,this.M[4]=1,this.M[5]=0}rotate(t){var i=Math.cos(t*Math.PI/180),s=(t=Math.sin(t*Math.PI/180),this.M[0]);this.M[0]=this.M[0]*i+this.M[1]*t,this.M[1]=s*-t+this.M[1]*i,s=this.M[3],this.M[3]=this.M[3]*i+this.M[4]*t,this.M[4]=i*this.M[4]+(t=-t)*s}setTranslate(t,i){this.M[0]=1,this.M[1]=0,this.M[2]=t,this.M[3]=0,this.M[4]=1,this.M[5]=i}setRotate(t){this.M[0]=Math.cos(t*Math.PI/180),this.M[1]=-Math.sin(t*Math.PI/180),this.M[2]=0,this.M[3]=Math.sin(t*Math.PI/180),this.M[4]=Math.cos(t*Math.PI/180),this.M[5]=0}setScale(t,i){this.M[0]=t/100,this.M[1]=0,this.M[2]=0,this.M[3]=0,this.M[4]=i/100,this.M[5]=0}scale(t,i){this.M[0]=this.M[0]*t/100,this.M[1]=this.M[1]*i/100,this.M[3]=this.M[3]*t/100,this.M[4]=this.M[4]*i/100}set(t){this.M.set(t.M)}transform(t,i,s){s.x=~~(this.M[0]*t+this.M[1]*i+this.M[2]),s.y=~~(this.M[3]*t+this.M[4]*i+this.M[5])}translate(t,i){this.M[2]=this.M[2]+this.M[0]*t+this.M[1]*i,this.M[5]=this.M[5]+this.M[3]*t+this.M[4]*i}mul(t){var i=this.M[0],s=t.M[0],h=this.M[1],e=t.M[3],n=this.M[2],o=t.M[1],a=this.M[3],r=t.M[4],c=this.M[4],l=(t.M[2],this.M[5]),t=t.M[5];this.M[0]=i*s+h*e,this.M[1]=i*o+h*r,this.M[2]=n*s+a*e,this.M[3]=n*o+a*r,this.M[4]=c*s+l*e,this.M[5]=c*o+l*r+t}}class l{x=0;y=0}class u{It;Pt;At;Ft;kt;Tt;Nt;Bt;Lt;Dt;zt;Ct;Ot;Rt;Ut;St;Ht;Xt;Yt;qt;Gt;s;Et;Wt;jt;Vt;rotation;Zt;alpha;Kt;Jt;E=new Int32Array(8);Qt=new l;ti=new c;reset(t,i){this.Kt=1,this.Jt=1,this.Tt=0,this.Bt=0,this.Dt=0,this.St=0,this.Ut=0,this.Yt=0,this.qt=0,this.Ct=0,this.Vt=t,this.Et=t,this.Zt=0,this.At=i}ii(t){let i,s,h;-1<this.kt+this.Tt?(h=t._t[this.kt+this.Tt],this.s=i=~~(this.Gt*this.Et*h.s/t.si/t.si),this.jt=s=~~(this.Wt*this.Vt*h.jt/t.si/t.si),this.It=this.Pt=this.alpha*this.At*h.It/t.hi/t.hi):(i=this.Gt*this.Et/t.si,this.s=i,s=this.Wt*this.Vt/t.si,this.jt=s,this.It=this.Pt=this.alpha*this.At/t.hi),-1<this.Nt+this.Bt&&(this.E[0]=this.E[2]=-(this.Ht+this.Yt)*i/t.si,this.E[4]=this.E[6]=i*t.ei.et[this.Lt+this.Dt].width/t.si+this.E[0],this.E[1]=this.E[7]=-(this.Xt+this.qt)*s/t.si,this.E[3]=this.E[5]=s*t.ei.et[this.Lt+this.Dt].height/t.si+this.E[1]),h?(this.ti.set(h.ti),this.ti.translate((this.Ot+this.Ut)*h.s/t.si,(this.Rt+this.St)*h.jt/t.si)):this.ti.translate(this.Ut,this.St),this.ti.rotate(360*(this.rotation+this.Zt)/t.ni);for(let t=0;t<8;t+=2)this.ti.transform(this.E[t],this.E[t+1],this.Qt),this.E[t]=this.Qt.x,this.E[t+1]=this.Qt.y}oi(t,i,s,h){this.ti.transform((i-this.Ht-this.Yt)*this.s/t.si,(s-this.Xt-this.qt)*this.jt/t.si,h)}bt(t,i){switch(t){case 0:return void(this.Tt=i-this.kt);case 1:return void(this.Bt=i-this.Nt);case 2:return void(this.Dt=i-this.Lt);case 3:return void(this.Ct=i-this.zt);case 4:return void(this.Ut=i);case 5:return void(this.St=i);case 6:return void(this.Yt=i);case 7:return void(this.qt=i);case 8:return this.Vt=i,void(this.Et=i);case 9:return void(this.Et=i);case 10:return void(this.Vt=i);case 11:return void(this.Zt=i);case 12:return void(this.At=i);case 13:return void(this.Kt=i?-1:1);case 14:return void(this.Jt=i?-1:1)}}ai(t,i,s,h){var e;this.Nt<0||this.Lt<0||(i.q(this.Ft),(e=this.Pt/t.hi)&&(i.setAlpha(e),t=(e=t.ei).et[this.Dt+this.Lt],i.G(e,this.E[0]+s,this.E[1]+h,this.E[2]+s,this.E[3]+h,this.E[4]+s,this.E[5]+h,this.E[6]+s,this.E[7]+h,t.x,t.y,t.width,t.height)))}}class f{a;b;c;d;e;f;ri}class d{ei;_t;Mt;ci;e;si;ni;hi;li;ui;fi(t){return this.li[t]}di(t){this.ei=t}mi(t,i){var h=s.h;for(let s=0;s<this.Mt;s++)this._t[this.ci[s]].ai(this,h,t,i)}pi(t,i,s){let h=i,e=i;for(let s=i-1;0<=s&&3==t[s].ot;s--)h=s;for(let s=i+1;s<t.length&&3==t[e=s].ot;s++);let n=0;for(let i=h;i<=e;i++){let o=4096*t[i].nt;for(let n=h;n<=e;n++)i!=n&&(o*=(s-t[n].frame)/(t[i].frame-t[n].frame));n+=o}return~~(n/4096)}ii(t,i=0){if(!i)for(let t of this._t)t.reset(this.si,this.hi);if(t)for(var s of t._t){const t=s.loop,h=s.max,e=s.wt,n=h-e;let o=-1==t?h?(i+s.dt)%h:0:i+s.dt;if(0<t&&n){if(o>e+t*n){s.yt(this._t);continue}o<=e||(o=o<e+t*n?e+(o-e)%n:h)}for(let t=0;t<s.ut;++t)if(o==s.ft[t].frame)this._t[s.ct].bt(s.lt,s.vt=s.ft[t].nt);else if(t<s.ut-1&&o>s.ft[t].frame&&o<s.ft[t+1].frame){if(1<s.lt){const i=s.ft[t].frame,h=s.ft[t].nt,e=s.ft[t+1].frame,n=s.ft[t+1].nt;let a=(o-i)/(e-i);if(1==s.ft[t].ot||13==s.lt||14==s.lt)a=0;else if(0!=s.ft[t].ot)if(2==s.ft[t].ot)a=0<=s.ft[t].rt?1-Math.sqrt(1-Math.pow(a,s.ft[t].rt)):Math.sqrt(1-Math.pow(1-a,-s.ft[t].rt));else{if(3==s.ft[t].ot){s.vt=this.pi(s.ft,t,o),this._t[s.ct].bt(s.lt,s.vt);break}4==s.ft[t].ot&&(a=0<s.ft[t].rt?1-Math.cos(a*Math.PI/2):s.ft[t].rt<0?Math.sin(a*Math.PI/2):(1-Math.cos(a*Math.PI))/2)}2==s.lt?s.vt=n-h<0?Math.ceil((n-h)*a+h):(n-h)*a+h:s.vt=(n-h)*a+h,this._t[s.ct].bt(s.lt,s.vt=~~s.vt);break}0==s.lt&&this._t[s.ct].bt(0,s.ft[t].nt)}s.ut&&o>s.max&&s.yt(this._t)}for(let t of this._t)t.ii(this);for(let t=0;t<this.Mt;t++)this.ci[t]=t,this.e[t]=this._t[t].zt+this._t[t].Ct;for(let t=1;t<this.Mt;t++){let i=this.ci[t],s=this.e[t],h=t-1;for(;0<=h&&this.e[h]>s;)this.ci[h+1]=this.ci[h],this.e[h+1]=this.e[h],h--;this.ci[h+1]=i,this.e[h+1]=s}}async load(t){var i=new e;this.reset(),await i.tt(t),i.st(),i.ht(),i.ht(),this.Mt=i.J(0),this._t=new Array(this.Mt),this.ci=new Int32Array(this.Mt),this.e=new Int32Array(this.Mt);for(let t=0;t<this.Mt;t++)i.ht(),this._t[t]=new u,this._t[t].kt=i.J(0),this._t[t].Nt=i.J(1),this._t[t].Lt=i.J(2),this._t[t].zt=i.J(3),this._t[t].Ot=i.J(4),this._t[t].Rt=i.J(5),this._t[t].Ht=i.J(6),this._t[t].Xt=i.J(7),this._t[t].Gt=i.J(8),this._t[t].Wt=i.J(9),this._t[t].rotation=i.J(10),this._t[t].alpha=i.J(11),this._t[t].Ft=i.J(12);i.ht(),this.si=i.J(0),this.ni=i.J(1),this.hi=i.J(2),i.ht(),this.ui=i.J(0),this.li=new Array(this.ui);for(let t=0;t<this.ui;t++)i.ht(),this.li[t]=new f,this.li[t].b=i.J(0),this.li[t].a=this._t[this.li[t].b],this.li[t].c=i.J(1),this.li[t].d=i.J(2),this.li[t].e=i.J(3),this.li[t].f=i.J(4),this.li[t].ri=i.J(5);i.close()}wi(){return this._t[0]}vi(){return this.si}reset(){this._t=void 0,this.ci=void 0,this.e=void 0,this.li=void 0}}var w,m=GIF,p=t.n(m);new class{gi;yi;bi;_i;Mi;$i;xi;Ii;Pi;Ai;$;I;Fi;loading;zoom;ki=!1;Ti;Ni;Bi;Li;stopped=!0;Di=0;zi=0;Ci=new Array(4);Oi=new Array(4);Ri=new Array(4);stop=!1;Ui=1e3/30;then=0;loaded=!1;Si=new l;Hi;constructor(){let t=this;function h(){var n,c,l,e,o,h=parseInt(t.zoom.value);isNaN(h)||h<=0||(e=i.h.canvas,n=window.devicePixelRatio||1,o=~~(e.clientWidth*n),n=~~(e.clientHeight*n),h=100/h,c=i.h.l,l=(e.width=o)*h,e=(e.height=n)*h,i.h.A=l/2,i.h.F=2*e/3,c.uniform1f(i.h.P,n),c.viewport(0,0,o,n),i.h.N(0,l,e,0,-1,1),c.uniformMatrix4fv(i.h._,!1,i.h.M),i.h.k=h,(o=s.h.H)[3]=e,o[4]=l,o[6]=l,o[7]=e,t.stopped&&t.Xi())}this.Yi(),this.zoom=document.getElementById("zoom");{const t=window.devicePixelRatio||1;this.zoom.value=(~~Math.min(100,Math.max(50,Math.min(i.h.canvas.clientWidth*t,i.h.canvas.clientHeight*t)/5))).toString()}h(),s.h.Z(),window.onresize=h,this.zoom.onchange=h,this.qi();for(let t=0;t<this.Ci.length;++t)this.Ci[t]=new n;for(let t=0;t<this.Ri.length;++t)this.Ri[t]=new d;for(let t=0;t<this.Oi.length;++t){const i=this.Oi[t]=new Array(4);for(let t=0;t<4;++t)i[t]=new r}{const t=new URL(location.href).searchParams.get("id");if(t){const i=parseInt(t);isFinite(i)&&i&&(this.Mi.value=i.toString())}}function e(s,h){i.h.A+=s,i.h.F+=h,t.stopped&&t.Xi()}this.bi.onclick=function(){t.Gi(t.stopped),t.stopped?(t.stop=!1,t.stopped=!1,t.animate(),t.xi.style.display="none"):(t.Bi=NaN,t.stop=!0)},this.gi.onclick=function(){t.stopped&&(t.$i.value=(++t.Li).toString(),t.Xi())},this.yi.onclick=function(){t.stopped&&(t.Li=Math.max(t.Li-1,0),t.$i.value=t.Li.toString(),t.Xi())},this.$i.oninput=function(){t.stopped&&(t.Li=parseInt(t.$i.value),t.Xi())},this._i.oninput=function(){t.Li=0,t.Xi(),t.Di=t._i?.selectedIndex,t.$i.max=t.Oi[t.zi][t.Di].$t.toString()},this.Ii.onclick=function(){var e=s.h,n=(e.X(),t.Xi(),e.Y(),new OffscreenCanvas(Math.max(e.D-e.L,100),Math.max(e.C-e.O,100))),o=(t.Ei(n),n.getContext("2d"));e.R=e.L,e.U=e.O,t.Xi(!0),o.drawImage(i.h.l.canvas,0,0),n.convertToBlob({type:"image/png",quality:1}).then(function(i){var s=document.createElement("a"),i=window.URL.createObjectURL(i);s.href=i,s.download=`Cat No.${t.Bi}.png`,s.click()}),e.R=e.U=0,h()},this.Pi.onclick=function(){t.stop=!0,t.Li=0;var e=i.h.l;if(n=prompt("每禎延遲(毫秒)\n延遲 = 1000 / 禎率 = 1000 / 30 = 33.33...","33")){var n=parseInt(n);if(isFinite(n)&&!(n<=0))if(o=prompt("開始禎","0")){var o=parseInt(o),a=t.Oi[t.zi][t.Di].$t;if(!(!isFinite(o)||o<0||a<o)){var r=prompt("結束禎",a.toString());if(r&&(r=parseInt(r),isFinite(r))&&!(r<o)){a=prompt("畫質(像素採樣間隔，越低品質越好，最低1)","10");if(a&&(a=parseInt(a),isFinite(a))&&!(a<=0)){var l=s.h;l.X();for(let i=o;i<=r;++i)t.Xi(!0),t.Li=i;l.Y();var u=new OffscreenCanvas(Math.max(l.D-l.L,100),Math.max(l.C-l.O,100)),f=(t.Ei(u),u.getContext("2d",{Wi:!0})),d=(l.R=l.L,l.U=l.O,new(p())({quality:a,width:u.width,height:u.height}));for(let i=o;i<=r;++i)t.Xi(!0),t.Li=i,f.drawImage(e.canvas,0,0),d.frames.push({data:f.getImageData(0,0,u.width,u.height).data,delay:n,ji:!1,Vi:-1});l.R=l.U=0;let m=t.$i?.max;t.$i.value="0",d.on("progress",function(i){t.$i.value=(~~(1e3*i)).toString()}),d.on("finished",function(i){var s=document.createElement("a"),i=window.URL.createObjectURL(i);s.href=i,s.download="animation.gif",s.click(),t.$i.value=m}),d.render(),h()}}}}}},document.getElementById("fps").oninput=function(i){i=i.currentTarget;t.Ui=1e3/parseInt(i.value)},t.$=document.getElementById("color1"),t.I=document.getElementById("color2"),t.$.oninput=t.I.oninput=function(s){var h=t.$.value,e=t.I.value,h=[parseInt(h.substring(1,3),16),parseInt(h.substring(3,5),16),parseInt(h.substring(5,7),16)],e=[parseInt(e.substring(1,3),16)-h[0],parseInt(e.substring(3,5),16)-h[1],parseInt(e.substring(5,7),16)-h[2]],a=i.h.l;a.uniform3f(i.h.$,h[0]/255,h[1]/255,h[2]/255),a.uniform3f(i.h.I,e[0]/255,e[1]/255,e[2]/255),t.stopped&&t.Xi()},this.Hi=this.animate.bind(this),document.getElementById("settings").onclick=document.getElementById("share").onclick=function(t){t.stopPropagation(),!w||t.target instanceof HTMLInputElement?(w=t.currentTarget.firstElementChild.nextElementSibling).style.display="block":(w.style.display="none",w=null)},document.getElementById("nextu").onclick=async function(i){i.stopPropagation();var i=parseInt(t.Mi.value),h=(i+=1,t.Mi.value=i.toString(),t.Bi=NaN,t.stop=!0,new URL(location.href));h.searchParams.set("id",i.toString()),history.pushState({},"",h),await t.Zi(i),t.Li=0,t.Xi(),t.Li=0,t.xi.style.display="block"},document.getElementById("prevu").onclick=async function(i){i.stopPropagation();var i=parseInt(t.Mi.value),h=(--i,t.Mi.value=i.toString(),t.Bi=NaN,t.stop=!0,new URL(location.href));h.searchParams.set("id",i.toString()),history.pushState({},"",h),await t.Zi(i),t.Li=0,t.Xi(),t.Li=0,t.xi.style.display="block"},window.onkeydown=function(i){switch(i.keyCode){case 80:case 32:t.bi.onclick();break;case 68:case 39:e(4,0);break;case 65:case 37:e(-4,0);break;case 87:case 38:e(0,-4);break;case 83:case 40:e(0,4);break;case 78:t.gi.onclick();break;case 66:t.yi.onclick()}};for(let i of this.Ai.children)i.onclick=function(i){var s=i.currentTarget;t.zi=parseInt(s.getAttribute("data-i"));for(let i of t.Ai?.children)i.className=i==s?"active":"";t.$i.max=t.Oi[t.zi][t.Di].$t.toString(),t.$i.value="0",t.Li=0,t.stopped&&t.Xi()};i.h.canvas.addEventListener("mousedown",function(i){t.ki=!0}),i.h.canvas.addEventListener("mouseup",function(i){t.ki=!1}),i.h.canvas.addEventListener("mousemove",function(h){h.preventDefault(),h.stopPropagation(),t.ki&&(i.h.A+=h.movementX,i.h.F+=h.movementY,t.stopped)&&(s.h.Z(),t.Ri[t.zi].mi(i.h.A-t.Si.x,i.h.F-t.Si.y))}),i.h.canvas.addEventListener("touchstart",function(i){t.Ti=i.touches[0].clientX,t.Ni=i.touches[0].clientY,i.preventDefault(),"block"==t.xi.style.display&&(t.xi.style.display="none",t.bi.onclick())}),i.h.canvas.addEventListener("touchmove",function(h){h.preventDefault();var{clientX:h,clientY:n}=h.changedTouches[0];i.h.A+=h-t.Ti,i.h.F+=n-t.Ni,t.Ti=h,t.Ni=n,t.stopped&&(s.h.Z(),t.Ri[t.zi].mi(i.h.A-t.Si.x,i.h.F-t.Si.y))}),this.xi.addEventListener("click",function(){t.xi.style.display="none",t.bi.onclick()}),i.h.canvas.addEventListener("click",function(){w?(w.style.display="none",w=null):"block"==t.xi.style.display&&(t.xi.style.display="none",t.bi.onclick())}),this.Mi.onchange=this.Ki.bind(this),addEventListener("wheel",function(i){i=Math.sign(i.deltaY);t.zoom.value=(0<i?parseInt(t.zoom.value)-5:parseInt(t.zoom.value)+5).toString(),t.zoom.onchange()}),this.Ki()}Gi(t){var i=this.bi.firstElementChild,s=i.nextElementSibling;t?(s.style.display="none",i.style.display="block"):(s.style.display="block",i.style.display="none")}Yi(){var t=i.h;if(t.canvas=document.getElementById("canvas"),!(t.l=t.canvas.getContext("webgl2")||t.canvas.getContext("webgl")||t.canvas.getContext("experimental-webgl")))throw alert("您的瀏覽器不支援 WebGL"),"";const h=t.l;function e(t,i){var s=h.createShader(t);if(h.shaderSource(s,i),h.compileShader(s),h.getShaderParameter(s,h.COMPILE_STATUS))return s;{const t=h.getShaderInfoLog(s);throw alert(t),t}}var n=h.createProgram();h.attachShader(n,e(h.VERTEX_SHADER,"\nattribute vec2 vertexPosition;\nattribute vec2 texturePosition;\n\nuniform mat4 u_matrix;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n    gl_Position = u_matrix * vec4(vertexPosition, 0.0, 1.0);\n    vTexturePosition = texturePosition;\n}")),h.attachShader(n,e(h.FRAGMENT_SHADER,"\nprecision mediump float;\n\nuniform sampler2D sampler;\nuniform float v_alpha;\nuniform int mode;\nuniform float canvasH;\nuniform vec3 color1;\nuniform vec3 color2;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n    if (mode == 3) {\n        float frac = gl_FragCoord.y / canvasH;\n        if (frac > 0.5)\n            frac = 1.0 - frac;\n        gl_FragColor = vec4(color1 + (color2 * frac), 1.0);\n    } else {\n        vec4 c = texture2D(sampler, vTexturePosition);\n        c.xyz *= (v_alpha * c.a);\n        if (mode == 1) {\n            c.a*=v_alpha;\n            c.xyz*=v_alpha;\n        } else {\n            c.a*=v_alpha;\n            c.xyz=1.0-c.a+c.xyz*c.a;\n        }\n        gl_FragColor = c;\n    }\n}")),h.linkProgram(n),h.useProgram(n),t.o=n,t.position=h.getAttribLocation(n,"vertexPosition"),t.m=h.getAttribLocation(n,"texturePosition"),t.g=h.getUniformLocation(n,"mode"),t._=h.getUniformLocation(n,"u_matrix"),t.u=h.createBuffer(),t.p=h.createBuffer(),t.v=h.getUniformLocation(n,"v_alpha"),t.P=h.getUniformLocation(n,"canvasH"),t.$=h.getUniformLocation(n,"color1"),t.I=h.getUniformLocation(n,"color2"),h.bindBuffer(h.ARRAY_BUFFER,t.u),h.vertexAttribPointer(t.position,2,h.FLOAT,!1,0,0),h.enableVertexAttribArray(t.position),h.bindBuffer(h.ARRAY_BUFFER,t.p),h.vertexAttribPointer(t.m,2,h.FLOAT,!1,0,0),h.enableVertexAttribArray(t.m),h.bindBuffer(h.ARRAY_BUFFER,t.p),h.bufferData(h.ARRAY_BUFFER,s.h.S,h.STATIC_DRAW),h.uniform3f(t.$,70/255,140/255,160/255),h.uniform3f(t.I,45/255,90/255,90/255),h.clearColor(1,1,1,1),h.enable(h.BLEND)}qi(){this.xi=document.getElementById("start-play"),this._i=document.getElementById("animtype"),this.gi=document.getElementById("next"),this.yi=document.getElementById("prev"),this.bi=document.getElementById("pause"),this.Mi=document.getElementById("unitid"),this.$i=document.getElementById("range"),this.Ii=document.getElementById("downloadImg"),this.Pi=document.getElementById("downloadV"),this.Ai=document.getElementById("icons"),this.Fi=document.getElementById("nframe"),this.loading=document.getElementById("loading")}Xi(t=!1){var h,e;this.loaded&&(h=this.Ri[this.zi],e=this.Oi[this.zi][this.Di],this.Li>e.$t&&(this.Li=0),this.Fi.textContent=this.Li.toString(),h.ii(e,this.Li),(e=h.fi(0)).a.oi(h,e.d,e.e,this.Si),t?i.h.l.clear(i.h.l.COLOR_BUFFER_BIT):s.h.Z(),h.mi(i.h.A-this.Si.x,i.h.F-this.Si.y))}Ei(t){var s=i.h.canvas;s.width=t.width,s.height=t.height,i.h.l.viewport(0,0,s.width,s.height),window.devicePixelRatio,i.h.N(0,s.width,s.height,0,-1,1),i.h.l.uniformMatrix4fv(i.h._,!1,i.h.M),i.h.k=1}async Ki(){var i,t=parseInt(this.Mi.value);isFinite(t)&&(this.Bi=NaN,this.stop=!0,(i=new URL(location.href)).searchParams.set("id",t.toString()),i.href!=location.href&&history.pushState({},"",i),await this.Zi(t),this.Li=0,this.Xi(),this.Li=0,this.xi.style.display="block")}animate(t){if(null!=t&&(this.$i.value=this.Li.toString()),this.stop)if(isNaN(this.Bi)){this.stopped=!0;let t=parseInt(this.Mi.value);if(!isFinite(t))return;this.Bi=t}else this.stop=!1,this.Li=0,this.stopped=!1,this.animate();else{requestAnimationFrame(this.Hi);var t=performance.now(),s=t-this.then;s>this.Ui&&(this.then=t-s%this.Ui,this.Xi(),++this.Li)}}async Zi(t){this.zi=0,this.loaded=!1,this.loading.style.display="block";try{if(t<0){-0==(t=-(t+1))&&(t=0);let s=i.T(t);for(let t of this.Ci)t.reset();let h=new Array;h.push(this.Ci[0].load(`https://battlecatsinfo.github.io/img/e/${s}/${s}_e.png`,`/data/enemy/${s}/${s}_e.imgcut`,0));for(let t=0;t<4;++t)h.push(this.Oi[0][t].load(`/data/enemy/${s}/${s}_e0${t}.maanim`));const e=this.Ri[0],n=(e.di(this.Ci[0]),h.push(e.load(`/data/enemy/${s}/${s}_e.mamodel`)),await Promise.all(h),this.$i.max=this.Oi[0][this.Di].$t.toString(),this.Ai?.children);n[0].style.display="none",n[1].style.display="none",n[2].style.display="none",this.loading.style.display="none",void(this.loaded=!0)}else{var s=i.T(t);for(let t of this.Ci)t.reset();var h=unit_counts[t],e=new Array,n=eggs[t]||[];for(let t=0;t<n.length;++t)n[t]=i.T(n[t]);for(let t=0;t<h;++t)if(null!=n[t])e.push(this.Ci[t].load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.png`,`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.imgcut`,0));else{const i="fcsu"[t];e.push(this.Ci[t].load(`https://battlecatsinfo.github.io/img/u/${s}/${i}/${s}_${i}.png`,`/data/unit/${s}/${i}/${s}_${i}.imgcut`,0))}for(let t=0;t<h;++t)if(null!=n[t])for(let i=0;i<4;++i)e.push(this.Oi[t][i].load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m0${i}.maanim`));else{const i="fcsu"[t];for(let h=0;h<4;++h)e.push(this.Oi[t][h].load(`/data/unit/${s}/${i}/${s}_${i}0${h}.maanim`))}for(let t=0;t<h;++t){const i=this.Ri[t];if(null!=n[t])i.di(this.Ci[t]),e.push(i.load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.mamodel`));else{const h="fcsu"[t];i.di(this.Ci[t]),e.push(i.load(`/data/unit/${s}/${h}/${s}_${h}.mamodel`))}}await Promise.all(e);var o=this.Ai?.children;for(let t=0;t<4;++t){const i=o[t];if(t>=h)i.style.display="none";else if(i.style.display="block",null!=n[t])i.src=`https://battlecatsinfo.github.io/img/s/${n[t]}/uni${n[t]}_m00.png`;else{const h="fcsu"[t];i.src=`https://battlecatsinfo.github.io/img/u/${s}/${h}/uni${s}_${h}00.png`}i.className=t?"":"active"}this.$i.max=this.Oi[0][this.Di].$t.toString(),this.loading.style.display="none",this.loaded=!0}}catch(t){console.error(t),alert("載入資源失敗，請檢查您的網路狀態:\n"+t.message)}}}})();