const my_params=new URLSearchParams(location.search),my_id=parseInt(my_params.get("id")),atk_mult_abs=new Set([AB_STRONG,AB_MASSIVE,AB_MASSIVES,AB_EKILL,AB_WKILL,AB_BAIL,AB_BSTHUNT,AB_S,AB_GOOD,AB_CRIT,AB_WAVE,AB_MINIWAVE,AB_MINIVOLC,AB_VOLC,AB_ATKBASE,AB_SAGE]),hp_mult_abs=new Set([AB_EKILL,AB_WKILL,AB_GOOD,AB_RESIST,AB_RESISTS,AB_BSTHUNT,AB_BAIL,AB_SAGE]),maxLen=(layout=localStorage.getItem("layout"),[0,0]);var my_cat,lvMax,tf_tbl,tf_tbl_s,tf4_tbl,custom_talents,custom_super_talents,orb_attr,orb_eff,orb_gradle,buf,opt_b,opt_f,level_count=0,super_talent=!1,add_atk=0,orb_hp=1;const tables=[],modal_content=document.getElementById("modal-c"),modal=document.getElementById("modal"),cat_icons=(isNaN(my_id)&&(my_id=0),document.getElementById("cat-icons")),unit_content=document.getElementById("unit-content"),tooltip=document.getElementsByClassName("tooltip")[0],skill_costs=[[25,5,5,5,5,10,10,10,10,10],[5,5,5,5,5,10,10,10,10,10],[50],[50,10,10,10,10,15,15,15,15,15],[10,10,10,10,10,15,15,15,15,15],[75],[75,15,15,15,15,20,20,20,20,20],[15,15,15,15,15,20,20,20,20,20],[100],[150],[250],[100,15,15,15,15,25,25,25,25,25],[75,10,10,10,10,20,20,20,20,20],[120,20,20,20,20,25,25,25,25,25]],talent_d=["","攻擊力下降","使動作停止","使動作變慢","只能攻擊","善於攻擊","很耐打","超大傷害","打飛敵人","傳送","攻擊力上升","死前存活","善於攻城","會心一擊","終結不死","破壞護盾","得到很多金錢","波動","抗擊耐性","動止耐性","動慢耐性","抗飛耐性","抗波耐性","波動滅止","抗傳耐性","成本減少","生產加快","移動加快","增加擊退","古代詛咒無效","抗古代詛咒耐性","基本攻擊力上升","基本體力上升","屬性 紅色敵人","屬性 飄浮敵人","屬性 黑色敵人","屬性 鋼鐵敵人","屬性 天使敵人","屬性 異星戰士","屬性 不死生物","屬性 古代種","無屬性敵人","魔女","使徒","攻擊力下降無效","使動作停止無效","使動作變慢無效","打飛敵人無效","波動傷害無效","傳送無效","渾身一擊","攻擊無效","抗毒擊耐性","毒擊傷害無效","抗烈波耐性","烈波傷害無效","烈波攻擊","屬性 惡魔","破壞惡魔盾","靈魂攻擊","詛咒","攻擊間隔縮短","小波動","超生命體特效","超獸特效","小烈波","超賢者特効"];function createResIcons(res,p){var e,c,k,v,res_icon_names=["BGbyVaK","Sd55VTg","1PHovzw","kwmOdX3","WTIjQQE","kLJHD5E","1s7WKyX","sROk995","1TkV1IQ"],res_descs=["抗擊耐性（時間減少 $ %）","動止耐性（時間減少 $ %）","動慢耐性（時間減少 $ %）","抗飛耐性（距離減少 $ %）","抗波耐性（傷害減少 $ %）","抗烈波耐性（傷害減少 $ %）","抗古代詛咒耐性（時間減少 $ %）","抗毒耐性（傷害減少 $ %）","抗傳耐性"];for([k,v]of Object.entries(res))k=parseInt(k),c=document.createElement("div"),(e=new Image(40,40)).src="https://i.imgur.com/"+res_icon_names[k]+".png",c.appendChild(e),c.append(res_descs[k].replace("$",v)),p.appendChild(c)}function getTraitNames(trait){let i=0;var idxs=[];for(let x=1;x<=TB_DEMON;x<<=1)trait&x&&idxs.push(i),i++;return 1==idxs.length?"（"+["紅色敵人","飄浮敵人","黑色敵人","鋼鐵敵人","天使敵人","異星戰士","不死生物","古代種","無屬性敵人","使徒","魔女","惡魔"][idxs[0]]+"）":"（"+get_trait_short_names(trait)+"）敵人"}function createTraitIcons(trait,parent){if(trait){var e,E=document.createElement("div"),names=["BUxdmA6","GlcKsa6","XbBWQIp","fVfHaCQ","kxvTRTQ","PPpWAPy","oqVjofz","caSziI9","qOEibJt","","","hp6EvG6"];let i=0;for(let x=1;x<=TB_DEMON;x<<=1)trait&x&&((e=new Image(40,40)).src="https://i.imgur.com/"+names[i]+".png",E.appendChild(e)),++i;parent.appendChild(E)}}function createAbIcons(form,p1,p2,tbody){function w1(msg,icon){var p=document.createElement("div"),s=new Image(40,40);s.src="https://i.imgur.com/"+icon+".png",p.appendChild(s),p.append(msg),p1.appendChild(p)}function w2(msg,icon){var p=document.createElement("div"),s=new Image(40,40);s.src="https://i.imgur.com/"+icon+".png",p.appendChild(s),p.append(msg),p2.appendChild(p)}let treasure=!1,tn,du,func,i,v;function w3(msg,icon){var p=document.createElement("div"),s=(p.style.cursor="pointer",p._i=i,p.s=!1,p.onclick=function(event){event.preventDefault(),event.stopPropagation(),this.s?(this.style.removeProperty("background-color"),this.s=!1,tbody._s.delete(this._i)):(this.style.setProperty("background-color","#5cabd273","important"),this.s=!0,tbody._s.add(this._i)),updateValues(form,tbody)},new Image(40,40));s.src="https://i.imgur.com/"+icon+".png",p.appendChild(s),p.append(msg),p1.appendChild(p)}form.trait&&(tn=getTraitNames(form.trait),treasure=form.trait&trait_treasure);var U=form.pre1?"*":"";for([i,v]of Object.entries(form.ab))switch(i=parseInt(i)){case 1:func=w1,(func="2"==layout?w3:func)(`血量 ${v[0]} % 以下攻擊力上升至 ${100+v[1]} %`,"IE6ihRp");break;case 2:w1(v+" % 以1血存活一次","WcMDxXS");break;case 3:func=w1,(func="2"==layout?w3:func)(`善於攻城，對塔傷害增加 ${v[0]} % （${numStr(1+v[0]/100)} 倍）`,"xIcbDzl");break;case 4:func=w1,(func="2"==layout?w3:func)(v+" % 會心一擊"+U,"FV6We1L");break;case 5:w1("終結不死","ssOFAtR");break;case 6:w1("靈魂攻擊","z3SPEqA");break;case 7:w1(v[0]+" % 破壞護盾"+U,"LfRDAkg");break;case 8:w1(v[0]+" % 破壞惡魔盾"+U,"6wjIaUE");break;case 9:func=w1,(func="2"==layout?w3:func)(`${v[0]} % 渾身一擊${U}（攻擊力增加${v[1]} %）`,"KDpH72p");break;case 10:w1("得到很多金錢","aeG7OM3");break;case 11:w1("鋼鐵特性（爆擊、毒擊之外攻擊只會受1傷害）","MzHKigD");break;case 12:func=w1,(func="2"==layout?w3:func)(`${v[0]} % 發射 Lv. ${v[1]} 小波動`+U,"W18c1hw");break;case 13:func=w1,(func="2"==layout?w3:func)(`${v[0]} % 發射 Lv. ${v[1]} 波動`+U,"ZbPqGoj");break;case 14:func=w1,(func="2"==layout?w3:func)(`${v[0]} % 發射 Lv. ${v[4]}小烈波${U}（出現位置 ${v[1]}～${v[2]}，持續 ${numStrT(v[3])}）`,"AEITK8t");break;case 15:func=w1,(func="2"==layout?w3:func)(`${v[0]} % 發射Lv${v[4]}烈波${U}（出現位置 ${v[1]}～${v[2]}，持續 ${numStrT(v[3])}）`,"at4bW0n");break;case 16:w1("波動滅止\t","BH3LOrK");break;case 17:func=w1,(func="2"==layout?w3:func)("超生命體特效（傷害 1.6 倍、受傷害減少 30 %)","nGZanly");break;case 18:func=w1,(func="2"==layout?w3:func)(`超獸特效（對超獸敵人傷害 2.5 倍、減傷 40%、${v[0]} % 發動攻擊無效持續 ${numStrT(v[1])}）`,"yCMsSbc");break;case 19:func=w1,(func="2"==layout?w3:func)(`終結魔女	`,"ktlyJ15");break;case 20:func=w1,(func="2"==layout?w3:func)("終結使徒","y5JJJnJ");break;case 21:du=treasure?~~(v[2]*(1+treasures[23]/1500)):v[2],"2"==layout?w2(`${v[0]} % 使攻擊力下降${U}持續 ${numStrT(du)}，覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"yRkhAHL"):w2(`${v[0]} % 使${tn}攻擊力下降${U}至${v[1]} % 持續 ${numStrT(du)}，控場覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"yRkhAHL");break;case 22:du=treasure?~~(v[1]*(1+treasures[23]/1500)):v[1],"2"==layout?w2(`${v[0]} % 使動作停止持續 ${numStrT(du)} ${U}，覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"i1pP3Mi"):w2(`${v[0]} % 使 ${tn} 動作停止${U}持續 ${numStrT(du)}，控場覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"i1pP3Mi");break;case 23:du=treasure?~~(v[1]*(1+treasures[23]/1500)):v[1],"2"==layout?w2(`${v[0]} % 使動作變慢${U}持續 ${numStrT(du)}，覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"MyoCUMu"):w2(`${v[0]} % 使${tn}動作變慢${U}持續 ${numStrT(du)}，控場覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"MyoCUMu");break;case 24:w2("只能攻擊"+tn,"fe5k3Hw");break;case 25:"2"==layout?w3("善於攻擊","dlZ8xNU"):w2(`對${tn}傷害 ${treasure?numStr(orb_good_atk+1.5+(treasure?treasures[23]/1e3:0)):"1.5"} 倍，受到傷害減少 `+numStr(1/orb_good_hp*(.5+(treasure?treasures[23]/3e3:0))),"dlZ8xNU");break;case 26:"2"==layout?w3("很耐打","4em8Hzg"):w2(`受到${tn}攻擊的傷害減至 `+numStr(orb_resist/(4+(treasure?treasures[23]/300:0))),"4em8Hzg");break;case 27:"2"==layout?w3("超耐打","ck2nA1D"):w2(`受到${tn}攻擊的傷害減至 1/`+(treasure?300==treasures[23]?"7":numStr(6+treasures[23]/300):"6"),"ck2nA1D");break;case 28:"2"==layout?w3("超大傷害","RbqsryO"):w2(`對${tn}造成 ${numStr(orb_massive+(3+(treasure?treasures[23]/300:0)))} 倍傷害`,"RbqsryO");break;case 29:"2"==layout?w3("極度傷害","whTrzG1"):w2(`對${tn}造成 ${treasure?300==treasures[23]?"6":numStr(5+treasures[23]/300):"5"} 倍傷害`,"whTrzG1");break;case 30:"2"==layout?w2(v[0]+" % 打飛"+U,"cLZsanQ"):w2(v[0]+" % 打飛"+U+tn,"cLZsanQ");break;case 31:"2"==layout?w2(v[0]+" % 傳送"+U,"KkYm2Og"):w2(v[0]+" % 傳送"+U+tn,"KkYm2Og");break;case 32:w2(v[0]+" % 發動攻擊無效持續 "+numStrT(v[1]),"8Eq6vPV");break;case 33:du=treasure?~~(v[1]*(1+treasures[23]/1500)):v[1],"2"==layout?w2(`${v[0]} % 詛咒${U}持續 ${numStrT(du)}，覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"0Rraywl"):w2(`${v[0]} % 詛咒${U}${tn}持續 ${numStrT(du)}，控場覆蓋率 ${getCoverUnit(form,v[0],du)} %`,"0Rraywl");break;case 37:w1("一次攻擊","VY93npj");break;case 40:w1("烈波反擊","tchDtAr");break;case 42:w1("超賢者特效（受到超賢者的控場效果減少 70 %，增傷 120 %、減傷 50 %）","Qq8vQTs");break;case 43:w3(`召喚精靈 No.${v} 攻擊一次（同效果、能力）`,"AJYPM6p")}}function getCombinations(arr){if(!arr.length)return[];for(var combi=[],slent=2<<arr.length-1,i=0;i<slent;i++){for(var temp=[],j=0;j<arr.length;j++)i&(j?2<<j-1:1)&&temp.push(arr[j]);temp.length&&combi.push(temp)}return combi}function getAtk(form,line,theATK,parent,first,plus,attackS){function mul(arr,s,ab=!0){for(let i=0;i<arr.length;++i)(ab||form.abi&1<<2-i)&&(arr[i]*=s)}var treasure,lines=[],spec=!1,t_ef=!1,eva_ef=!1,lvc=form.lvc;for(const ab of line)switch(parseInt(ab[0])){case AB_WAVE:lines.push("波動"),mul(theATK,null!=attackS?1+ab[1]/100:2,!1);break;case AB_MINIWAVE:mul(theATK,null!=attackS?1+ab[1]/500:1.2,!1),lines.push("小波動");break;case AB_VOLC:mul(theATK,null!=attackS?1+ab[5]*ab[1]/100:1+ab[5],!1),lines.push("烈波");break;case AB_MINIVOLC:mul(theATK,null!=attackS?1+ab[5]*ab[1]/500:1+.2*ab[5],!1),lines.push("小烈波");break;case AB_GOOD:treasure=(spec=form.trait&trait_treasure&&form.trait&trait_no_treasure)?first:form.trait&trait_treasure,mul(theATK,1.5+(2<=lvc?orb_good_atk:0)+(treasure?treasures[23]/1e3:0)),lines.push("善攻"),t_ef=!0;break;case AB_CRIT:mul(theATK,null!=attackS?1+ab[1]/100:2,!1),lines.push("爆");break;case AB_STRONG:mul(theATK,1+ab[2]/100),lines.push("增攻");break;case AB_S:mul(theATK,null!=attackS?1+ab[1]*ab[2]/1e4:1+ab[2]/100,!1),lines.push("渾身");break;case AB_ATKBASE:mul(theATK,1+ab[1]/100),lines.push("塔");break;case AB_MASSIVE:mul(theATK,((treasure=(spec=form.trait&trait_treasure&&form.trait&trait_no_treasure)?first:form.trait&trait_treasure)?300==treasures[23]?4:3+treasures[23]/300:3)+(2<=lvc?orb_massive:0)),lines.push("大傷"),t_ef=!0;break;case AB_MASSIVES:mul(theATK,(treasure=(spec=form.trait&trait_treasure&&form.trait&trait_no_treasure)?first:form.trait&trait_treasure)?300==treasures[23]?6:5+treasures[23]/300:5),lines.push("極傷"),t_ef=!0;break;case AB_EKILL:lines.push("使徒"),mul(theATK,5),eva_ef=!0;break;case AB_WKILL:mul(theATK,5),lines.push("魔女"),eva_ef=!0;break;case AB_BSTHUNT:mul(theATK,2.5),lines.push("超獸"),t_ef=!0;break;case AB_BAIL:mul(theATK,1.6),lines.push("超生命體"),t_ef=!0;break;case AB_SAGE:mul(theATK,1.2),line.push("超賢者"),t_ef=!0}if(2<=lvc&&add_atk){var a=[my_cat.forms[lvc].atk,my_cat.forms[lvc].atk1,my_cat.forms[lvc].atk2];for(let i=0;i<theATK.length;++i)theATK[i]+=add_atk*a[i]}if(!eva_ef||!t_ef){let s=lines.join("・"),atkstr=(s+=":","");if(plus&&(atkstr+="+"),null!=attackS){let t=0;for(var x of theATK)t+=~~x;atkstr+=numStr(~~(t/attackS))}else{var end=theATK.length;for(let _a=0;_a<end;++_a)atkstr+=numStr(~~theATK[_a]),_a!=end-1&&(atkstr+="/")}if(s+=atkstr,spec)return first?(s+="（"+get_trait_short_names(form.trait&trait_treasure)+"）",maxLen[1]=s.length,parent.appendChild(document.createTextNode(s)),!0):(s="/"+atkstr+"（"+get_trait_short_names(form.trait&trait_no_treasure)+"）",maxLen[0]=Math.max(s.length+maxLen[1],maxLen[0]),parent.appendChild(document.createTextNode(s)),void parent.appendChild(document.createElement("br")));maxLen[0]=Math.max(s.length,maxLen[0]),parent.appendChild(document.createTextNode(s)),parent.appendChild(document.createElement("br"))}return!1}function getAtkString(form,atks,Cs,level,parent,plus,attackS){atks=atks.map(x=>~~(~~(Math.round(x*getLevelMulti(level))*atk_t)*form.atkM)),parent.textContent="";let first;var m1=new Float64Array(atks);if(2==form.lvc&&add_atk){var a=[my_cat.forms[2].atk,my_cat.forms[2].atk1,my_cat.forms[2].atk2];for(let i=0;i<m1.length;++i)m1[i]+=add_atk*a[i]}if(null!=attackS){let t=0;for(var x of m1)t+=~~x;first=numStr(~~(t/attackS))}else{first="";var end=m1.length;for(let _a=0;_a<end;++_a)first+=numStr(~~m1[_a]),_a!=end-1&&(first+="/")}if(parent.appendChild(document.createTextNode(plus?"+"+first:first)),!plus){parent.appendChild(document.createElement("br"));for(var line of Cs)getAtk(form,line,new Float64Array(atks),parent,!0,plus,attackS)&&getAtk(form,line,new Float64Array(atks),parent,!1,plus,attackS)}}function getHp(lvc,line,theHP,parent,first,trait,plus,KB){var treasure,lines=[],spec=!1,t_ef=!1,eva_ef=!1;for(const ab of line)switch(parseInt(ab[0])){case AB_GOOD:treasure=(spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure,theHP/=(2==lvc?orb_good_hp:1)*(.5-(treasure?treasures[23]/3e3:0)),lines.push("善攻"),t_ef=!0;break;case AB_RESIST:theHP*=((treasure=(spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?4+treasures[23]/300:4)/(2==lvc?orb_resist:1),lines.push("耐打"),t_ef=!0;break;case AB_RESISTS:theHP*=(treasure=(spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?6+treasures[23]/300:6,lines.push("超級耐打"),t_ef=!0;break;case AB_EKILL:lines.push("使徒"),theHP*=5,eva_ef=!0;break;case AB_WKILL:theHP*=10,lines.push("魔女"),eva_ef=!0;break;case AB_BSTHUNT:theHP/=.6,lines.push("超獸");break;case AB_BAIL:theHP/=.7,lines.push("超生命體"),t_ef=!0;break;case AB_SAGE:theHP+=theHP,t_ef=!0,lines.push("超賢者")}if(!t_ef||!eva_ef){let s=lines.join("・");s+=":",2==lvc&&1!=orb_hp&&(theHP*=2-orb_hp),theHP=numStr(~~(theHP/KB));line=plus?"+"+theHP:theHP;if(s+=line,spec)return first?(s+="（"+get_trait_short_names(trait&trait_treasure)+"）",parent.appendChild(document.createTextNode(s)),maxLen[1]=s.length,!0):(s="/"+line+"（"+get_trait_short_names(trait&trait_no_treasure)+"）",maxLen[0]=Math.max(maxLen[1]+s.length,maxLen[0]),parent.appendChild(document.createTextNode(s)),void parent.appendChild(document.createElement("br")));maxLen[0]=Math.max(s.length,maxLen[0]),parent.appendChild(document.createTextNode(s)),parent.appendChild(document.createElement("br"))}return!1}function getHpString(form,Cs,trait,level,parent,plus,KB){parent.textContent="";var hp=~~(~~(Math.round(form.hp*getLevelMulti(level))*hp_t)*form.hpM);let theHP=hp;2==form.lvc&&1!=orb_hp&&(theHP*=2-orb_hp);var line,level=numStr(~~(theHP/KB));parent.appendChild(document.createTextNode(plus?"+"+level:level)),parent.appendChild(document.createElement("br"));for(line of Cs)getHp(form.lvc,line,hp,parent,!0,trait,plus,KB)&&getHp(form.lvc,line,hp,parent,!1,trait,plus,KB)}function getHP0(form,m,S){let hp=~~(~~(Math.round(form.hp*m)*hp_t)*form.hpM);2==form.lvc&&1!=orb_hp&&(hp*=2-orb_hp);var k,t=form.trait&trait_treasure;for(k of S){form.ab[k];switch(k){case AB_GOOD:hp/=(2==form.lvc?orb_good_hp:1)*(.5-(t?treasures[23]/3e3:0));break;case AB_RESIST:hp*=(t?4+treasures[23]/300:4)/(2==form.lvc?orb_resist:1);break;case AB_RESISTS:hp*=t?6+treasures[23]/300:6;break;case AB_EKILL:hp*=5;break;case AB_WKILL:hp*=10;break;case AB_BSTHUNT:hp/=.6;break;case AB_BAIL:hp/=.7;break;case AB_SAGE:hp+=hp}}return(~~hp).toString()}function getATK0(form,m,S){var atks=[form.atk];form.atk1&&atks.push(form.atk1),form.atk2&&atks.push(form.atk2);for(let i=0;i<atks.length;++i)atks[i]=~~(~~(Math.round(atks[i]*m)*atk_t)*form.atkM);var dps=new Float64Array(atks);function mul(arr,s,ab=!0){for(let i=0;i<arr.length;++i)(ab||form.abi&1<<2-i)&&(arr[i]*=s)}var k,t=form.trait&trait_treasure;let a;for(k of S){var v=form.ab[k];switch(k){case AB_WAVE:mul(dps,1+v[0]/100,!1),mul(atks,2,!1);break;case AB_MINIWAVE:mul(dps,1+v[0]/500,!1),mul(atks,1.2,!1);break;case AB_VOLC:mul(dps,1+v[4]*v[0]/100,!1),mul(atks,1+v[4],!1);break;case AB_MINIVOLC:mul(dps,1+v[4]*v[0]/500,!1),mul(atks,1+.2*v[4],!1);break;case AB_GOOD:mul(atks,a=1.5+(2==form.lvc?orb_good_atk:0)+(t?treasures[23]/1e3:0)),mul(dps,a);break;case AB_CRIT:mul(dps,1+v/100,!1),mul(atks,2,!1);break;case AB_STRONG:mul(atks,a=1+v[1]/100),mul(dps,a);break;case AB_S:mul(dps,1+v[0]*v[1]/1e4,!1),mul(atks,1+v[1]/100,!1);break;case AB_ATKBASE:mul(atks,a=1+v[0]/100),mul(dps,a);break;case AB_MASSIVE:mul(atks,a=(t?300==treasures[23]?4:3+treasures[23]/300:3)+(2==form.lvc?orb_massive:0)),mul(dps,a);break;case AB_MASSIVES:mul(atks,a=t?300==treasures[23]?6:5+treasures[23]/300:5),mul(dps,a);break;case AB_EKILL:case AB_WKILL:mul(atks,5),mul(dps,5);break;case AB_BSTHUNT:mul(atks,2.5),mul(dps,2.5);break;case AB_BAIL:mul(atks,1.6),mul(dps,1.6);break;case AB_SAGE:mul(atks,1.2),mul(dps,1.2)}}if(2==form.lvc&&add_atk){const a=[my_cat.forms[2].atk,my_cat.forms[2].atk1,my_cat.forms[2].atk2];for(let i=0;i<atks.length;++i)a=~~(add_atk*a[i]),atks[i]+=a,dps[i]+=a}return[atks,dps]}function updateValues(form,tbl){var chs=tbl.children;if("2"==layout){let tr=chs[2].children;var m=getLevelMulti(chs[1].children[1]._v);tr[1].textContent=getHP0(form,m,tbl._s),tr[3].textContent=form.kb,tr[5].textContent=numStrT(form.attackF),tr=chs[3].children;const[atks,dps]=getATK0(form,m,tbl._s);let t="";var a,end=atks.length;for(let a=0;a<end;++a)t+=numStr(~~atks[a]),a!=end-1&&(t+="/");tr[1].textContent=t,tr[3].textContent=form.speed,"F"==_l_unit?(t=numStr(form.pre),form.pre1&&(t+="/"+numStr(form.pre1)),form.pre2&&(t+="/"+numStr(form.pre2)),tr[5].textContent=t+" F"):(t=numStr(form.pre/30),form.pre1&&(t+="/"+numStr(form.pre1/30)),form.pre2&&(t+="/"+numStr(form.pre2/30)),tr[5].textContent=t+" 秒"),tr=chs[4].children,t=0;for(a of dps)t+=~~a;tr[1].textContent=numStr(~~(30*t/form.attackF)),tr[3].textContent=form.range,tr[5].textContent=numStrT(form.backswing),(tr=chs[5].children)[1].textContent=numStr(1.5*form.price),tr[3].textContent=numStrT(getRes(form.cd)),void(tr[5].textContent=numStrT(form.tba))}else{var HPs=chs[1].children,HPPKBs=chs[2].children,ATKs=chs[3].children,DPSs=chs[4].children,m=chs[8].children,CD=chs[7].children[5],KB=chs[7].children[1],levels=(chs[7].children[3].textContent=form.speed.toString(),m[2].textContent=form.price,m[4].textContent=numStr(1.5*form.price),m[6].textContent=2*form.price,new Array(5));let lvE=chs[0].children[1],i;var attackS=form.attackF/30;for(i=0;i<lvMax;++i)levels[i]=parseInt(lvE.textContent.slice(2)),lvE=lvE.nextElementSibling;var m=Object.entries(form.ab),HCs=getCombinations(m.filter(x=>hp_mult_abs.has(parseInt(x[0]))).map(x=>Array.prototype.concat(x[0],x[1])));for(i=1;i<=5;++i)i>lvMax?HPs[i].textContent="-":getHpString(form,HCs,form.trait,levels[i-1],HPs[i],!1,1);for(getHpString(form,HCs,form.trait,1,HPs[i],!0,5),i=1;i<=5;++i)i>lvMax?HPPKBs[i].textContent="-":getHpString(form,HCs,form.trait,levels[i-1],HPPKBs[i],!1,form.kb);getHpString(form,HCs,form.trait,1,HPPKBs[i],!0,5*form.kb);const atks=[form.atk,form.atk1,form.atk2].filter(x=>x);var ACs=getCombinations(m.filter(x=>atk_mult_abs.has(parseInt(x[0]))).map(x=>Array.prototype.concat(x[0],x[1])));for(i=1;i<=5;++i)i>lvMax?ATKs[i].textContent="-":getAtkString(form,atks,ACs,levels[i-1],ATKs[i],!1);for(getAtkString(form,atks.map(x=>.2*x),ACs,1,ATKs[i],!0),i=1;i<=5;++i)i>lvMax?DPSs[i].textContent="-":getAtkString(form,atks,ACs,levels[i-1],DPSs[i],!1,attackS);getAtkString(form,atks,ACs,1,DPSs[i],!0,5*attackS),chs[6].children[1].textContent=numStrT(form.tba),chs[6].children[3].textContent=numStrT(form.backswing),chs[5].children[1].textContent=numStrT(form.attackF).replace("秒","秒/下"),38<maxLen[0]?tbl.style.fontSize="max(16px, 0.9vw)":26<maxLen[0]&&(tbl.style.fontSize="max(17px, 1vw)");var atksPre,p,m=numStrT(form.pre),tbl=(form.pre1&&(m+="/"+numStrT(form.pre1)),form.pre2&&(m+="/"+numStrT(form.pre2)),chs[5].children[3].textContent=m,chs[9].children[1]),img=(tbl.textContent="",(form.atk1||form.atk2)&&(m=form.atk2?3:2,atksPre=[form.atk,form.atk1,form.atk2].slice(0,m).map(x=>(x/(form.atk+form.atk1+form.atk2)*100).toFixed(0)+" %"),p=document.createElement("div"),(img=new Image(40,40)).src="https://i.imgur.com/veNQ90x.png",p.appendChild(img),p.append(`${m}回連續攻擊（傷害 ${atksPre.join(" / ")}）`+getAbiString(form.abi)),tbl.appendChild(p)),""),lds=(form.atkType&ATK_OMNI?img+="全方位":form.atkType&ATK_LD&&(img+="遠方"),img+=form.atkType&ATK_RANGE?"範圍攻擊":"單體攻擊",chs[5].children[6].textContent=img,form.lds),ldr=form.ldr;if(form.atkType&ATK_KB_REVENGE){const p=document.createElement("div"),img=new Image(40,40);img.src="https://i.imgur.com/KqtrO2b.png",p.appendChild(img),p.append("擊退反擊"),tbl.appendChild(p)}if(lds[0]||ldr[0]){var s="";for(let i=0;i<lds.length;++i){var x=lds[i],y=x+ldr[i];s+=x<=y?""+"①②③"[i]+x+`～${y}<br>`:""+"①②③"[i]+y+`～${x}<br>`}chs[5].children[5].innerHTML=`接觸點${form.range}<br>範圍<br>`+s.slice(0,s.length-4)}else chs[5].children[5].textContent=form.range;KB.textContent=form.kb.toString(),CD.textContent=numStrT(getRes(form.cd))}}function makeTd(parent,text=""){var c=document.createElement("td");return c.textContent=text,parent.appendChild(c),c}function updateTable(TF,tbl){updateValues(TF,tbl);tbl=tbl.children;tbl[9].children[1].textContent="",tbl[10].children[1].textContent="",tbl[11].children[1].textContent="",tbl[12].children[1].textContent="",createTraitIcons(TF.trait,tbl[9].children[1]),createImuIcons(TF.imu,tbl[10].children[1]),createResIcons(TF.res,tbl[10].children[1]),createAbIcons(TF,tbl[11].children[1],tbl[12].children[1])}function handleFocus(){this.textContent=this.textContent.match(/\d+/)[0],this.focus();var s=window.getSelection(),r=document.createRange();r.selectNodeContents(this),s.removeAllRanges(),s.addRange(r)}function handleBlur(){var num=this.textContent.match(/\d+/),arr=(num&&0<=(num=parseInt(num[0]))&&(this.L=Math.min(num,this.M)),this.textContent="Lv. "+this.L,skill_costs[this.C]);let total=0;for(let i=0;i<this.L;++i)total+=arr[i];this.N.textContent=total;var num=this.parentNode.parentNode,form=new Form(structuredClone(this.F));100<=this.I?custom_super_talents[this.I-100]=this.L:custom_talents[this.I]=this.L,form.applyTalents(my_cat.info,custom_talents),super_talent&&form.applySuperTalents(my_cat.info.talents,custom_super_talents),num._s=new Set;let td=num.children[7].children[1];td.textContent="",createImuIcons(form.imu,td),createAbIcons(form,td,td,num),form.res&&createResIcons(form.res,td),updateValues(form,num),(td=num.querySelector("#trait")).textContent="",createTraitIcons(form.trait,td)}function mkTool(tbl){tbl.style.position="relative";var node=tooltip.cloneNode(!0);node.style.position="absolute",node.style.right="-0",node.style.top="-2em",node.style.display="block",node._t=tbl,node.firstChild.onclick=function(e){const t=e.currentTarget.parentNode._t;if(null!=window.domtoimage)return drawPNG([null,t]);e=document.createElement("script");e.onload=()=>drawPNG([null,t]),e.src="dom-to-image.min.js",document.head.appendChild(e)},node.children[1].onclick=function(e){const t=e.currentTarget.parentNode._t;if(null!=window.domtoimage)return savePNG([my_cat.forms[0].name||my_cat.forms[0].jp_name,t]);e=document.createElement("script");e.onload=()=>savePNG([my_cat.forms[0].name||my_cat.forms[0].jp_name,t]),e.src="dom-to-image.min.js",document.head.appendChild(e)},tbl.appendChild(node)}function renderForm(form,lvc_text,_super=!1,hide=!1){var info=my_cat.info;if("2"==layout){const tbl=document.createElement("table");var tbody=document.createElement("tbody"),icon=(tbl.classList.add("w3-table","w3-centered"),tbl.style.maxWidth="min(80%, 1500px)",new Image(128,128));icon.src=new URL(form.icon,"https://battlecatsinfo.github.io"),icon.style.position="absolute",icon.style.left="-6px",icon.style.top="-21px",icon.style.setProperty("background-color","#0000","important");let tr=document.createElement("tr"),td=(tbody.appendChild(tr),document.createElement("td"));function add(c){let td,x=0;for(const i of c)(td=document.createElement("td")).textContent=i,tr.appendChild(td),1&++x&&td.classList.add("F");return td}td.style.position="relative",td.style.height="86px",td.style.width="120px",td.appendChild(icon),td.rowSpan=2,tr.appendChild(td),(td=document.createElement("td")).classList.add("F"),tr.appendChild(td),td.textContent="編號",td.style.padding="0",(td=document.createElement("td")).classList.add("F"),tr.appendChild(td),td.textContent="等級",td.style.padding="0",(td=document.createElement("td")).classList.add("F"),tr.appendChild(td),td.textContent=form.jp_name,td.style.padding="0",td.colSpan=4,tr=document.createElement("tr"),tbody.appendChild(tr),(td=document.createElement("td")).textContent=form.id+" - "+form.lvc,td.contentEditable=!0,td.addEventListener("focus",handleFocus),td.addEventListener("blur",function(event){var event=event.currentTarget,num=event.textContent.match(/\d+/);num&&(num=num[0],isFinite(num))&&num!=form.id?location.href="/unit.html?id="+num:event.textContent=form.id+" - "+form.lvc}),tr.appendChild(td),(td=document.createElement("td"))._l=form.lvc,td._v=Math.min(3==form.lvc?60:50,my_cat.info.maxBase+my_cat.info.maxPlus),td.textContent="Lv. "+td._v,td.contentEditable=!0,td.addEventListener("focus",handleFocus),td.addEventListener("blur",function(){var tbl=this.parentNode.parentNode,M=my_cat.info.maxBase+my_cat.info.maxPlus,num=this.textContent.match(/\d+/);if(num){num=Math.max(1,Math.min(parseInt(num[0]),M));let form=my_cat.forms[this._l];this._v!=num&&(this._v=num,my_cat.info.talents&&2<=this._l&&((form=new Form(structuredClone(form))).applyTalents(my_cat.info,custom_talents),super_talent)&&form.applySuperTalents(my_cat.info.talents,custom_super_talents),updateValues(form,tbl))}this.textContent="Lv. "+this._v}),tr.appendChild(td),(td=document.createElement("td")).colSpan=4,td.textContent=form.name,tr.appendChild(td);for(const n of tr.children)n.style.padding="0";tr=document.createElement("tr"),tbody.appendChild(tr),add(["體力","","擊退","","攻擊頻率",""]),tr=document.createElement("tr"),tbody.appendChild(tr),add(["攻擊力","","移動數度","","出招時間",""]),tr=document.createElement("tr"),tbody.appendChild(tr),add(["每秒傷害","","射程","","收招時間",""]),tr=document.createElement("tr"),tbody.appendChild(tr),add(["生產成本","","再生產","","攻擊間隔",""]),tr=document.createElement("tr"),tbody.appendChild(tr),(td=add(["攻擊對象",""])).colSpan=5,td.style.paddingLeft="0.5em",td.style.textAlign="left",(form.atk1||form.atk2)&&((icon=new Image(40,40)).src="https://i.imgur.com/veNQ90x.png",td.appendChild(icon),icon=form.atk2?3:2,atksPre=[form.atk,form.atk1,form.atk2].slice(0,icon).map(x=>(x/(form.atk+form.atk1+form.atk2)*100).toFixed(0)+" %"),td.append(`${icon}回連續攻擊（傷害 ${atksPre.join(" / ")}）`+getAbiString(form.abi)),td.appendChild(document.createElement("br")));icon="";if(tr=document.createElement("div"),icon+=form.atkType&ATK_RANGE?"範圍攻擊":"單體攻擊",form.atkType&ATK_OMNI?icon+="・全方位攻擊":form.atkType&ATK_LD&&(icon+="・遠距攻擊"),form.atkType&ATK_RANGE){var atksPre=new Image(40,40);atksPre.src="https://i.imgur.com/BeuHYlZ.png",tr.appendChild(atksPre)}else{const s=new Image(40,40);s.src="https://i.imgur.com/CZwFP3H.png",tr.appendChild(s)}if(form.atkType&ATK_LD){const s=new Image(40,40);s.src="https://i.imgur.com/fYILfa8.png",tr.appendChild(s)}if(form.atkType&ATK_OMNI){const s=new Image(40,40);s.src="https://i.imgur.com/rvGrwIL.png",tr.appendChild(s)}if(form.atkType&ATK_KB_REVENGE){const s=new Image(40,40);s.src="https://i.imgur.com/KqtrO2b.png",tr.appendChild(s)}tr.append(icon);var lds=form.lds,ldr=form.ldr;if(form.atkType&ATK_KB_REVENGE&&tr.append("・擊退反擊"),lds[0]||ldr[0]){const s=[];for(let i=0;i<lds.length;++i){const x=lds[i];var y=x+ldr[i];x<y?s.push(x+"～"+y):s.push(y+"～"+x)}tr.append("（"+s.join(", ")+"）")}td.appendChild(tr),(tr=document.createElement("div")).id="trait",td.appendChild(tr);atksPre=tr,icon=(tr=document.createElement("tr"),tbody.appendChild(tr),(td=add(["效果 ＆ 能力",""])).colSpan=5,td.style.textAlign="left",td.classList.add("A"),tr.appendChild(td),td);if(2<=form.lvc&&my_cat.info.talents){tr=document.createElement("tr"),(td=document.createElement("td")).textContent="等級",td.classList.add("f"),tr.appendChild(td),(td=document.createElement("td")).colSpan=4,td.textContent="本能",td.classList.add("f"),tr.appendChild(td),(td=document.createElement("td")).textContent="NP",td.classList.add("f"),tr.appendChild(td),tbody.appendChild(tr);let N,O;var sums=[95,75,50,165,125,75,235,175,100,150,250,285,215,325],T=my_cat.info.talents;let I=0;custom_talents=[];for(let i=0;i<112;i+=14)T[i]&&(1==T[i+13]?super_talent=!0:(N=talent_d[T[i]],tr=document.createElement("tr"),(td=document.createElement("td")).classList.add("F"),custom_talents.push(td.L=td.M=T[i+1]||1),td.textContent="Lv. "+td.L,td.C=T[i+11]-1,td.contentEditable=!0,td.F=form,td.I=I++,O=td,tr.appendChild(td),(td=document.createElement("td")).textContent=N,td.colSpan=4,tr.appendChild(td),(td=document.createElement("td")).textContent=sums[O.C],td.classList.add("F"),O.N=td,O.addEventListener("blur",handleBlur),O.addEventListener("focus",handleFocus),tr.appendChild(td),tbody.appendChild(tr)));if(super_talent){custom_super_talents=[],tr=document.createElement("tr"),(td=document.createElement("td")).textContent="等級",td.classList.add("f"),tr.appendChild(td),(td=document.createElement("td")).colSpan=4,td.textContent="超本能",td.classList.add("f"),tr.appendChild(td),(td=document.createElement("td")).textContent="NP",td.classList.add("f"),tr.appendChild(td),tbody.appendChild(tr);for(let i=I=0;i<112;i+=14)T[i]&&T[i+13]&&(N=talent_d[T[i]],tr=document.createElement("tr"),(td=document.createElement("td")).classList.add("F"),custom_super_talents.push(td.L=td.M=T[i+1]||1),td.textContent="Lv. "+td.L,td.C=T[i+11]-1,td.contentEditable=!0,td.F=form,td.I=100+I++,O=td,tr.appendChild(td),(td=document.createElement("td")).textContent=N,td.colSpan=4,tr.appendChild(td),(td=document.createElement("td")).textContent=sums[O.C],td.classList.add("F"),O.N=td,O.addEventListener("blur",handleBlur),O.addEventListener("focus",handleFocus),tr.appendChild(td),tbody.appendChild(tr))}(form=new Form(structuredClone(form))).applyTalents(my_cat.info,custom_talents),super_talent&&form.applySuperTalents(my_cat.info.talents,custom_super_talents)}return tbody._s=new Set,createTraitIcons(form.trait,atksPre),createImuIcons(form.imu,icon),form.res&&createResIcons(form.res,icon),createAbIcons(form,icon,icon,tbody),updateValues(form,tbody),tbl.appendChild(tbody),unit_content.appendChild(tbl),tbl}let x;if(2==level_count&&null!=info.upReqs){var atksPre=document.createElement("table"),td=(tables.push(["進化素材(三階)",atksPre]),mkTool(atksPre),atksPre.classList.add(".w3-table","w3-centered","fruit","w3-card-4"),form.involve&&(icon=document.createElement("tr"),(td=document.createElement("td")).colSpan=info.upReqs.length,td.innerHTML=form.involve,td.style.textAlign="center",icon.appendChild(td),atksPre.appendChild(icon)),document.createElement("tr")),tr1=document.createElement("tr");for(const r of info.upReqs){var img=new Image(128,128),div=document.createElement("td"),p=(div.style.width="128px",document.createElement("p"));r[1]?(img.src=`https://battlecatsinfo.github.io/img/r/gatyaitemD_${r[1]}_f.png`,p.textContent="×"+r[0].toString()):(img.src="https://battlecatsinfo.github.io/img/r/gatyaitemD_06_f.png",p.textContent=r[0].toString()),div.appendChild(img),div.appendChild(p),tr1.appendChild(div)}atksPre.appendChild(td),atksPre.appendChild(tr1),unit_content.appendChild(atksPre)}else if(3==form.lvc&&null!=info.f4Reqs){const container=document.createElement("table");if(tables.push(["進化素材(四階)",container]),mkTool(container),container.classList.add(".w3-table","w3-centered","fruit","w3-card-4"),info.t4){const tr=document.createElement("tr"),td=document.createElement("td");td.colSpan=info.f4Reqs.length,td.innerHTML=info.t4,td.style.textAlign="center",tr.appendChild(td),container.appendChild(tr)}const tr0=document.createElement("tr"),tr1=document.createElement("tr");for(const r of info.f4Reqs){const img=new Image(128,128),div=document.createElement("td");div.style.width="128px";p=document.createElement("p");r[1]?(img.src=`https://battlecatsinfo.github.io/img/r/gatyaitemD_${r[1]}_f.png`,p.textContent="×"+r[0].toString()):(img.src="https://battlecatsinfo.github.io/img/r/gatyaitemD_06_f.png",p.textContent=r[0].toString()),div.appendChild(img),div.appendChild(p),tr1.appendChild(div)}container.appendChild(tr0),container.appendChild(tr1),unit_content.appendChild(container)}icon=document.createElement("p");const tbl=document.createElement("table");var theadtr=document.createElement("tr"),tbodytr1=document.createElement("tr"),tbodytr2=document.createElement("tr"),tbodytr3=document.createElement("tr"),tbodytr4=document.createElement("tr"),td=document.createElement("tr"),atksPre=document.createElement("tr"),info=document.createElement("tr"),tbodytr8=document.createElement("tr"),tbodytr9=document.createElement("tr"),tbodytr10=document.createElement("tr"),tbodytr11=document.createElement("tr"),tbodytr12=document.createElement("tr"),lvc_text=(icon.innerHTML=lvc_text+(!hide&&my_cat.forms[form.lvc].desc||""),makeTd(theadtr,"等級").classList.add("f"),_super?6:1),II=4+lvc_text;for(let i=lvc_text;i<=II;++i){var e=makeTd(theadtr,"Lv"+10*i);e.classList.add("f"),e.contentEditable=!0,e._form=form,e._val=10*i,e.addEventListener("focus",handleFocus),e.addEventListener("blur",function(event){var event=event.currentTarget,tbl=event.parentNode.parentNode,M=my_cat.info.maxBase+my_cat.info.maxPlus,num=event.textContent.match(/\d+/);num?(num=Math.max(1,Math.min(parseInt(num[0]),M)),event._val=num,event.textContent="Lv"+num,updateValues(event._form,tbl)):event.textContent=event._val})}makeTd(theadtr,"每提升一級").classList.add("f"),makeTd(tbodytr1,"HP").classList.add("f");for(let i=0;i<6;++i)x=makeTd(tbodytr1,"-"),1&i&&x.classList.add("F");makeTd(tbodytr2,"硬度").classList.add("f");for(let i=0;i<6;++i)x=makeTd(tbodytr2,"-"),1&i&&x.classList.add("F");makeTd(tbodytr3,"攻擊力").classList.add("f");for(let i=0;i<6;++i)x=makeTd(tbodytr3,"-"),1&i&&x.classList.add("F");makeTd(tbodytr4,"DPS").classList.add("f");for(let i=0;i<6;++i)x=makeTd(tbodytr4,"-"),1&i&&x.classList.add("F");return makeTd(td,"攻擊頻率").classList.add("f"),makeTd(td),makeTd(td,"出招時間").classList.add("f"),makeTd(td),(x=makeTd(td,"射程")).rowSpan=2,x.classList.add("f"),makeTd(td).rowSpan=2,(x=makeTd(td)).rowSpan=3,x.classList.add("f"),makeTd(atksPre,"攻擊間隔").classList.add("f"),makeTd(atksPre),makeTd(atksPre,"收招時間").classList.add("f"),makeTd(atksPre),makeTd(info,"KB").classList.add("f"),makeTd(info),makeTd(info,"跑速").classList.add("f"),makeTd(info),makeTd(info,"再生產").classList.add("f"),makeTd(info),makeTd(tbodytr8,"召喚金額").classList.add("f"),makeTd(tbodytr8,"一章").classList.add("f"),makeTd(tbodytr8),makeTd(tbodytr8,"二章(傳說)").classList.add("f"),makeTd(tbodytr8),makeTd(tbodytr8,"三章").classList.add("f"),makeTd(tbodytr8),makeTd(tbodytr9,"攻擊對象").classList.add("f"),(x=makeTd(tbodytr9)).colSpan=6,x.style.textAlign="left",x.style.paddingLeft="0.5em",makeTd(tbodytr10,"抗性").classList.add("f"),(x=makeTd(tbodytr10)).colSpan=6,x.style.textAlign="left",x.style.paddingLeft="0.5em",makeTd(tbodytr11,"能力").classList.add("f"),(x=makeTd(tbodytr11)).colSpan=6,x.style.textAlign="left",x.style.paddingLeft="0.5em",makeTd(tbodytr12,"效果").classList.add("f"),(x=makeTd(tbodytr12)).colSpan=6,x.style.textAlign="left",x.style.paddingLeft="0.5em",tbl.appendChild(theadtr),tbl.appendChild(tbodytr1),tbl.appendChild(tbodytr2),tbl.appendChild(tbodytr3),tbl.appendChild(tbodytr4),tbl.appendChild(td),tbl.appendChild(atksPre),tbl.appendChild(info),tbl.appendChild(tbodytr8),tbl.appendChild(tbodytr9),tbl.appendChild(tbodytr10),tbl.appendChild(tbodytr11),tbl.appendChild(tbodytr12),updateValues(form,tbl),createTraitIcons(form.trait,tbodytr9.children[1]),createImuIcons(form.imu,tbodytr10.children[1]),form.res&&createResIcons(form.res,tbodytr10.children[1]),createAbIcons(form,tbodytr11.children[1],tbodytr12.children[1]),tbodytr9.children[1].children.length||(tbodytr9.style.display="none"),tbodytr10.children[1].children.length||(tbodytr10.style.display="none"),tbodytr11.children[1].children.length||(tbodytr11.style.display="none"),tbodytr12.children[1].children.length||(tbodytr12.style.display="none"),tbl.classList.add("w3-table","w3-centered"),unit_content.appendChild(icon),unit_content.appendChild(tbl),++level_count,tbl}async function applyOrb(){if(orb_attr){if(!orb_attr._loaded)return}else(orb_attr=new Image).crossOrigin="anonymous",orb_attr.src="https://cdn.discordapp.com/attachments/1148597630012768267/1153284863135326208/0.png",orb_attr.onload=function(){this._loaded=!0,applyOrb()};if(orb_eff){if(!orb_eff._loaded)return}else(orb_eff=new Image).crossOrigin="anonymous",orb_eff.src="https://cdn.discordapp.com/attachments/1148597630012768267/1153284863399563315/1.png",orb_eff.onload=function(){this._loaded=!0,applyOrb()};if(orb_gradle){if(!orb_gradle._loaded)return}else(orb_gradle=new Image).crossOrigin="anonymous",orb_gradle.src="https://cdn.discordapp.com/attachments/1148597630012768267/1153284863747707021/2.png",orb_gradle.onload=function(){this._loaded=!0,applyOrb()};orb_massive=0,orb_resist=orb_hp=1,orb_good_atk=0;var C2=[orb_good_hp=1,1,88,1,175,1,1,88,88,88],C1=[1,1,88,1,175,1,262,1,349,1,1,88,88,88,175,88,262,88,349,88];let idx;for(let i=add_atk=0;i<my_cat.info.orbC;++i){var tr=document.getElementById("orb-"+i).children,s1=tr[0].firstElementChild.selectedIndex,s2=tr[2].firstElementChild.selectedIndex,s3=tr[1].firstElementChild.selectedIndex,tr=tr[3].firstElementChild.getContext("2d");switch(tr.clearRect(0,0,85,85),s1&&(idx=s1+s1-2,tr.drawImage(orb_attr,C1[idx],C1[idx+1],85,85,0,0,85,85)),s3&&(idx=s3+s3-2,tr.drawImage(orb_eff,C2[idx],C2[idx+1],85,85,0,0,85,85)),s2&&(idx=s2+s2-2,tr.drawImage(orb_gradle,C2[idx],C2[idx+1],85,85,0,0,85,85)),s3){case 1:add_atk+=s2;break;case 2:orb_hp-=.04*s2;break;case 3:my_cat.forms[2].ab.hasOwnProperty(AB_GOOD)?(orb_good_hp-=.02*s2,orb_good_atk+=.06*s2):alert("提示：\n強化善於攻擊本能玉只能用在有善於攻擊效果的貓咪上");break;case 4:my_cat.forms[2].ab.hasOwnProperty(AB_MASSIVE)?orb_massive+=s2/10:alert("提示：\n強化超大傷害只能用在有超大傷害效果的貓咪上");break;case 5:my_cat.forms[2].ab.hasOwnProperty(AB_RESIST)?orb_resist-=.05*s2:alert("提示：\n強化很耐打本能玉只能用在有很耐打效果的貓咪上")}"2"==layout?window.orbAlerted||(window.orbAlerted=!0,alert("提示：\n如果要使用本能玉，請使用巴哈風格的表格")):((s1=new Form(structuredClone(my_cat.forms[2]))).applyTalents(my_cat.info,custom_talents),updateTable(s1,tf_tbl),tf_tbl_s&&(s1.applySuperTalents(my_cat.info.talents,custom_super_talents),updateTable(s1,tf_tbl_s)),tf4_tbl&&((tr=new Form(structuredClone(my_cat.forms[3]))).applyTalents(my_cat.info,custom_talents),updateTable(tr,tf4_tbl)))}}function renderOrbs(){var table=document.createElement("table"),tr0=document.createElement("tr"),th0=document.createElement("td");th0.colSpan=4,th0.classList.add("f"),th0.textContent=`本能玉(可裝置數量:${my_cat.info.orbC})`,tr0.appendChild(th0),table.appendChild(tr0);for(let i=0;i<my_cat.info.orbC;++i){var x,tr=document.createElement("tr"),td0=(tr.id="orb-"+i,document.createElement("td")),td1=document.createElement("td"),td2=document.createElement("td"),td3=document.createElement("td"),o0=document.createElement("select"),o1=document.createElement("select"),o2=document.createElement("select");let o;td0.classList.add("F"),td1.classList.add("F"),td2.classList.add("F"),td3.classList.add("F");for(x of["-","紅色敵人","飄浮敵人","黑色敵人","鋼鐵敵人","天使敵人","異星戰士","不死生物","古代種(暫無開放)","無屬性敵人(暫無開放)","惡魔"])(o=document.createElement("option")).textContent=x,o0.appendChild(o);for(let x of["-","D","C","B","A","S"])(o=document.createElement("option")).textContent=x,o2.appendChild(o);for(let x of["-","提升傷害","減輕傷害","強化善於攻擊","強化超大傷害","強化很耐打"])(o=document.createElement("option")).textContent=x,o1.appendChild(o);td0.appendChild(o0),td1.appendChild(o1),td2.appendChild(o2);var canvas=document.createElement("canvas");canvas.style.setProperty("background-color","transparent","important"),canvas.style.width="2.5em",canvas.style.height="2.5em",canvas.width=85,canvas.height=85,td3.appendChild(canvas),o0.selectedIndex=o1.selectedIndex=o2.selectedIndex=0,o0.oninput=o1.oninput=o2.oninput=applyOrb,tr.appendChild(td0),tr.appendChild(td1),tr.appendChild(td2),tr.appendChild(td3),table.appendChild(tr)}table.classList.add("w3-table","w3-centered","tcost","orb"),unit_content.appendChild(table)}function renderExtras(){let table=document.createElement("table"),tr=document.createElement("tr"),odd=!0,td=document.createElement("td");td.colSpan=2,td.textContent="其他資訊",td.classList.add("F"),tr.appendChild(td),table.appendChild(tr),makeTd(tr=document.createElement("tr"),"稀有度").classList.add("F"),makeTd(tr,my_cat.info.getRarityString()),table.appendChild(tr),makeTd(tr=document.createElement("tr"),"最大基本等級").classList.add("F"),makeTd(tr,my_cat.info.maxBase.toString()).classList.add("F"),table.appendChild(tr),makeTd(tr=document.createElement("tr"),"最大加值等級").classList.add("F"),makeTd(tr,"+"+my_cat.info.maxPlus.toString()),table.appendChild(tr);var a,ic=my_cat.ic.split("|");for(let i=0;i<ic.length;++i)if(ic[i]){const tr=document.createElement("tr");(td=makeTd(tr,["取得方式","二階進化","三階進化"][i])).classList.add("F"),td=makeTd(tr,ic[i]),table.appendChild(tr),odd&&td.classList.add("F"),odd=!odd}if(my_cat.info.hasOwnProperty("unclockS")&&(tr=document.createElement("tr"),(td=makeTd(tr,"解鎖關卡")).classList.add("F"),td=document.createElement("td"),a=document.createElement("a"),td.appendChild(a),a.textContent="世界篇第"+my_cat.info.unclockS%100+"關",a.href="/stage.html?s=3-9-"+(my_cat.info.unclockS-1).toString(),td.classList.add("F"),tr.appendChild(td),table.appendChild(tr),odd&&td.classList.add("F"),odd=!odd),my_cat.info.hasOwnProperty("unclockFood")&&(tr=document.createElement("tr"),(td=makeTd(tr,my_cat.info.rarity?"購買所需貓罐頭":"購入XP")).classList.add("F"),td=makeTd(tr,my_cat.info.unclockFood),table.appendChild(tr),odd&&td.classList.add("F"),odd=!odd),my_cat.info.hasOwnProperty("obtain")){var id,list=["Cat_Capsules","Rare_Cats","Super_Rare_Cats","Grandon_Mining_Corps","Neneko_and_Gang","Reinforcements","Brainwashed_Cats","Crazed_Cats","Killer_Cats","Li_l_Cats","Purchasable_Special_Cats","Main_Chapters_Unlockable","Legend_Chapters_Unlockable","Heavenly_Tower_Unlockable","Advent_and_Cyclone_Drops","Ancient_Eggs","Monthly_Event_Cats","Uberfest","Epicfest","10th_Anniversary_Memorial","11th_Anniversary_Memorial","Heartbeat_Catcademy","Lunar_New_Year(Japan)","Lunar_New_Year(Chinese)","June_Bride_of_the_Devil","Summer_Break_Cats","Monster_Hunter","Bikkuriman_Collaboration","JRA_Collaboration","Nebaaru-kun_and_Nyanpazuru","What_s_in_the_Box","Tales_of_the_Nekoluga","The_Dynamites","Sengoku_Wargods_Vajiras","Cyber_Academy_Galaxy_Gals","Lords_of_Destruction_Dragon_Emperors","Ancient_Heroes_Ultra_Souls","Justice_Strikes_Back__Dark_Heroes","The_Almighties_The_Majestic_Zeus","Frontline_Assault_Iron_Legion","Nature_s_Guardians_Elemental_Pixies","Girls___Monsters__Angels_of_Terror","Valentine_Gals","White_Day","Easter_Carnival","June_Bride","Gals_of_Summer","Halloween_Capsules","Xmas_Gals","BUSTERFEST","Red_Busters","Air_Busters","Metal_Busters","Wave_Busters","Colossus_Busters","Dynasty_Fest","Royal_Fest","Princess_Punt","Merc_Storia","Survive__Mola_Mola_","Shoumetsu_Toshi","Metal_Slug_Defense","Puella_Magi_Madoka_Magica","Crash_Fever","Fate_Stay_Night__Heaven_s_Feel","Power_Pro_Baseball","Neon_Genesis_Evangelion","Neon_Genesis_Evangelion_2nd","Bikkuriman","Street_Fighter_V_BLUE_TEAM","Street_Fighter_V_RED_TEAM","Hatsune_Miku","Ranma_1_2","Castle___Dragon","River_City_Clash_Red_Team","River_City_Clash_White_Team"],nlist=["貓咪轉蛋+","常駐稀有貓","常駐激稀有貓","土龍鑽部隊","限定激稀有系列","貓咪軍團支援隊","洗腦貓","狂亂貓","殺意貓","招福轉蛋","EX罐頭購買貓","世界/未來/宇宙/魔界掉落貓","傳說關卡掉落貓","風雲貓咪塔掉落貓","降臨和漩渦關卡掉落","遠古的蛋","月份貓","超級貓咪祭","特級貓咪祭","日文版10週年紀念轉蛋","日文版11週年紀念轉蛋","心動時分貓咪學園活動轉蛋","春節活動轉蛋(日)","春節活動轉蛋(繁中版)"," 惡魔的完美新娘活動轉蛋","貓咪的暑假活動轉蛋","魔物獵人大狩獵活動轉蛋","聖魔大戰活動轉蛋","G1競馬活動轉蛋","貓咪拼圖&納豆君(暫譯)活動轉蛋","九週年活動轉蛋","傳說中的不明貓一族","超激烈爆彈","戰國武神巴薩拉斯","電腦學園銀河美少女","超破壞大帝龍皇因佩拉斯","超古代勇者超級靈魂勇者","逆襲的戰士黑暗英雄","究極降臨巨神宙斯","革命軍隊鋼鐵戰團","古靈精怪元素小精靈","絕命美少女怪物萌娘隊","情人節淑女們","白色情人節轉蛋","復活節嘉年華","完美新娘","夏日美少女團","萬聖節轉蛋","聖誕美少女","破壞者祭","紅色破壞者","漂浮破壞者","鋼鐵破壞者","波動破壞者","超生命體破壞者","超國王祭","女王祭","公主踢騎士Sweets","梅露可物語","活下去！曼波魚！","消滅都市","越南大戰DEFENSE","魔法少女小圓","Crash Fever","劇場版 Fate/stay night","實況野球","福音戰士合作轉蛋","福音戰士合作轉蛋2nd","聖魔大戰","快打旋風V CE合作轉蛋 BLUE TEAM","快打旋風V CE合作轉蛋 RED TEAM","初音未來","亂馬1/2","城與龍","熱血！大運動會 紅隊","熱血！大運動會 白隊"];for(id of my_cat.info.obtain){tr=document.createElement("tr"),(td=makeTd(tr,"轉蛋")).classList.add("F"),td=document.createElement("td");const a=document.createElement("a");a.textContent=nlist[id],a.href="/gacha/"+list[id]+".html",td.appendChild(a),tr.appendChild(td),table.appendChild(tr),odd&&td.classList.add("F"),odd=!odd}}if(my_cat.info.hasOwnProperty("rw")){tr=document.createElement("tr"),td=makeTd(tr,"破關掉落"),(td=document.createElement("td")).textContent="通過「";const a=document.createElement("a");td.classList.add("F");var s=my_cat.info.rw.split("|");a.textContent=s[3],a.href="/stage.html?s="+s.slice(0,3).join("-"),td.appendChild(a),td.append("」"),tr.appendChild(td),table.appendChild(tr),odd&&td.classList.add("F"),odd=!odd}if(my_cat.info.hasOwnProperty("tf")){tr=document.createElement("tr"),(td=makeTd(tr,"進化條件")).classList.add("F"),(td=document.createElement("td")).textContent="通過「";const a=document.createElement("a"),s=my_cat.info.tf.split("|");a.textContent=s[3],a.href="/stage.html?s="+s.slice(0,3).join("-"),td.appendChild(a),td.append("」"),tr.appendChild(td),table.appendChild(tr),odd&&td.classList.add("F"),odd=!odd}my_cat.info.version&&(a=my_cat.info.version.toString(),(s=document.createElement("div")).textContent=`Ver ${parseInt(a.slice(0,2))}.${parseInt(a.slice(2,4))}.${parseInt(a.slice(4))} 新增`,s.classList.add("r-ribbon"),document.body.appendChild(s)),table.classList.add("w3-table","w3-centered","tcost"),unit_content.appendChild(table)}function getTalentInfo(talent){function range(f="%",start=2){var end=start+1;return[talent[start].toString()+f,talent[end].toString()+f,talent[1].toString(),numStr((talent[end]-talent[start])/(talent[1]-1))+f]}var snd=talent[4]!=talent[5];switch(talent[0]){case 1:return talent[6]!=talent[7]?range("%",6):snd?range("F",4):range();case 2:case 3:return snd?range("F",4):range();case 8:return range("%");case 10:case 11:return snd?range("%",4):range();case 13:return snd?range("%",4):void 0;case 15:return snd?range("%",4):range();case 17:if(snd)return range("%",4);case 18:case 19:case 20:case 21:case 22:case 30:case 31:case 32:case 27:case 24:case 52:case 54:case 58:case 61:return range();case 25:return[numStr(1.5*talent[2]),numStr(1.5*talent[3]),talent[1],numStr(1.5*talent[2])];case 26:return range("F");case 28:return range("");case 50:return snd?range("%",4):range();case 51:return snd?range("F",4):range();case 56:return talent[8]!=talent[9]?range("%",8):talent[6]!=talent[7]?range("%",6):snd?range("%",4):range();case 60:return snd?range("F",4):range();case 62:return snd?range("",4):range();case 65:return talent[8]!=talent[9]?range("%",8):talent[6]!=talent[7]?range("%",6):snd?range("",4):range()}}function rednerTalentInfos(talents,_super=!1){var table=document.createElement("table"),tr1=document.createElement("tr"),td0=document.createElement("td"),td0=(tables.push([td0.textContent=(_super?"超":"")+"本能解放",table]),mkTool(table),td0.colSpan=5,td0.classList.add("f"),tr1.appendChild(td0),table.appendChild(tr1),document.createElement("tr")),tr1=document.createElement("td"),td2=document.createElement("td"),td3=document.createElement("td"),td4=document.createElement("td"),td5=document.createElement("td"),infos=(tr1.textContent=my_cat.forms[2].name||my_cat.forms[2].jp_name,tr1.classList.add("f"),td3.classList.add("F"),td5.classList.add("F"),td2.textContent="Lv1",td3.textContent="Lv10",td4.textContent="最高等級",td5.textContent="每提升一級",td0.appendChild(tr1),td0.appendChild(td2),td0.appendChild(td3),td0.appendChild(td4),td0.appendChild(td5),table.appendChild(td0),[]);let O=!0;for(let i=0;i<112&&talents[i];i+=14)if(_super==(1==talents[i+13])){var info=getTalentInfo(talents.subarray(i,i+14)),name=talent_d[talents[i]],tr=(infos.push(name),document.createElement("tr"));if(null!=info){let td=document.createElement("td"),odd=(td.classList.add("f"),td.textContent=name,tr.appendChild(td),tr.appendChild(td),!1);for(var s of info)td=document.createElement("td"),odd&&td.classList.add("F"),odd=!odd,td.textContent=s,tr.appendChild(td);td.textContent="+"+td.textContent}else{var info=document.createElement("td"),t2=document.createElement("td");info.textContent="能力新增",O&&t2.classList.add("f"),O=!O,t2.textContent=name,t2.colSpan=4,info.classList.add("f"),tr.appendChild(info),tr.appendChild(t2)}table.appendChild(tr)}return table.classList.add("w3-table","w3-centered","tcost"),unit_content.appendChild(table),infos}function calcCost(event){var t=event.currentTarget,idx=Array.prototype.indexOf.call(t.parentNode.children,t),event=t.parentNode.parentNode;let i=0;t.classList.add("o-selected");for(const e of event.children){var x=e.children[idx];x&&(x==t?t._super?custom_super_talents[idx-1]=i-1:custom_talents[idx-1]=i-1:x.classList.contains("o-selected")&&x.classList.remove("o-selected"),++i)}let e=event.children[2];for(var costs=new Uint16Array(e.children.length-1),selectMap=new Uint8Array(costs.length);;){var chs=e.children,c=chs[0].textContent;if("無"!=c&&-1==c.indexOf("Lv"))break;for(let j=1;j<=costs.length;++j)selectMap[j-1]||(costs[j-1]+=parseInt(chs[j].textContent.replace("-","0"))),chs[j].classList.contains("o-selected")&&(selectMap[j-1]=1);e=e.nextElementSibling}var cis=e.children;for(let j=1;j<=costs.length;++j)cis[j].textContent=costs[j-1];e.nextElementSibling.firstElementChild.textContent="共"+costs.reduce((a,b)=>a+b,0);event=new Form(structuredClone(my_cat.forms[2]));event.applyTalents(my_cat.info,custom_talents),updateTable(event,tf_tbl),t._super&&event.applySuperTalents(my_cat.info.talents,custom_super_talents),tf_tbl_s&&updateTable(event,tf_tbl_s)}function renderTalentCosts(talent_names,talents,_super=!1){var table=document.createElement("table"),th=document.createElement("tr");const td0=document.createElement("td");mkTool(table),table.style.userSelect="none",td0.textContent="消耗NP一覽",td0.classList.add("f"),th.appendChild(td0);var names=[],costs=[],maxLvs=[];let c=0;for(let i=0;i<112&&talents[i];i+=14)_super==(1==talents[i+13])&&(names.push(talent_names[c]),costs.push(talents[i+11]-1),maxLvs.push(talents[i+1]||1),++c);_super?custom_super_talents=maxLvs:custom_talents=maxLvs;var tr1=document.createElement("tr"),td1=(td0.colSpan=names.length+1,document.createElement("td"));td1.textContent="等級",td1.classList.add("f"),tr1.appendChild(td1);for(let i=0;i<names.length;++i){var td=document.createElement("td");td.classList.add("f"),td.textContent=names[i],tr1.appendChild(td)}var tr2=document.createElement("tr");for(let i=0;i<=names.length;++i){const td=document.createElement("td");td.textContent=0==i?"無":"0",i||td.classList.add("f"),td.addEventListener("click",calcCost),td._super=_super,tr2.appendChild(td)}table.appendChild(th),table.appendChild(tr1),table.appendChild(tr2);for(let i=1;i<=10;++i){var tr=document.createElement("tr");const td0=document.createElement("td");td0.textContent="Lv"+i.toString(),td0.classList.add("f"),tr.appendChild(td0);for(let j=0;j<names.length;++j){const td=document.createElement("td");var tbl=skill_costs[costs[j]];1&i&&td.classList.add("F"),td.textContent=i>maxLvs[j]?"-":tbl[i-1],tr.appendChild(td),"-"!=td.textContent&&td.addEventListener("click",calcCost),td._super=_super}table.appendChild(tr)}var trend=document.createElement("tr"),td1=document.createElement("td");td1.textContent="總計",td1.classList.add("f"),td1.rowSpan=2;let total=0;trend.appendChild(td1);for(let i=0;i<costs.length;++i){const td=document.createElement("td");let s=0;for(let j=0;j<maxLvs[i];++j)s+=skill_costs[costs[i]][j];td.textContent=s.toString(),total+=s,td.classList.add("F"),trend.appendChild(td)}table.appendChild(trend);th=document.createElement("tr"),td1=document.createElement("td");td1.colSpan=names.length,td1.textContent="共"+total.toString(),td1.classList.add("f"),th.appendChild(td1),table.appendChild(th),table.classList.add("w3-table","w3-centered","tcost"),unit_content.appendChild(table)}function renderCombos(){var limits=["世界篇第一章","世界篇第二章","世界篇第三章","未來篇第一章","未來篇第二章","未來篇第三章","宇宙篇第一章","宇宙篇第二章","宇宙篇第三章"],combo_f=["角色攻擊力 +$ %","角色體力 +$ %","角色移動速度 +$ %","初期貓咪砲能量值 +$ 格","初期工作狂貓等級 +$","初期所持金額 $ 元","貓咪砲攻擊力 +$ %","貓咪砲充電速度加快 $f","工作狂貓的工作效率 +$ %","工作狂貓錢包 +$ %","城堡耐久力 +$ %","研究力 -$ %（10 % = 26.4 F）","會計能力 +$ %","學習力 +$ %","「善於攻擊」的效果 +$ %","「超大傷害」的效果 +$ %","「很耐打」的效果 +$ %","「打飛敵人」的效果 +$ %","「使動作變慢」的效果 +$ %","「使動作停止」的效果 +$ %","「攻擊力下降」的效果 +$ %","「攻擊力上升」的效果 +$ %","「終結魔女」的效果 +$ %","「終結使徒」的效果 +$ %","「會心一擊」的發動率 +$ %"],combo_params=[[10,15,20,30],[10,20,30,50],[10,15,20,30],[2,4,6,10],[1,2,3,4],[300,500,1e3,2e3],[20,50,100,200],[20,30,40,50],[10,20,30,50],[10,20,30,50],[20,50,100,200],[10,20,30,40,50],[10,20,30,50],[10,15,20,30],[10,20,30,50],[10,20,30,50],[10,20,30,50],[10,20,30,50],[10,20,30,50],[10,20,30,50],[10,20,30,50],[20,30,50,100],[400,400,400,400,400],[400,400,400,400,400],[1,2,3,4]],table=document.createElement("table");for(let j=0;j<combos.length;++j){var C=combos[j],units=C[3];for(let i=0;i<units.length;i+=2)if(my_id==units[i]){var tr=document.createElement("tr"),type=C[1],lv=C[2],td=document.createElement("td"),p=document.createElement("p"),p2=document.createElement("p"),p3=document.createElement("p3"),a=(p3.style.fontSize="smaller",td.appendChild(p),td.appendChild(p2),document.createElement("a"));a.href="/combos.html#"+C[0],a.textContent=C[0],a.style.textDecoration="none",p.appendChild(a),p2.textContent=combo_f[type].replace("$",combo_params[type][lv])+"【"+["小","中","大","究極"][lv]+"】",tr.appendChild(td),1e4<C[4]?(p3.textContent="等排"+[2700,1450,2150][C[4]-10001],td.appendChild(p3)):1<C[4]&&(p3.textContent=""+limits[C[4]-1],td.appendChild(p3));for(let c=0;c<units.length;c+=2){const td=document.createElement("td");var img=new Image,my_id_str=t3str(units[c]),form_str="fcsu"[units[c+1]];const a=document.createElement("a");a.href="./unit.html?id="+units[c].toString(),img.src=`/img/u/${my_id_str}/${form_str}/uni${my_id_str}_${form_str}00.png`,a.appendChild(img),td.appendChild(a),tr.appendChild(td)}table.appendChild(tr);break}}if(table.children.length){table.classList.add("w3-table","w3-centered","combo");const p=document.createElement("p");p.textContent="聯組資訊",unit_content.appendChild(p),unit_content.appendChild(table)}}function renderUintPage(){if("2"===layout)for(var form of my_cat.forms){if(2==form.lvc&&my_cat.info.upReqs){var container=document.createElement("table"),td=(tables.push(["進化素材(三階)",container]),mkTool(container),container.style.marginBottom="60px",container.classList.add(".w3-table","w3-centered","fruit","w3-card-4"),my_cat.forms[2].involve&&(tr=document.createElement("tr"),(td=document.createElement("td")).colSpan=my_cat.info.upReqs.length,td.innerHTML=my_cat.forms[2].involve,td.style.textAlign="center",tr.appendChild(td),container.appendChild(tr)),document.createElement("tr")),tr1=document.createElement("tr");for(const r of my_cat.info.upReqs){var img=new Image(128,128),div=document.createElement("td"),p=(div.style.width="128px",document.createElement("p"));r[1]?(img.src=`https://battlecatsinfo.github.io/img/r/gatyaitemD_${r[1]}_f.png`,p.textContent="×"+r[0].toString()):(img.src="https://battlecatsinfo.github.io/img/r/gatyaitemD_06_f.png",p.textContent=r[0].toString()),div.appendChild(img),div.appendChild(p),tr1.appendChild(div)}container.appendChild(td),container.appendChild(tr1),unit_content.appendChild(container)}else if(3==form.lvc){const container=document.createElement("table");if(tables.push(["進化素材(四階)",container]),mkTool(container),container.style.marginBottom="60px",container.classList.add(".w3-table","w3-centered","fruit","w3-card-4"),my_cat.info.t4){const tr=document.createElement("tr"),td=document.createElement("td");td.colSpan=my_cat.info.f4Reqs.length,td.innerHTML=my_cat.info.t4,td.style.textAlign="center",tr.appendChild(td),container.appendChild(tr)}const tr0=document.createElement("tr"),tr1=document.createElement("tr");for(const r of my_cat.info.f4Reqs){const img=new Image(128,128),div=document.createElement("td");div.style.width="128px";p=document.createElement("p");r[1]?(img.src=`https://battlecatsinfo.github.io/img/r/gatyaitemD_${r[1]}_f.png`,p.textContent="×"+r[0].toString()):(img.src="https://battlecatsinfo.github.io/img/r/gatyaitemD_06_f.png",p.textContent=r[0].toString()),div.appendChild(img),div.appendChild(p),tr1.appendChild(div)}container.appendChild(tr0),container.appendChild(tr1),unit_content.appendChild(container)}var tr=renderForm(form);tables.push([["一","二","三","四"][form.lvc]+"階數值表格",tr]),mkTool(tr)}else{for(let form of my_cat.forms){const img=new Image;img.src=form.icon,cat_icons.appendChild(img)}var zh=["一","二","三"];for(let i=0;i<my_cat.forms.length&&3!=i;++i){const tbl=renderForm(my_cat.forms[i],zh[i]+"階：<br>");tables.push([zh[i]+"階數值表格",tbl]),mkTool(tbl)}if(my_cat.info.talents){unit_content.appendChild(document.createElement("hr"));var TF=new Form(structuredClone(my_cat.forms[2])),_super=(renderTalentCosts(rednerTalentInfos(my_cat.info.talents),my_cat.info.talents),TF.applyTalents(my_cat.info,custom_talents));if(tf_tbl=renderForm(TF,"本能完全升滿的數值表格",!1,!0),tables.push(["三階+本能數值表格",tf_tbl]),mkTool(tf_tbl),_super){unit_content.appendChild(document.createElement("hr"));const names=rednerTalentInfos(my_cat.info.talents,!0,!0);renderTalentCosts(names,my_cat.info.talents,!0),TF.applySuperTalents(my_cat.info.talents,custom_super_talents),tf_tbl_s=renderForm(TF,"超本能完全升滿的數值表格",!0,!0),tables.push(["三階+超本能數值表格",tf_tbl_s]),mkTool(tf_tbl_s)}4==my_cat.forms.length&&((_super=new Form(structuredClone(my_cat.forms[3]))).applyTalents(my_cat.info,custom_talents),tf4_tbl=renderForm(_super,"四階：<br>",!0),tables.push(["四階+本能數值表格",tf4_tbl]),mkTool(tf4_tbl))}}my_cat.info.orbC&&renderOrbs(),renderExtras(),renderCombos()}function copyTree(node){switch(node.tagName){case"TABLE":buf=(buf+="[font=")+opt_f+"][table width=98% cellspacing=1 cellpadding=1 border=1 align=center]";for(var t of node.children)copyTree(t);return void(buf+="[/table][/font]");case"DIV":case"TBODY":for(let t of node.children)copyTree(t);return;case"TR":if("none"==node.style.display)return;buf+="[tr]";for(let t of node.children)copyTree(t);return void(buf+="[/tr]");case"TD":6==node.colSpan&&"center"!=node.style.textAlign?buf+="[td align=left colspan=6]":1<node.rowSpan||1<node.colSpan?(node.style.textAlign?buf+="[td align="+node.style.textAlign+" ":buf+="[td align=center ",1<node.rowSpan&&(buf+=" rowspan="+node.rowSpan.toString()),1<node.colSpan&&(buf+=" colspan="+node.colSpan.toString()),buf+="]"):node.style.textAlign?buf+="[td align="+node.style.textAlign+"]":buf+="[td align=center]",opt_b&&(buf+="[b]");for(let t of node.childNodes)switch(t.tagName){case void 0:buf+=t.textContent;continue;case"P":buf+="[div align=center]"+t.textContent+"[/div]";continue;case"BR":buf+="\n";continue;case"IMG":buf+="[img="+encodeURI(t.src)+"]";continue;case"DIV":for(var n of t.childNodes)copyTree(n);buf+="\n";continue;case"SPAN":buf+=t.textContent;continue}return opt_b&&(buf+="[/b]"),void(buf+="[/td]");case"IMG":return void(buf+="[img="+encodeURI(node.src)+"]");case void 0:case"SPAN":return void(buf+=node.textContent);default:console.error(node)}}function drawgraph(T){const canvas=document.createElement("canvas"),lvs=(modal_content.appendChild(canvas),my_cat.info.maxBase+my_cat.info.maxPlus);if(T){const select=document.createElement("select");select.classList.add("w3-select");for(let i=0;i<my_cat.forms.length;++i){var o=document.createElement("option");o.textContent=["一階","二階","三階"][i],select.appendChild(o)}select.selectedIndex=0,modal_content.appendChild(select);let C,labels=[],datas=[];(select.onchange=function(){switch(labels.length=0,datas.length=0,T){case 1:for(let level=0;level<=lvs;level+=5){var hp=~~(2.5*Math.round(my_cat.forms[select.selectedIndex].hp*getLevelMulti(level||1)));labels.push("Lv"+(level||1)),datas.push(hp)}break;case 2:for(let level=0;level<=lvs;level+=5){var t=my_cat.forms[select.selectedIndex],t=~~(2.5*Math.round((t.atk+t.atk1+t.atk2)*getLevelMulti(level||1)));labels.push("Lv"+(level||1)),datas.push(t)}break;case 3:for(let level=0;level<=lvs;level+=5){let t=my_cat.forms[select.selectedIndex];const atk=~~(2.5*Math.round((t.atk+t.atk1+t.atk2)*getLevelMulti(level||1)));labels.push("Lv"+(level||1)),datas.push(30*atk/t.attackF)}}if(C)return C.update();C=new Chart(canvas,{type:"line",data:{labels:labels,datasets:[{label:["血量","攻擊力","DPS"][T-1],data:datas}]},options:{scales:{y:{beginAtZero:!0}}}})})()}else{var labels=[];for(let i=0;i<=lvs;i+=10)labels.push("Lv"+i);new Chart(canvas,{type:"line",data:{labels:labels,datasets:[{label:"每提升一級 成長Lv1的百分比",data:_curves[my_cat.curve].slice(0,1+~~(lvs/10)),borderWidth:1,pointStyle:"rect",pointRadius:8,pointHoverRadius:10,stepped:"before"}]},options:{scales:{y:{beginAtZero:!0}}}})}}function makegraph(T){if(modal_content.textContent="",modal.style.display="block",document.getElementById("chart-js"))return drawgraph(T);var script=document.createElement("script");script.id="chart-js",script.onload=()=>drawgraph(T),script.src="https://cdn.jsdelivr.net/npm/chart.js",document.head.appendChild(script)}function xpgraph(){modal_content.textContent="";var table=document.createElement("table");table.classList.add("w3-centered","w3-table");let td,tr=document.createElement("tr");for(let i=0;i<12;++i){const td=document.createElement("td");td.textContent=1&i?"XP":"Level",tr.appendChild(td)}table.appendChild(tr);var datas=my_cat.info.xp_data.split(",").map(x=>parseInt(x)),curve=[1,2,3,3.5,4,4.5],costs=new Uint32Array(60);for(let i=0;i<datas.length;++i)costs[i]=datas[i];for(let i=1;i<=5;++i)for(let j=0;j<10;++j)costs[10*i+j]=costs[j]*curve[i];costs[0]=0;for(let i=1;i<=10;++i){tr=document.createElement("tr");var sum=0;for(let j=0;j<12;j+=2){var td1=document.createElement("td"),td2=document.createElement("td"),idx=i+5*j;td1.innerText=idx,td2.innerText=costs[idx-1].toString(),sum+=costs[idx-1],tr.appendChild(td1),tr.appendChild(td2),1&i&&(tr.style.backgroundColor="rgb(241, 241, 241)")}table.appendChild(tr)}var x,sums=[],totalSum=0;tr=document.createElement("tr");for(let j=0;j<12;j+=2){sum=0;let i=j/2,td1=document.createElement("td"),td2=document.createElement("td");td1.innerText=10*i+"-"+10*(i+1);for(var end=(i*=10)+10;i<end;++i)sum+=costs[i];td2.innerText=sum.toString(),sums.push(totalSum+=sum),tr.appendChild(td1),tr.appendChild(td2)}table.appendChild(tr),tr=document.createElement("tr");for(let j=0;j<12;j+=2){var sum=0,i=j/2;let td1=document.createElement("td"),td2=document.createElement("td");td1.innerText="Total",td2.innerText=sums[i].toString(),tr.appendChild(td1),tr.appendChild(td2)}table.appendChild(tr);let odd=!0;for(x of table.children)odd&&x.classList.add("odd"),odd=!odd;modal_content.appendChild(table),modal.style.display="block"}function ImgCut(){modal_content.textContent="";var s=t3str(my_id);for(let i=0;i<my_cat.forms.length;++i){var c,url=new URL("https://battlecatsinfo.github.io/anim/imgcut.html"),p=(my_cat.forms[i].icon.startsWith("/img/s")?(c=my_cat.forms[i].icon.slice(7,10),url.searchParams.set("imgfile",`/img/s/${c}/${c}_m.png`),url.searchParams.set("cutfile",`/img/s/${c}/${c}_m.imgcut`)):(c="fcsu"[i],url.searchParams.set("imgfile",`/img/u/${s}/${c}/${s}_${c}.png`),url.searchParams.set("cutfile",`/data/unit/${s}/${c}/${s}_${c}.imgcut`)),document.createElement("button")),a=document.createElement("a");p.style.display="block",p.style.margin="0 auto",p.classList.add("w3-btn",["w3-deep-purple","w3-teal","w3-green"][i]),p.style.marginBottom="1em",a.href=url.href,a.textContent=["一階","二階","三階"][i],a.style.textDecoration="none",a.style.setProperty("color","white","important"),p.appendChild(a),modal_content.appendChild(p)}modal.style.display="block"}function savePNG(tbl,e){tbl[1].style.margin="0",domtoimage.toBlob(tbl[1]).then(function(blob){var a=document.createElement("a"),blob=window.URL.createObjectURL(blob);a.href=blob,a.download=tbl[0],a.click(),URL.revokeObjectURL(blob),tbl[1].style.margin=""}),e&&(e.textContent="下載成功！",setTimeout(()=>e.textContent="複製",1e3))}function drawPNG(tbl,e){tbl[1].style.margin="0",domtoimage.toBlob(tbl[1]).then(function(blob){navigator.clipboard.write([new ClipboardItem({"image/png":blob})]),tbl[1].style.margin=""}),e&&(e.textContent="複製成功！",setTimeout(()=>e.textContent="複製",1e3))}function openBBCode(){modal_content.textContent="";let e=document.createElement("p"),select=(e.textContent="複製表格",modal_content.appendChild(e),document.createElement("select")),p=document.createElement("p"),s2=(p.style.margin="0 auto",p.style.textAlign="center",(e=document.createElement("p")).textContent="選擇動作",modal_content.appendChild(e),document.createElement("select"));for(var x of["複製巴哈原始碼(BBCode)","複製圖片","下載圖片"])(e=document.createElement("option")).textContent=x,s2.appendChild(e);s2.style.padding="0.2em",s2.style.minWidth="12em",s2.style.textAlign="center",s2.style.margin="0.5em",p.appendChild(s2),p.appendChild(document.createElement("br"));for(const x of tables){var o=document.createElement("option");o.textContent=x[0],select.appendChild(o)}select.style.padding="0.2em",select.style.minWidth="10em",select.style.textAlign="center",p.appendChild(select),p.appendChild(document.createElement("br"));const select2=document.createElement("select");for(var font of["新細明體","細明體","標楷體","微軟正黑體","Arial","Arial Black","Comic Sans MS","Courier New","MS Mincho","Symbol","Tahoma","Times New Roman","Verdana"]){const o=document.createElement("option");o.textContent=font,o.style.fontFaimly=`'${font}'`,select2.appendChild(o)}select2.style.marginTop="1em",select2.style.padding="0.2em",select2.style.width="10em",select2.style.textAlign="center",p.appendChild(select2),select2.selectedIndex=3;const check=document.createElement("input");check.id="opt-bold",check.type="checkbox",check.style.margin="1em auto",check.style.width="2em",(e=document.createElement("label")).htmlFor="opt-bold",e.textContent="使用粗體",p.appendChild(document.createElement("br")),p.appendChild(check),p.appendChild(e),modal_content.appendChild(p),(p=document.createElement("p")).style.margin="1em auto",p.style.textAlign="center",e=document.createElement("button"),p.appendChild(e),e.classList.add("w3-btn","w3-cyan"),e.onclick=function(){const tbl=tables[select.selectedIndex];var script;if(1==s2.selectedIndex||2==s2.selectedIndex)return script=document.createElement("script"),null!=window.domtoimage?(2==s2.selectedIndex?savePNG:drawPNG)(tbl,e):(2==s2.selectedIndex?script.onload=()=>savePNG(tbl,e):script.onload=()=>drawPNG(tbl,e),script.src="dom-to-image.min.js",void document.head.appendChild(script));buf=`[div align=center][b]${tbl[0]}[/b][/div]
`,opt_b=check.checked,opt_f=select2.value,copyTree(tbl[1]),navigator.clipboard?navigator.clipboard.writeText(buf).then(()=>e.textContent="複製成功！",setTimeout(()=>e.textContent="複製",1e3)):((script=document.createElement("textarea")).value=buf,script.style.position="fixed",script.style.top=script.style.left="0",document.body.appendChild(script),script.focus(),script.select(),document.execCommand("copy"),e.textContent="複製成功！",setTimeout(()=>e.textContent="複製",1e3),document.body.removeChild(script))},e.textContent="複製",modal_content.appendChild(p),modal.style.display="block"}loadCat(my_id).then(res=>{my_cat=res,useCurve(my_cat.curve);var res=my_cat.forms.map(x=>x.jp_name).filter(x=>x).join(" → "),cat_names=my_cat.forms.map(x=>x.name).filter(x=>x).join(" → "),res=("2"!=layout&&(document.getElementById("ch_name").textContent=cat_names,document.getElementById("jp_name").textContent=res),lvMax=Math.min(my_cat.info.maxBase+my_cat.info.maxPlus,50)/10,renderUintPage(),document.getElementById("loader").style.display="none",document.getElementById("loader-text").style.display="none",document.getElementById("main").style.display="block",document.title=cat_names.replaceAll(" → "," ")+" - 貓咪資訊",document.getElementById("abar")),cat_names=res.children,s=(cat_names[1].href="https://battlecats-db.com/unit/"+t3str(my_id+1)+".html",cat_names[2].onclick=()=>makegraph(0),cat_names[3].onclick=()=>makegraph(1),cat_names[4].onclick=()=>makegraph(2),cat_names[5].onclick=()=>makegraph(3),cat_names[6].onclick=xpgraph,t3str(my_id));cat_names[7].onclick=function(){var oldList=localStorage.getItem("star-cats");(oldList=null==oldList?[]:JSON.parse(oldList)).push({id:my_id,icon:my_cat.forms[0].icon,name:my_cat.forms[0].name||my_cat.forms[0].jp_name}),localStorage.setItem("star-cats",JSON.stringify(oldList))};let a=document.createElement("a");a.classList.add("w3-bar-item"),a.textContent="ImgCut",a.onclick=ImgCut,res.appendChild(a),(a=document.createElement("a")).classList.add("w3-bar-item"),a.href="/anim/anim.html?id="+my_id.toString(),a.textContent="檢視動畫",a.target="_black",res.appendChild(a),(a=document.createElement("a")).classList.add("w3-bar-item"),a.textContent="UDP",a.href="https://thanksfeanor.pythonanywhere.com/UDP/"+s,a.target="_black",res.appendChild(a),(a=document.createElement("a")).classList.add("w3-bar-item"),a.textContent="Fandom",a.href="https://battle-cats.fandom.com/wiki/"+my_cat.info.fandom,a.target="_black",res.appendChild(a),(a=document.createElement("a")).classList.add("w3-bar-item"),a.textContent="複製表格",a.onclick=openBBCode,res.appendChild(a)});