const my_params=new URLSearchParams(location.search),my_id=parseInt(my_params.get("id")),atk_mult_abs=new Set([AB_STRONG,AB_MASSIVE,AB_MASSIVES,AB_EKILL,AB_WKILL,AB_BAIL,AB_BSTHUNT,AB_S,AB_GOOD,AB_CRIT,AB_WAVE,AB_MINIWAVE,AB_MINIVOLC,AB_VOLC]),hp_mult_abs=new Set([AB_EKILL,AB_WKILL,AB_GOOD,AB_RESIST,AB_RESISTS,AB_BSTHUNT,AB_BAIL]);var my_cat,lvMax,tf_tbl,tf_tbl_s,custom_talents,custom_super_talents,level_count=0;if(isNaN(my_id))throw alert("Missing cat id in URL query!"),window.stop(),"";if(my_id<0||my_id>=curveMap.length)throw alert("沒有這個喵咪!"),window.stop(),"";const cat_icons=document.getElementById("cat-icons"),unit_content=document.getElementById("unit-content");function getCombinations(arr){if(!arr.length)return[];for(var combi=[],slent=2<<arr.length-1,i=0;i<slent;i++){for(var temp=[],j=0;j<arr.length;j++)i&(j?2<<j-1:1)&&temp.push(arr[j]);temp.length&&combi.push(temp)}return combi}function getAtk(line,theATK,parent,first,trait,plus,dps){function mul(arr,s){for(let i=0;i<arr.length;++i)arr[i]*=s}var lines=[],spec=!1,t_ef=!1,eva_ef=!1;for(const ab of line)switch(parseInt(ab[0])){case AB_WAVE:lines.push("波動"),mul(theATK,dps?1+ab[1]/100:2);break;case AB_MINIWAVE:mul(theATK,dps?1+ab[1]/500:1.2),lines.push("小波動");break;case AB_VOLC:mul(theATK,dps?1+ab[5]*ab[1]/100:1+ab[5]),lines.push("烈波");break;case AB_MINIVOLC:mul(theATK,dps?1+ab[5]*ab[1]/500:1+.2*ab[5]),lines.push("小烈波");break;case AB_GOOD:mul(theATK,((spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?1.8:1.5),lines.push("善攻"),t_ef=!0;break;case AB_CRIT:mul(theATK,dps?1+ab[1]/100:2),lines.push("爆");break;case AB_STRONG:mul(theATK,1+ab[2]/100),lines.push("增攻");break;case AB_S:mul(theATK,dps?1+ab[1]*ab[2]/1e4:1+ab[2]/100),lines.push("渾身");break;case AB_MASSIVE:mul(theATK,((spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?4:3),lines.push("大傷"),t_ef=!0;break;case AB_MASSIVES:mul(theATK,((spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?6:5),lines.push("極傷"),t_ef=!0;break;case AB_EKILL:lines.push("使徒"),mul(theATK,5),eva_ef=!0;break;case AB_WKILL:mul(theATK,5),lines.push("魔女"),eva_ef=!0;break;case AB_BSTHUNT:mul(theATK,2.5),lines.push("超獸"),t_ef=!0;break;case AB_BAIL:mul(theATK,1.6),lines.push("超生命體"),t_ef=!0}if(!eva_ef||!t_ef){let s=lines.join(" • "),atkstr=(s+=":","");if(plus&&(atkstr+="+"),dps){let t=0;for(var x of theATK)t+=~~x;atkstr+=t.toString()}else atkstr+=theATK.map(x=>~~x).join("/");if(s+=atkstr,spec)return first?(s+="("+get_trait_short_names(trait&trait_treasure)+")",parent.appendChild(document.createTextNode(s)),!0):(parent.appendChild(document.createTextNode("/"+atkstr+"("+get_trait_short_names(trait&trait_no_treasure)+")")),void parent.appendChild(document.createElement("br")));parent.appendChild(document.createTextNode(s)),parent.appendChild(document.createElement("br"))}return!1}function getAtkString(form,atks,abs,trait,level,parent,plus,dps=!1){atks=atks.map(x=>~~(~~(2.5*Math.round(x*getLevelMulti(level)))*form.atkM)),parent.textContent="";var line,Cs=getCombinations(Object.entries(abs).filter(x=>atk_mult_abs.has(parseInt(x[0]))).map(x=>Array.prototype.concat(x[0],x[1])));let first;if(dps){let t=0;for(var x of atks)t+=~~x;first=t.toString()}else first=atks.join("/");parent.appendChild(document.createTextNode(plus?"+"+first:first)),parent.appendChild(document.createElement("br"));for(line of Cs)getAtk(line,new Float64Array(atks),parent,!0,trait,plus,dps)&&getAtk(line,new Float64Array(atks),parent,!1,trait,plus,dps);abs.hasOwnProperty(AB_ATKBASE)&&parent.appendChild(document.createTextNode("城堡:"+atks.map(x=>4*x).join("/")))}function getHp(line,theHP,parent,first,trait,plus){var lines=[],spec=!1,t_ef=!1,eva_ef=!1;for(const ab of line)switch(parseInt(ab[0])){case AB_GOOD:theHP*=((spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?2.5:2,lines.push("善攻"),t_ef=!0;break;case AB_RESIST:theHP*=((spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?5:4,lines.push("耐打"),t_ef=!0;break;case AB_RESISTS:theHP*=((spec=trait&trait_treasure&&trait&trait_no_treasure)?first:trait&trait_treasure)?7:6,lines.push("超級耐打"),t_ef=!0;break;case AB_EKILL:lines.push("使徒"),theHP*=5,eva_ef=!0;break;case AB_WKILL:theHP*=10,lines.push("魔女"),eva_ef=!0;break;case AB_BSTHUNT:theHP/=.6,lines.push("超獸");break;case AB_BAIL:theHP/=.7,lines.push("超生命體"),t_ef=!0}if(!t_ef||!eva_ef){let s=lines.join(" • ");s+=":";line=plus?"+"+(~~theHP).toString():(~~theHP).toString();if(s+=line,spec)return first?(s+="("+get_trait_short_names(trait&trait_treasure)+")",parent.appendChild(document.createTextNode(s)),!0):(parent.appendChild(document.createTextNode("/"+line+"("+get_trait_short_names(trait&trait_no_treasure)+")")),void parent.appendChild(document.createElement("br")));parent.appendChild(document.createTextNode(s)),parent.appendChild(document.createElement("br"))}return!1}function getHpString(form,hp,abs,trait,level,parent,plus=!1){parent.textContent="",hp=~~(~~(2.5*Math.round(hp*getLevelMulti(level)))*form.hpM);var line,level=getCombinations(Object.entries(abs).filter(x=>hp_mult_abs.has(parseInt(x[0]))).map(x=>Array.prototype.concat(x[0],x[1])));parent.appendChild(document.createTextNode(plus?"+"+(~~hp).toString():(~~hp).toString())),parent.appendChild(document.createElement("br"));for(line of level)getHp(line,hp,parent,!0,trait,plus)&&getHp(line,hp,parent,!1,trait,plus)}function updateValues(form,tbl){var tbl=tbl.children,HPs=tbl[1].children,HPPKBs=tbl[2].children,ATKs=tbl[3].children,DPSs=tbl[4].children,PRs=tbl[8].children,CD=tbl[7].children[5],KB=tbl[7].children[1],levels=(tbl[7].children[3].innerText=form.speed.toString(),PRs[2].innerText=form.price,PRs[4].innerText=~~(1.5*form.price),PRs[6].innerText=2*form.price,new Array(5));let lvE=tbl[0].children[1],i;const attackS=form.attackF/30;for(i=0;i<lvMax;++i)levels[i]=parseInt(lvE.innerText.slice(2)),lvE=lvE.nextElementSibling;for(i=1;i<=5;++i)i>lvMax?HPs[i].textContent="-":getHpString(form,form.hp,form.ab,form.trait,levels[i-1],HPs[i]);getHpString(form,.2*form.hp,form.ab,form.trait,1,HPs[i],!0);var hppkb=form.hp/form.kb;for(i=1;i<=5;++i)i>lvMax?HPPKBs[i].textContent="-":getHpString(form,hppkb,form.ab,form.trait,levels[i-1],HPPKBs[i]);getHpString(form,.2*hppkb,form.ab,form.trait,1,HPPKBs[i],!0);var atks=[form.atk,form.atk1,form.atk2].filter(x=>x);for(i=1;i<=5;++i)i>lvMax?ATKs[i].textContent="-":getAtkString(form,atks,form.ab,form.trait,levels[i-1],ATKs[i],!1);for(getAtkString(form,atks.map(x=>.2*x),form.ab,form.trait,1,ATKs[i],!0),i=1;i<=5;++i)i>lvMax?DPSs[i].textContent="-":getAtkString(form,atks.map(x=>x/attackS),form.ab,form.trait,levels[i-1],DPSs[i],!1,!0);getAtkString(form,atks.map(x=>.2*x/attackS),form.ab,form.trait,1,DPSs[i],!0,!0),tbl[6].children[1].innerText=numStrT(form.tba),tbl[6].children[3].innerText=numStrT(form.backswing),tbl[5].children[1].innerText=numStrT(form.attackF).replace("秒","秒/下");var p,PRs=numStrT(form.pre),PRs=(form.pre1&&(PRs+="/"+numStrT(form.pre1)),form.pre2&&(PRs+="/"+numStrT(form.pre2)),tbl[5].children[3].innerText=PRs,""),PRs=(form.atkType&ATK_OMNI?PRs+="全方位":form.atkType&ATK_LD&&(PRs+="遠方"),PRs+=form.atkType&ATK_RANGE?"範圍攻擊":"單體攻擊",tbl[5].children[6].innerText=PRs,tbl[9].children[1]),lds=form.lds,ldr=form.ldr;if(PRs.textContent="",form.atkType&ATK_KB_REVENGE&&((p=document.createElement("p")).innerText="擊退反擊",PRs.appendChild(p)),form.atk1||form.atk2){var atkNum=form.atk2?3:2,atksPre=[form.atk,form.atk1,form.atk2].slice(0,atkNum).map(x=>(x/(form.atk+form.atk1+form.atk2)*100).toFixed(0)+"%");const p=document.createElement("p");p.innerText=`${atkNum}回連續攻擊(傷害${atksPre.join("-")})`+getAbiString(form.abi),PRs.appendChild(p)}if(lds[0]||ldr[0]){var s="";for(let i=0;i<lds.length;++i){var x=lds[i],y=x+ldr[i];s+=x<=y?""+"①②③"[i]+x+`~${y}<br>`:""+"①②③"[i]+y+`~${x}<br>`}tbl[5].children[5].innerHTML=`接觸點${form.range}<br>範圍<br>`+s.slice(0,s.length-4)}else tbl[5].children[5].innerText=form.range;KB.innerText=form.kb.toString(),CD.innerText=numStrT(form.cd)}function makeTd(parent,text=""){var c=document.createElement("td");return c.innerText=text,parent.appendChild(c),c}function updateTable(TF,tbl){updateValues(TF,tbl);tbl=tbl.children;tbl[9].children[1].textContent="",tbl[10].children[1].textContent="",tbl[11].children[1].textContent="",tbl[12].children[1].textContent="",createTraitIcons(TF.trait,tbl[9].children[1]),createImuIcons(TF.imu,tbl[10].children[1]),createResIcons(TF.res,tbl[10].children[1]),createAbIcons1(TF.ab,tbl[11].children[1]),createAbIcons2(TF.ab,tbl[12].children[1])}function renderForm(form,_super){var info=my_cat.info;if(2==level_count&&null!=info.upReqs){var container=document.createElement("table"),tr0=(container.classList.add(".w3-table","w3-centered","fruit"),container.style.margin="0px auto",document.createElement("tr")),tr1=document.createElement("tr"),td=document.createElement("td");td.innerText="進化素材",td.colSpan=info.upReqs.length,tr0.appendChild(td);for(const r of info.upReqs){var img=new Image(128,128),div=document.createElement("td"),p=(div.style.width="128px",document.createElement("p"));r[1]?(img.src="./data/page/catfruit/gatyaitemD_"+r[1].toString()+"_f.png",p.innerText="X"+r[0].toString()):(img.src="./data/page/catfruit/xp.png",p.innerText=r[0].toString()),div.appendChild(img),div.appendChild(p),tr1.appendChild(div)}container.appendChild(tr0),container.appendChild(tr1),unit_content.appendChild(container)}var td=document.createElement("p"),info=document.createElement("table"),theadtr=document.createElement("tr"),tbodytr1=document.createElement("tr"),tbodytr2=document.createElement("tr"),tbodytr3=document.createElement("tr"),tbodytr4=document.createElement("tr"),tr0=document.createElement("tr"),container=document.createElement("tr"),tbodytr7=document.createElement("tr"),tbodytr8=document.createElement("tr"),tbodytr9=document.createElement("tr"),tbodytr10=document.createElement("tr"),tbodytr11=document.createElement("tr"),tbodytr12=document.createElement("tr");try{td.innerHTML=["一階：<br>","二階：<br>","三階：<br>","本能完全升滿的數值表格","超本能完全升滿的數值表格"][level_count]+(level_count<=2?unit_descs[my_id][level_count]:"")}catch(e){}makeTd(theadtr);var _super=_super?6:1,II=4+_super;for(let i=_super;i<=II;++i){var e=makeTd(theadtr,"Lv"+10*i);e.contentEditable=!0,e._form=form,e._val=10*i,e.addEventListener("blur",function(event){var event=event.currentTarget,tbl=event.parentNode.parentNode,M=my_cat.info.maxBase+my_cat.info.maxPlus,num=event.innerText.match(/\d+/);num?(num=Math.max(1,Math.min(parseInt(num[0]),M)),event._val=num,event.innerText="Lv"+num,updateValues(event._form,tbl)):event.innerText=event._val})}makeTd(theadtr,"每提升一級"),makeTd(tbodytr1,"HP");for(let i=0;i<6;++i)makeTd(tbodytr1,"-");makeTd(tbodytr2,"硬度");for(let i=0;i<6;++i)makeTd(tbodytr2,"-");makeTd(tbodytr3,"攻擊力");for(let i=0;i<6;++i)makeTd(tbodytr3,"-");makeTd(tbodytr4,"DPS");for(let i=0;i<6;++i)makeTd(tbodytr4,"-");makeTd(tr0,"攻擊頻率"),makeTd(tr0),makeTd(tr0,"出招時間"),makeTd(tr0),makeTd(tr0,"射程").rowSpan=2,makeTd(tr0).rowSpan=2,makeTd(tr0).rowSpan=3,makeTd(container,"攻擊間隔"),makeTd(container),makeTd(container,"收招時間"),makeTd(container),makeTd(tbodytr7,"KB"),makeTd(tbodytr7),makeTd(tbodytr7,"跑速"),makeTd(tbodytr7),makeTd(tbodytr7,"再生產"),makeTd(tbodytr7),makeTd(tbodytr8,"召喚金額"),makeTd(tbodytr8,"一章"),makeTd(tbodytr8),makeTd(tbodytr8,"二章(傳說)"),makeTd(tbodytr8),makeTd(tbodytr8,"三章"),makeTd(tbodytr8),makeTd(tbodytr9,"屬性").style.textAlign="center",makeTd(tbodytr9).colSpan=6,makeTd(tbodytr10,"抗性").style.textAlign="center",makeTd(tbodytr10).colSpan=6,makeTd(tbodytr11,"能力").style.textAlign="center",makeTd(tbodytr11).colSpan=6,makeTd(tbodytr12,"效果").style.textAlign="center",makeTd(tbodytr12).colSpan=6,tbodytr9.classList.add("spec"),tbodytr10.classList.add("spec"),tbodytr11.classList.add("spec"),tbodytr12.classList.add("spec"),info.appendChild(theadtr),info.appendChild(tbodytr1),info.appendChild(tbodytr2),info.appendChild(tbodytr3),info.appendChild(tbodytr4),info.appendChild(tr0),info.appendChild(container),info.appendChild(tbodytr7),info.appendChild(tbodytr8),info.appendChild(tbodytr9),info.appendChild(tbodytr10),info.appendChild(tbodytr11),info.appendChild(tbodytr12),updateValues(form,info),createTraitIcons(form.trait,tbodytr9.children[1]),createImuIcons(form.imu,tbodytr10.children[1]),form.res&&createResIcons(form.res,tbodytr10.children[1]),createAbIcons1(form.ab,tbodytr11.children[1]),createAbIcons2(form.ab,tbodytr12.children[1]),tbodytr9.children[1].children.length||(tbodytr9.style.display="none"),tbodytr10.children[1].children.length||(tbodytr10.style.display="none"),tbodytr11.children[1].children.length||(tbodytr11.style.display="none"),tbodytr12.children[1].children.length||(tbodytr12.style.display="none"),info.classList.add("w3-table","w3-centered");let odd=!0;for(let e of info.children)odd&&e.classList.add("modd"),odd=!odd;return unit_content.appendChild(td),unit_content.appendChild(info),++level_count,info}function renderExtras(){var e,table=document.createElement("table"),th=document.createElement("tr"),td0=document.createElement("td"),td0=(td0.colSpan=2,td0.innerText="其他資訊",th.appendChild(td0),document.createElement("tr")),tr2=(makeTd(td0,"稀有度"),makeTd(td0,my_cat.info.getRarityString()),document.createElement("tr")),tr3=(makeTd(tr2,"最大基本等級"),makeTd(tr2,my_cat.info.maxBase.toString()),document.createElement("tr"));if(makeTd(tr3,"最大加值等級"),makeTd(tr3,"+"+my_cat.info.maxPlus.toString()),table.appendChild(th),table.appendChild(td0),table.appendChild(tr2),table.appendChild(tr3),my_cat.info.hasOwnProperty("unclockS")&&(th=document.createElement("tr"),td0=document.createElement("td"),tr2=document.createElement("a"),td0.appendChild(tr2),tr2.innerText="世界篇第"+my_cat.info.unclockS%100+"關",tr2.href="/stage.html?s=3-9-"+(my_cat.info.unclockS-1).toString(),makeTd(th,"解鎖關卡"),th.appendChild(td0),table.appendChild(th)),my_cat.info.hasOwnProperty("unclockFood")){const tr=document.createElement("tr");makeTd(tr,my_cat.info.rarity?"購買所需貓罐頭":"購入XP"),makeTd(tr,my_cat.info.unclockFood),table.appendChild(tr)}if(my_cat.info.hasOwnProperty("rw")){const tr=document.createElement("tr"),td=document.createElement("td"),a=document.createElement("a");td.appendChild(a);tr3=my_cat.info.rw.join("-");a.innerText="#"+tr3,a.href="/stage.html?s="+tr3,makeTd(tr,"破關掉落"),tr.appendChild(td),table.appendChild(tr)}if(my_cat.info.hasOwnProperty("tf")){const tr=document.createElement("tr"),td=document.createElement("td"),a=document.createElement("a"),s=(td.appendChild(a),my_cat.info.tf.join("-"));a.innerText="#"+s,a.href="/stage.html?s="+s,makeTd(tr,"進化條件"),tr.appendChild(td),table.appendChild(tr)}my_cat.info.version&&(tr2=my_cat.info.version.toString(),(td0=document.createElement("div")).innerText=`Ver ${parseInt(tr2.slice(0,2))}.${parseInt(tr2.slice(2,4))}.${parseInt(tr2.slice(4))} 新增`,td0.classList.add("r-ribbon"),document.body.appendChild(td0)),table.classList.add("w3-table","w3-centered","tcost");let odd=!0;for(e of table.children)odd&&e.classList.add("modd"),odd=!odd;unit_content.appendChild(table)}function getTalentInfo(talent,data){function range(name,f="%",start=2,end=3){return[name,talent[start].toString()+f,talent[end].toString()+f,talent[1],numStr((talent[end]-talent[start])/(talent[1]-1))+f]}function range2(name,f="%",start,end,init){return[name,init.toString()+f,talent[end].toString()+f,talent[1],numStr((talent[end]-talent[start])/(talent[1]-1))+f]}switch(talent[0]){case 1:return talent[4]&&talent[4]!=talent[5]?range("降攻時間","f",4,5):range("降攻機率","%",2,3);case 2:return talent[4]&&talent[4]!=talent[5]?range("暫停時間","f",4,5):range("暫停機率","%",2,3);case 3:return talent[4]&&talent[4]!=talent[5]?range("緩速時間","f",4,5):range("緩速機率","%",2,3);case 4:return"只能攻擊";case 5:return"善於攻擊";case 6:return"耐打";case 7:return"超大傷害";case 8:return data[24]?range("擊退","%",2,3):range2("擊退","%",2,3,talent[2]);case 10:return data[40]?range("升攻","%",4,5):range2("升攻","%",4,5,talent[4]);case 11:return data[42]?range("死前存活","%",2,3):range2("死前存活","%",2,3,talent[2]);case 12:return"善於攻城";case 13:return data[31]?range("爆擊","%",2,3):`爆擊(${talent[2]}%機率發動)`;case 14:return"殭屍殺手";case 15:return data[70]?range("破盾","%",2,3):range2("破盾","%",2,3,talent[2]);case 16:return"雙倍金錢";case 17:return data[35]?range("波動","%",2,3):range2(`Lv${talent[4]}波動`,"%",2,3,talent[2]);case 18:return range("降攻耐性");case 19:return range("暫停耐性");case 20:return range("緩速耐性");case 21:return range("擊退耐性");case 22:return range("波動耐性");case 23:return"波動滅止";case 24:return range("抗傳耐性");case 25:return["成本減少",~~(1.5*talent[2]),~~(1.5*talent[3]),talent[1],numStr(1.5*talent[2])];case 26:return["生產速度",talent[2]+"f",talent[3]+"f",talent[1],talent[2],numStr((talent[3]-talent[2])/(talent[1]-1))+"f"];case 27:return["移動速度",talent[2],talent[3],talent[1],talent[2]];case 29:return"詛咒無效";case 30:return range("詛咒耐性");case 31:return range("攻擊力");case 32:return range("血量");case 33:return"對紅色敵人";case 34:return"對漂浮敵人";case 35:return"對黑色敵人";case 36:return"對鋼鐵敵人";case 37:return"對天使敵人";case 38:return"對異星敵人";case 39:return"對不死敵人";case 40:return"對古代種";case 41:return"對白色種";case 42:return"對魔女";case 43:return"對使徒";case 44:return"降攻無效";case 45:return"暫停無效";case 46:return"緩速無效";case 47:return"擊退無效";case 48:return"波動無效";case 49:return"傳送無效";case 50:return data[82]?range("渾身一擊","%",2,3):range2("渾身一擊","%",2,3,talent[2]);case 51:return talent[4]&&talent[4]!=talent[5]?range("攻撃無効","f",4,5):range("攻撃無効","%",2,3);case 52:return range("毒擊耐性");case 53:return"毒擊無效";case 54:return range("烈波耐性");case 55:return"烈波無效";case 56:return data[86]?range("烈波機率","%",2,3):range2(`Lv${talent[4]}烈波機率`,"%",2,3,talent[2]);case 57:return"對惡魔";case 58:return data[58]?range("破惡魔盾","%",2,3):range2("破惡魔盾","%",2,3,talent[2]);case 59:return"靈魂攻擊";case 60:return talent[4]&&talent[4]!=talent[5]?range("詛咒時間","f",4,5):range("詛咒機率","%",2,3);case 61:data[4];var first=talent[2]+"%";return["TBA縮短",first,talent[3]+"%",talent[1],first];case 62:return data[94]?range("小波動","%",2,3):range2(`Lv${talent[4]}小波動`,"%",2,3,talent[2]);case 63:return"超生命體特效";case 64:return"超獸特效";case 65:return data[108]?range("小烈波","%",2,3):range2(`Lv${talent[4]}小烈波`,"%",2,3,talent[2]);default:console.assert(!1)}return"???"}function rednerTalentInfos(talents,data,_super=!1){var e,table=document.createElement("table"),tr1=document.createElement("tr"),td0=document.createElement("td"),td0=(td0.innerText=(_super?"超":"")+"本能解放(使用NP)",td0.colSpan=5,tr1.appendChild(td0),table.appendChild(tr1),document.createElement("tr")),tr1=document.createElement("td"),td2=document.createElement("td"),td3=document.createElement("td"),td4=document.createElement("td"),td5=document.createElement("td"),infos=(tr1.innerText=my_cat.forms[2].name||my_cat.forms[2].jp_name,td2.innerText="Lv1",td3.innerText="Lv10",td4.innerText="最高等級",td5.innerText="每提升一級",td0.appendChild(tr1),td0.appendChild(td2),td0.appendChild(td3),td0.appendChild(td4),td0.appendChild(td5),table.appendChild(td0),[]);for(let i=0;i<112;i+=14){var tr=document.createElement("tr");if(!talents[i])break;if(_super==(1==talents[i+13])){var info=getTalentInfo(talents.subarray(i,i+14),data);if(info instanceof Array){infos.push(info[0]);let td=null;for(var s of info)(td=document.createElement("td")).innerText=s,tr.appendChild(td);td.innerText="+"+td.innerText}else{infos.push(info);var t1=document.createElement("td"),t2=document.createElement("td");t1.innerText="能力新增",t2.innerText=info,t2.colSpan=4,tr.appendChild(t1),tr.appendChild(t2)}table.appendChild(tr)}}let odd=!0;for(e of table.children)odd&&e.classList.add("modd"),odd=!odd;return table.classList.add("w3-table","w3-centered","tcost"),unit_content.appendChild(table),infos}function calcCost(event){var t=event.currentTarget,idx=Array.prototype.indexOf.call(t.parentNode.children,t),event=t.parentNode.parentNode;let i=0;t.classList.add("o-selected");for(const e of event.children){var x=e.children[idx];x&&(x==t?t._super?custom_super_talents[idx-1]=i-1:custom_talents[idx-1]=i-1:x.classList.contains("o-selected")&&x.classList.remove("o-selected"),++i)}let e=event.children[2];for(var costs=new Uint16Array(e.children.length-1),selectMap=new Uint8Array(costs.length);;){var chs=e.children;if(-1==chs[0].innerText.indexOf("Lv"))break;for(let j=1;j<=costs.length;++j)selectMap[j-1]||(costs[j-1]+=parseInt(chs[j].innerText.replace("X","0"))),chs[j].classList.contains("o-selected")&&(selectMap[j-1]=1);e=e.nextElementSibling}var cis=e.children;for(let j=1;j<=costs.length;++j)cis[j].innerText=costs[j-1];e.nextElementSibling.firstElementChild.innerText="共"+costs.reduce((a,b)=>a+b,0);event=new Form(structuredClone(my_cat.forms[2]));event.applyTalents(my_cat.info.talents,custom_talents),tf_tbl&&updateTable(event,tf_tbl),t._super&&event.applySuperTalents(my_cat.info.talents,custom_super_talents),tf_tbl_s&&updateTable(event,tf_tbl_s)}function renderTalentCosts(talent_names,talents,data,_super=!1){var skill_costs=[[25,5,5,5,5,10,10,10,10,10],[5,5,5,5,5,10,10,10,10,10],[50],[50,10,10,10,10,15,15,15,15,15],[10,10,10,10,10,15,15,15,15,15],[75],[75,15,15,15,15,20,20,20,20,20],[15,15,15,15,15,20,20,20,20,20],[100],[150],[250],[100,15,15,15,15,25,25,25,25,25],[75,10,10,10,10,20,20,20,20,20],[120,20,20,20,20,25,25,25,25,25]],table=document.createElement("table"),th=document.createElement("tr");const td0=document.createElement("td");table.style.userSelect="none",td0.innerText="消耗NP一覽",th.appendChild(td0);var names=[],costs=[],maxLvs=[];let c=0;for(let i=0;i<112&&talents[i];i+=14)_super==(1==talents[i+13])&&(names.push(talent_names[c]),costs.push(talents[i+11]-1),maxLvs.push(talents[i+1]),++c);_super?custom_super_talents=maxLvs:custom_talents=maxLvs;var tr1=document.createElement("tr"),td1=(td0.colSpan=names.length+1,document.createElement("td"));td1.innerText="等級",tr1.appendChild(td1);for(let i=0;i<names.length;++i){var td=document.createElement("td");td.innerText=names[i],tr1.appendChild(td)}var tr2=document.createElement("tr");for(let i=0;i<=names.length;++i){const td=document.createElement("td");td.innerText=0==i?"Lv0":"0",td.addEventListener("click",calcCost),td._super=_super,tr2.appendChild(td)}table.appendChild(th),table.appendChild(tr1),table.appendChild(tr2);for(let i=1;i<=10;++i){var tr=document.createElement("tr");const td0=document.createElement("td");td0.innerText="Lv"+i.toString(),tr.appendChild(td0);for(let j=0;j<names.length;++j){const td=document.createElement("td");var tbl=skill_costs[costs[j]];td.innerText=i>maxLvs[j]?"X":tbl[i-1],tr.appendChild(td),"X"!=td.innerText&&td.addEventListener("click",calcCost),td._super=_super}table.appendChild(tr)}var trend=document.createElement("tr"),td1=document.createElement("td");td1.innerText="總計",td1.rowSpan=2;let total=0;trend.appendChild(td1);for(let i=0;i<costs.length;++i){const td=document.createElement("td");let s=0;for(let j=0;j<maxLvs[i];++j)s+=skill_costs[costs[i]][j];td.innerText=s.toString(),total+=s,trend.appendChild(td)}table.appendChild(trend);var e,th=document.createElement("tr"),td1=document.createElement("td");td1.colSpan=names.length,td1.innerText="共"+total.toString(),th.appendChild(td1),table.appendChild(th);let odd=!0;for(e of table.children)odd&&e.classList.add("modd"),odd=!odd;table.classList.add("w3-table","w3-centered","tcost"),unit_content.appendChild(table)}function renderCombos(){var table=document.createElement("table");for(let j=0;j<combos.length;++j){var C=combos[j],units=C[3];for(let i=0;i<units.length;i+=2)if(my_id==units[i]){var tr=document.createElement("tr"),type=C[1],lv=C[2],td=document.createElement("td"),p=document.createElement("p"),p2=document.createElement("p"),a=(td.appendChild(p),td.appendChild(p2),document.createElement("a"));let _c=0;for(let y=0;y<combos.length;++y)combos[y][1]==type&&(y<=j?combos[y][3].length<=units.length:combos[y][3].length<units.length)&&++_c;a.href=`/combos.html#${type}-`+_c,a.innerText=C[0],a.style.textDecoration="none",p.appendChild(a),p2.innerText=combo_f[type].replace("$",combo_params[type][lv])+"【"+["小","中","大","究極"][lv]+"】",tr.appendChild(td);for(let c=0;c<units.length;c+=2){const td=document.createElement("td");var img=new Image,my_id_str=t3str(units[c]),form_str="fcs"[units[c+1]];const a=document.createElement("a");a.href="./unit.html?id="+units[c].toString(),img.src=`./data/unit/${my_id_str}/${form_str}/uni${my_id_str}_${form_str}00.png`,a.appendChild(img),td.appendChild(a),tr.appendChild(td)}table.appendChild(tr);break}}if(table.children.length){table.classList.add("w3-table","w3-centered","combo");const p=document.createElement("p");p.innerText="聯組資訊",unit_content.appendChild(p),unit_content.appendChild(table)}}function renderUintPage(){for(var form of my_cat.forms){var img=new Image;img.src=form.icon,cat_icons.appendChild(img)}for(let form of my_cat.forms)renderForm(form);if(my_cat.info.talents){unit_content.appendChild(document.createElement("hr"));var TF=new Form(structuredClone(my_cat.forms[2])),_super=(renderTalentCosts(rednerTalentInfos(my_cat.info.talents,TF.data),my_cat.info.talents,TF.data),TF.applyTalents(my_cat.info.talents,custom_talents));if(tf_tbl=renderForm(TF),_super){unit_content.appendChild(document.createElement("hr"));const names=rednerTalentInfos(my_cat.info.talents,TF.data,!0);renderTalentCosts(names,my_cat.info.talents,TF.data,!0),TF.applySuperTalents(my_cat.info.talents,custom_super_talents),tf_tbl_s=renderForm(TF,!0)}}renderExtras(),renderCombos()}loadCat(my_id).then(res=>{my_cat=res,useCurve(my_id);var res=my_cat.forms.map(x=>x.jp_name).filter(x=>x).join(" → "),cat_names=my_cat.forms.map(x=>x.name).filter(x=>x).join(" → "),abar=(document.getElementById("ch_name").innerText=cat_names,document.getElementById("jp_name").innerText=res,lvMax=Math.min(my_cat.info.maxBase+my_cat.info.maxPlus,50)/10,renderUintPage(),document.getElementById("loader").style.display="none",loader_text.style.display="none",document.getElementById("main").style.display="block",document.title=cat_names.replaceAll(" → "," ")+" - 貓咪資訊",document.getElementById("abar").children),s=(abar[1].href="https://battlecats-db.com/unit/"+t3str(my_id+1)+".html",abar[2].href="./levelgraph1.html?id="+my_id.toString(),abar[3].href="./levelgraph2.html?id="+my_id.toString(),abar[4].href="./levelgraph3.html?id="+my_id.toString(),abar[5].href="./levelgraph4.html?id="+my_id.toString(),abar[6].href="./xpgraph.html?data="+btoa(my_cat.info.xp_data),t3str(my_id));abar[7].onclick=function(){var oldList=localStorage.getItem("star-cats");(oldList=null==oldList?[]:JSON.parse(oldList)).push({id:my_id,icon:my_cat.forms[0].icon,name:my_cat.forms[0].name}),localStorage.setItem("star-cats",JSON.stringify(oldList))};for(let i=0;i<my_cat.forms.length;++i){var c,a=document.createElement("a");a.classList.add("w3-bar-item"),a.innerText="ImgCut("+(i+1).toString()+"階)";let imgfile,cutfile;cutfile=my_cat.forms[i].icon.startsWith("./data/img/m/")?(c=my_cat.forms[i].icon.slice(13,16),imgfile=`/data/img/m/${c}/${c}_m.png`,`/data/img/m/${c}/${c}_m.imgcut`):(c="fcs"[i],imgfile=`/data/unit/${s}/${c}/${s}_${c}.png`,`/data/unit/${s}/${c}/${s}_${c}.imgcut`),a.href="/anim/imgcut.html?cutfile="+cutfile+"&imgfile="+imgfile,abar[0].parentNode.appendChild(a)}{const a=document.createElement("a");a.classList.add("w3-bar-item"),a.href="/anim/anim.html?id="+my_id.toString(),a.innerText="檢視動畫",abar[0].parentNode.appendChild(a)}});const overlay=document.getElementById("overlay"),sidebar=document.getElementById("sidebar");function w3_open(){sidebar.style.display="block",overlay.style.display="block"}function w3_close(){sidebar.style.display="none",overlay.style.display="none"}