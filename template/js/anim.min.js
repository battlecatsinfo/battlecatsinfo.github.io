(()=>{"use strict";var t={n:i=>{var s=i&&i.t?()=>i.default:()=>i;return t.d(s,{a:s}),s},d:(i,s)=>{for(var h in s)t.i(s,h)&&!t.i(i,h)&&Object.defineProperty(i,h,{enumerable:!0,get:s[h]})},i:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};class i{static h=new i;o;canvas;l;position;u;m;p;v;M;I;P=new Float32Array(16);_;k;A;F;$;T;static N(t){let i=t.toString();switch(i.length){case 3:return i;case 2:return"0"+i;default:return"00"+i}}B(t,i,s,h,e,n){this.P[0]=2/(i-t),this.P[1]=0,this.P[2]=0,this.P[3]=0,this.P[4]=0,this.P[5]=2/(h-s),this.P[6]=0,this.P[7]=0,this.P[8]=0,this.P[9]=0,this.P[10]=2/(e-n),this.P[11]=0,this.P[12]=(t+i)/(t-i),this.P[13]=(s+h)/(s-h),this.P[14]=(e+n)/(e-n),this.P[15]=1}scale(t,i){this.P[0]*=t,this.P[1]*=t,this.P[2]*=t,this.P[3]*=t,this.P[4]*=i,this.P[5]*=i,this.P[6]*=i,this.P[7]*=i}translate(t,i){this.P[12]=this.P[0]*t+this.P[4]*i+this.P[8]+this.P[12],this.P[13]=this.P[1]*t+this.P[5]*i+this.P[9]+this.P[13],this.P[14]=this.P[2]*t+this.P[6]*i+this.P[10]+this.P[14],this.P[15]=this.P[3]*t+this.P[7]*i+this.P[11]+this.P[15]}}class s{static h=new s;L=!1;D;C;O;R;U=0;S=0;H=new Float32Array(8);X=new Float32Array(8);Y(){this.D=i.h.canvas.width,this.C=0,this.R=i.h.canvas.height,this.O=0,this.L=!0}q(){this.L=!1,this.D=this.D-10,this.C=this.C+10,this.R=this.R-10,this.O=this.O+10}G(t){const s=i.h.l;let h=1,e=s.ONE,n=s.ONE_MINUS_SRC_ALPHA;switch(t){case 1:n=s.ONE;break;case 2:e=s.ZERO,n=s.SRC_COLOR;break;case 3:e=s.ONE_MINUS_DST_COLOR,n=s.ONE,h=2}s.blendFunc(e,n),s.uniform1i(i.h.M,h)}W(t,s,h,e,n,o,a,r,c,l,u,f,d){if(this.L)return this.D=Math.min(s,e,o,r,this.D),this.C=Math.max(s,e,o,r,this.C),this.R=Math.min(h,n,a,c,this.R),void(this.O=Math.max(h,n,a,c,this.O));const m=i.h.l;this.H[0]=s-this.U,this.H[1]=h-this.S,this.H[2]=e-this.U,this.H[3]=n-this.S,this.H[4]=r-this.U,this.H[5]=c-this.S,this.H[6]=o-this.U,this.H[7]=a-this.S,m.bindBuffer(m.ARRAY_BUFFER,i.h.u),m.bufferData(m.ARRAY_BUFFER,this.H,m.STATIC_DRAW),this.H[0]=l,this.H[1]=u,this.H[2]=l,this.H[3]=u+d,this.H[4]=l+f,this.H[5]=u,this.H[6]=l+f,this.H[7]=u+d;for(let i=0;i<8;)this.H[i++]/=t.j,this.H[i++]/=t.V;m.bindBuffer(m.ARRAY_BUFFER,i.h.p),m.bufferData(m.ARRAY_BUFFER,this.H,m.STATIC_DRAW),m.bindTexture(m.TEXTURE_2D,t.Z),m.drawArrays(m.TRIANGLE_STRIP,0,4)}setAlpha(t){i.h.l.uniform1f(i.h.v,t)}K(){const t=i.h.l;t.blendFunc(t.ONE,t.ZERO),t.bindBuffer(t.ARRAY_BUFFER,i.h.u),t.bufferData(t.ARRAY_BUFFER,this.X,t.STATIC_DRAW),t.uniform1i(i.h.M,3),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}class h{x;y;width;height}class e{a;b;J=0;tt(t){return parseInt(this.b[t])}it(t){this.a=t}st(t){return this.b[t]}ht(){if(this.J>=this.a.length)return null;let t=this.J;if(this.J=this.a.indexOf("\n",t),-1==this.J)return this.J=this.a.length,this.a.slice(t);let i=this.a.slice(t,this.J++);return i.includes("\r")?i.replaceAll("\r",""):i}et(t=","){let i=this.ht();return i&&(this.b=i.split(t)),this.b}c(){return this.a}close(){}}class n{Z;j;V;name;nt;async load(t,s,n=0){if(this.reset(),null!=s)if(1&n){let t=new e;t.it(s),t.ht(),t.ht(),t.ht(),t.et();let i=t.tt(0);this.nt=new Array(i);for(let s=0;s<i;s++)t.et(),this.nt[s].x=t.tt(0),this.nt[s].y=t.tt(1),this.nt[s].width=t.tt(2),this.nt[s].height=t.tt(3);t.close()}else{let t=new e;t.it(s),t.ht(),t.ht(),t.ht(),t.et();let i=t.tt(0);this.nt=new Array(i);for(let s=0;s<i;s++)t.et(),this.nt[s]=new h,this.nt[s].x=t.tt(0),this.nt[s].y=t.tt(1),this.nt[s].width=t.tt(2),this.nt[s].height=t.tt(3);t.close()}const o=i.h.l,a=document.createElement("img");a.crossOrigin="anonymous",a.src=t,await new Promise((function(t,i){a.onload=t,a.onerror=i})),this.j=a.naturalWidth,this.V=a.naturalHeight,this.Z=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.Z),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a)}reset(){this.Z&&(i.h.l.deleteTexture(this.Z),this.Z=null)}}class o{frame;ot;rt;ct}class a{lt;ut;loop;ft;dt;off=0;max=0;wt=0;vt=0;gt(){if(this.ft&&(this.dt[0].frame<0||-1!=this.loop)){this.off=-this.dt[0].frame;for(let t=0;t<this.ft;++t)this.dt[t].frame+=this.off}return this.ft&&(this.wt=this.dt[0].frame,this.max=this.dt[this.ft-1].frame),-1!=this.loop?this.loop>1?this.wt+(this.max-this.wt)*this.loop:this.max-this.off:this.max-Math.min(this.off,0)}yt(t){this.ft&&t[this.lt].Mt(this.ut,this.dt[this.ft-1].ot)}}class r{xt;It;bt;load(t){let i=new e;this.bt=0,i.it(t),i.ht(),i.ht(),i.et(),this.It=i.tt(0),this.xt=new Array(this.It);for(let t=0;t<this.It;t++){i.et();const s=new a;this.xt[t]=s,s.lt=i.tt(0),s.ut=i.tt(1),s.loop=i.tt(2),i.et(),s.ft=i.tt(0),s.dt=new Array(s.ft);for(let t=0;t<s.ft;t++)i.et(),s.dt[t]=new o,s.dt[t].frame=i.tt(0),s.dt[t].ot=i.tt(1),s.dt[t].rt=i.tt(2),s.dt[t].ct=i.tt(3);let h=s.gt();h>this.bt&&(this.bt=h)}i.close()}}class c{P=new Float32Array(6);constructor(){this.Pt()}Pt(){this.P[0]=1,this.P[1]=0,this.P[2]=0,this.P[3]=0,this.P[4]=1,this.P[5]=0}rotate(t){let i=Math.cos(t*Math.PI/180);t=Math.sin(t*Math.PI/180);let s=this.P[0];this.P[0]=this.P[0]*i+this.P[1]*t,this.P[1]=s*-t+this.P[1]*i,s=this.P[3],this.P[3]=this.P[3]*i+this.P[4]*t,t=-t,this.P[4]=i*this.P[4]+t*s}setTranslate(t,i){this.P[0]=1,this.P[1]=0,this.P[2]=t,this.P[3]=0,this.P[4]=1,this.P[5]=i}setRotate(t){this.P[0]=Math.cos(t*Math.PI/180),this.P[1]=-Math.sin(t*Math.PI/180),this.P[2]=0,this.P[3]=Math.sin(t*Math.PI/180),this.P[4]=Math.cos(t*Math.PI/180),this.P[5]=0}setScale(t,i){this.P[0]=t/100,this.P[1]=0,this.P[2]=0,this.P[3]=0,this.P[4]=i/100,this.P[5]=0}scale(t,i){this.P[0]=this.P[0]*t/100,this.P[1]=this.P[1]*i/100,this.P[3]=this.P[3]*t/100,this.P[4]=this.P[4]*i/100}set(t){this.P.set(t.P)}transform(t,i,s){s.x=~~(this.P[0]*t+this.P[1]*i+this.P[2]),s.y=~~(this.P[3]*t+this.P[4]*i+this.P[5])}translate(t,i){this.P[2]=this.P[2]+this.P[0]*t+this.P[1]*i,this.P[5]=this.P[5]+this.P[3]*t+this.P[4]*i}mul(t){const i=this.P[0],s=t.P[0],h=this.P[1],e=t.P[3],n=this.P[2],o=t.P[1],a=this.P[3],r=t.P[4],c=this.P[4],l=(t.P[2],this.P[5]),u=t.P[5];this.P[0]=i*s+h*e,this.P[1]=i*o+h*r,this.P[2]=n*s+a*e,this.P[3]=n*o+a*r,this.P[4]=c*s+l*e,this.P[5]=c*o+l*r+u}}class l{x=0;y=0}class u{_t;kt;At;Ft;$t;Tt;Nt;Bt;Lt;Dt;zt;Ct;Ot;Rt;Ut;St;Ht;Xt;Yt;qt;Gt;s;Et;Wt;jt;Vt;rotation;Zt;alpha;Kt;Jt;E=new Int32Array(8);Qt=new l;ti=new c;reset(t,i){this.Kt=1,this.Jt=1,this.Tt=0,this.Bt=0,this.Dt=0,this.St=0,this.Ut=0,this.Yt=0,this.qt=0,this.Ct=0,this.Vt=t,this.Et=t,this.Zt=0,this.At=i}ii(t){let i,s,h;this.$t+this.Tt>-1?(h=t.xt[this.$t+this.Tt],this.s=i=~~(this.Gt*this.Et*h.s/t.si/t.si),this.jt=s=~~(this.Wt*this.Vt*h.jt/t.si/t.si),this._t=this.kt=this.alpha*this.At*h._t/t.hi/t.hi):(i=this.Gt*this.Et/t.si,this.s=i,s=this.Wt*this.Vt/t.si,this.jt=s,this._t=this.kt=this.alpha*this.At/t.hi),this.Nt+this.Bt>-1&&(this.E[0]=this.E[2]=-(this.Ht+this.Yt)*i/t.si,this.E[4]=this.E[6]=i*t.ei.nt[this.Lt+this.Dt].width/t.si+this.E[0],this.E[1]=this.E[7]=-(this.Xt+this.qt)*s/t.si,this.E[3]=this.E[5]=s*t.ei.nt[this.Lt+this.Dt].height/t.si+this.E[1]),h?(this.ti.set(h.ti),this.ti.translate((this.Ot+this.Ut)*h.s/t.si,(this.Rt+this.St)*h.jt/t.si)):this.ti.translate(this.Ut,this.St),this.ti.rotate(360*(this.rotation+this.Zt)/t.ni);for(let t=0;t<8;t+=2)this.ti.transform(this.E[t],this.E[t+1],this.Qt),this.E[t]=this.Qt.x,this.E[t+1]=this.Qt.y}oi(t,i,s,h){this.ti.transform((i-this.Ht-this.Yt)*this.s/t.si,(s-this.Xt-this.qt)*this.jt/t.si,h)}Mt(t,i){switch(t){case 0:return void(this.Tt=i-this.$t);case 1:return void(this.Bt=i-this.Nt);case 2:return void(this.Dt=i-this.Lt);case 3:return void(this.Ct=i-this.zt);case 4:return void(this.Ut=i);case 5:return void(this.St=i);case 6:return void(this.Yt=i);case 7:return void(this.qt=i);case 8:return this.Vt=i,void(this.Et=i);case 9:return void(this.Et=i);case 10:return void(this.Vt=i);case 11:return void(this.Zt=i);case 12:return void(this.At=i);case 13:return void(this.Kt=i?-1:1);case 14:return void(this.Jt=i?-1:1)}}draw(t,i,s,h){if(this.Nt<0||this.Lt<0)return;i.G(this.Ft);const e=this.kt/t.hi;if(!e)return;i.setAlpha(e);const n=t.ei,o=n.nt[this.Dt+this.Lt];i.W(n,this.E[0]+s,this.E[1]+h,this.E[2]+s,this.E[3]+h,this.E[4]+s,this.E[5]+h,this.E[6]+s,this.E[7]+h,o.x,o.y,o.width,o.height)}}class f{a;b;c;d;e;f;g}class d{ei;xt;It;ai;e;si;ni;hi;ri;ci;li(t){return this.ri[t]}ui(t){this.ei=t}fi(t,i){const h=s.h;for(let s=0;s<this.It;s++)this.xt[this.ai[s]].draw(this,h,t,i)}di(t,i,s){let h=i,e=i;for(let s=i-1;s>=0&&3==t[s].rt;s--)h=s;for(let s=i+1;s<t.length&&3==t[e=s].rt;s++);let n=0;for(let i=h;i<=e;i++){let o=4096*t[i].ot;for(let n=h;n<=e;n++)i!=n&&(o*=(s-t[n].frame)/(t[i].frame-t[n].frame));n+=o}return~~(n/4096)}ii(t,i=0){if(!i)for(let t of this.xt)t.reset(this.si,this.hi);if(t)for(let s of t.xt){const t=s.loop,h=s.max,e=s.wt,n=h-e;let o=-1==t?h?(i+s.off)%h:0:i+s.off;if(t>0&&n){if(o>e+t*n){s.yt(this.xt);continue}o<=e||(o=o<e+t*n?e+(o-e)%n:h)}for(let t=0;t<s.ft;++t)if(o==s.dt[t].frame)this.xt[s.lt].Mt(s.ut,s.vt=s.dt[t].ot);else if(t<s.ft-1&&o>s.dt[t].frame&&o<s.dt[t+1].frame){if(s.ut>1){const i=s.dt[t].frame,h=s.dt[t].ot,e=s.dt[t+1].frame,n=s.dt[t+1].ot;let a=(o-i)/(e-i);if(1==s.dt[t].rt||13==s.ut||14==s.ut)a=0;else if(0==s.dt[t].rt);else if(2==s.dt[t].rt)a=s.dt[t].ct>=0?1-Math.sqrt(1-Math.pow(a,s.dt[t].ct)):Math.sqrt(1-Math.pow(1-a,-s.dt[t].ct));else{if(3==s.dt[t].rt){s.vt=this.di(s.dt,t,o),this.xt[s.lt].Mt(s.ut,s.vt);break}4==s.dt[t].rt&&(a=s.dt[t].ct>0?1-Math.cos(a*Math.PI/2):s.dt[t].ct<0?Math.sin(a*Math.PI/2):(1-Math.cos(a*Math.PI))/2)}2==s.ut?s.vt=n-h<0?Math.ceil((n-h)*a+h):(n-h)*a+h:s.vt=(n-h)*a+h,this.xt[s.lt].Mt(s.ut,s.vt=~~s.vt);break}0==s.ut&&this.xt[s.lt].Mt(0,s.dt[t].ot)}s.ft&&o>s.max&&s.yt(this.xt)}for(let t of this.xt)t.ii(this);for(let t=0;t<this.It;t++)this.ai[t]=t,this.e[t]=this.xt[t].zt+this.xt[t].Ct;for(let t=1;t<this.It;t++){let i=this.ai[t],s=this.e[t],h=t-1;for(;h>=0&&this.e[h]>s;)this.ai[h+1]=this.ai[h],this.e[h+1]=this.e[h],h--;this.ai[h+1]=i,this.e[h+1]=s}}load(t){let i=new e;this.reset(),i.it(t),i.ht(),i.et(),i.et(),this.It=i.tt(0),this.xt=new Array(this.It),this.ai=new Int32Array(this.It),this.e=new Int32Array(this.It);for(let t=0;t<this.It;t++)i.et(),this.xt[t]=new u,this.xt[t].$t=i.tt(0),this.xt[t].Nt=i.tt(1),this.xt[t].Lt=i.tt(2),this.xt[t].zt=i.tt(3),this.xt[t].Ot=i.tt(4),this.xt[t].Rt=i.tt(5),this.xt[t].Ht=i.tt(6),this.xt[t].Xt=i.tt(7),this.xt[t].Gt=i.tt(8),this.xt[t].Wt=i.tt(9),this.xt[t].rotation=i.tt(10),this.xt[t].alpha=i.tt(11),this.xt[t].Ft=i.tt(12);i.et(),this.si=i.tt(0),this.ni=i.tt(1),this.hi=i.tt(2),i.et(),this.ci=i.tt(0),this.ri=new Array(this.ci);for(let t=0;t<this.ci;t++)i.et(),this.ri[t]=new f,this.ri[t].b=i.tt(0),this.ri[t].a=this.xt[this.ri[t].b],this.ri[t].c=i.tt(1),this.ri[t].d=i.tt(2),this.ri[t].e=i.tt(3),this.ri[t].f=i.tt(4),this.ri[t].g=i.tt(5);i.close()}mi(){return this.xt[0]}wi(){return this.si}reset(){this.xt=void 0,this.ai=void 0,this.e=void 0,this.ri=void 0}}const m=GIF;var w=t.n(m);var p;new class{pi;gi;yi;Mi;xi;Ii;bi;Pi;_i;ki;_;k;Ai;loading;zoom;Fi=!1;$i;Ti;Ni;Bi;stopped=!0;Li=0;Di=0;zi=new Array(4);Ci=new Array(4);Oi=new Array(4);stop=!1;Ri=1e3/30;then=0;loaded=!1;Ui=new l;Si;constructor(){let t=this;function h(){const h=parseInt(t.zoom.value);if(isNaN(h)||h<=0)return;const e=i.h.canvas,n=window.devicePixelRatio||1,o=~~(e.clientWidth*n),a=~~(e.clientHeight*n),r=100/h,c=i.h.l;e.width=o,e.height=a;const l=o*r,u=a*r;i.h.F=l/2,i.h.$=2*u/3,c.uniform1f(i.h.A,a),c.viewport(0,0,o,a),i.h.B(0,l,u,0,-1,1),c.uniformMatrix4fv(i.h.I,!1,i.h.P),i.h.T=r;const f=s.h.X;f[3]=u,f[4]=l,f[6]=l,f[7]=u,t.stopped&&t.Hi()}this.Xi(),this.zoom=document.getElementById("zoom");{const t=window.devicePixelRatio||1;this.zoom.value=(~~Math.min(100,Math.max(50,Math.min(i.h.canvas.clientWidth*t,i.h.canvas.clientHeight*t)/5))).toString()}h(),s.h.K(),window.onresize=h,this.zoom.onchange=h,this.Yi();for(let t=0;t<this.zi.length;++t)this.zi[t]=new n;for(let t=0;t<this.Oi.length;++t)this.Oi[t]=new d;for(let t=0;t<this.Ci.length;++t){const i=this.Ci[t]=new Array(4);for(let t=0;t<4;++t)i[t]=new r}{const t=new URL(location.href).searchParams.get("id");if(t){const i=parseInt(t);isFinite(i)&&i&&(this.xi.value=i.toString())}}function e(s,h){i.h.F+=s,i.h.$+=h,t.stopped&&t.Hi()}this.yi.onclick=function(){t.qi(t.stopped),t.stopped?(t.stop=!1,t.stopped=!1,t.animate(),t.bi.style.display="none"):(t.Ni=NaN,t.stop=!0,t.bi.style.display="block")},this.pi.onclick=function(){t.stopped&&(t.Ii.value=(++t.Bi).toString(),t.Hi())},this.gi.onclick=function(){t.stopped&&(t.Bi=Math.max(t.Bi-1,0),t.Ii.value=t.Bi.toString(),t.Hi())},this.Ii.oninput=function(){t.stopped&&(t.Bi=parseInt(t.Ii.value),t.Hi())},this.Mi.oninput=function(){t.Bi=0,t.Hi(),t.Li=t.Mi?.selectedIndex,t.Ii.max=t.Ci[t.Di][t.Li].bt.toString()},this.Pi.onclick=function(){const e=s.h;e.Y(),t.Hi(),e.q();const n=new OffscreenCanvas(Math.max(e.C-e.D,100),Math.max(e.O-e.R,100));t.Gi(n);const o=n.getContext("2d");e.U=e.D,e.S=e.R,t.Hi(!0),o.drawImage(i.h.l.canvas,0,0),n.convertToBlob({type:"image/png",quality:1}).then((function(i){const s=document.createElement("a"),h=window.URL.createObjectURL(i);s.href=h,s.download=`Cat No.${t.Ni}.png`,s.click()})),e.U=e.S=0,h()},this._i.onclick=function(){t.stop=!0,t.Bi=0;const e=i.h.l;let n=prompt("每禎延遲(毫秒)\n延遲 = 1000 / 禎率 = 1000 / 30 = 33.33...","33");if(!n)return;if(n=parseInt(n),!isFinite(n)||n<=0)return;let o=prompt("開始禎","0");if(!o)return;o=parseInt(o);const a=t.Ci[t.Di][t.Li].bt;if(!isFinite(o)||o<0||o>a)return;let r=prompt("結束禎",a.toString());if(!r)return;if(r=parseInt(r),!isFinite(r)||o>r)return;let c=prompt("畫質(像素採樣間隔，越低品質越好，最低1)","10");if(!c)return;if(c=parseInt(c),!isFinite(c)||c<=0)return;const l=s.h;l.Y();for(let i=o;i<=r;++i)t.Hi(!0),t.Bi=i;l.q();const u=new OffscreenCanvas(Math.max(l.C-l.D,100),Math.max(l.O-l.R,100));t.Gi(u);const f=u.getContext("2d",{Ei:!0});l.U=l.D,l.S=l.R;const d=new(w())({quality:c,width:u.width,height:u.height});for(let i=o;i<=r;++i)t.Hi(!0),t.Bi=i,f.drawImage(e.canvas,0,0),d.frames.push({data:f.getImageData(0,0,u.width,u.height).data,delay:n,Wi:!1,dispose:-1});l.U=l.S=0;let m=t.Ii?.max;t.Ii.value="0",d.on("progress",(function(i){t.Ii.value=(~~(1e3*i)).toString()})),d.on("finished",(function(i){const s=document.createElement("a"),h=window.URL.createObjectURL(i);s.href=h,s.download="animation.gif",s.click(),t.Ii.value=m})),d.render(),h()},document.getElementById("fps").oninput=function(i){const s=i.currentTarget;t.Ri=1e3/parseInt(s.value)},t._=document.getElementById("color1"),t.k=document.getElementById("color2"),t._.oninput=t.k.oninput=function(s){const h=t._.value,e=t.k.value,n=[parseInt(h.substring(1,3),16),parseInt(h.substring(3,5),16),parseInt(h.substring(5,7),16)],o=[parseInt(e.substring(1,3),16)-n[0],parseInt(e.substring(3,5),16)-n[1],parseInt(e.substring(5,7),16)-n[2]],a=i.h.l;a.uniform3f(i.h._,n[0]/255,n[1]/255,n[2]/255),a.uniform3f(i.h.k,o[0]/255,o[1]/255,o[2]/255),t.stopped&&t.Hi()},this.Si=this.animate.bind(this),document.getElementById("settings").onclick=document.getElementById("share").onclick=function(t){if(t.stopPropagation(),p&&!(t.target instanceof HTMLInputElement))return p.style.display="none",void(p=null);(p=t.currentTarget.firstElementChild.nextElementSibling).style.display="block"},document.getElementById("nextu").onclick=async function(i){i.stopPropagation();let s=parseInt(t.xi.value);s+=1,t.xi.value=s.toString(),t.Ni=NaN,t.stop=!0;const h=new URL(location.href);h.searchParams.set("id",s.toString()),history.pushState({},"",h),await t.ji(s),t.Bi=0,t.Hi(),t.Bi=0,t.bi.style.display="block"},document.getElementById("prevu").onclick=async function(i){i.stopPropagation();let s=parseInt(t.xi.value);s-=1,t.xi.value=s.toString(),t.Ni=NaN,t.stop=!0;const h=new URL(location.href);h.searchParams.set("id",s.toString()),history.pushState({},"",h),await t.ji(s),t.Bi=0,t.Hi(),t.Bi=0,t.bi.style.display="block"},window.onkeydown=function(i){switch(i.keyCode){case 80:case 32:t.yi.onclick();break;case 68:case 39:e(4,0);break;case 65:case 37:e(-4,0);break;case 87:case 38:e(0,-4);break;case 83:case 40:e(0,4);break;case 78:t.pi.onclick();break;case 66:t.gi.onclick()}};for(let i of this.ki.children)i.onclick=function(i){const s=i.currentTarget;t.Di=parseInt(s.getAttribute("data-i"));for(let i of t.ki?.children)i.className=i==s?"active":"";t.Ii.max=t.Ci[t.Di][t.Li].bt.toString(),t.Ii.value="0",t.Bi=0,t.stopped&&t.Hi()};i.h.canvas.addEventListener("mousedown",(function(i){t.Fi=!0})),i.h.canvas.addEventListener("mouseup",(function(i){t.Fi=!1})),i.h.canvas.addEventListener("mousemove",(function(h){if(h.preventDefault(),h.stopPropagation(),t.Fi&&(i.h.F+=h.movementX,i.h.$+=h.movementY,t.stopped)){s.h.K();t.Oi[t.Di].fi(i.h.F-t.Ui.x,i.h.$-t.Ui.y)}})),i.h.canvas.addEventListener("touchstart",(function(i){t.$i=i.touches[0].clientX,t.Ti=i.touches[0].clientY,i.preventDefault(),"block"==t.bi.style.display&&(t.bi.style.display="none",t.yi.onclick())})),i.h.canvas.addEventListener("touchmove",(function(h){h.preventDefault();const{clientX:e,clientY:n}=h.changedTouches[0];if(i.h.F+=e-t.$i,i.h.$+=n-t.Ti,t.$i=e,t.Ti=n,t.stopped){s.h.K();t.Oi[t.Di].fi(i.h.F-t.Ui.x,i.h.$-t.Ui.y)}})),this.bi.addEventListener("click",(function(){t.bi.style.display="none",t.yi.onclick()})),i.h.canvas.addEventListener("click",(function(){if(p)return p.style.display="none",void(p=null);"block"==t.bi.style.display&&(t.bi.style.display="none",t.yi.onclick())})),this.xi.onchange=this.Vi.bind(this),addEventListener("wheel",(function(i){const s=Math.sign(i.deltaY);t.zoom.value=s>0?(parseInt(t.zoom.value)-5).toString():(parseInt(t.zoom.value)+5).toString(),t.zoom.onchange()})),this.Vi()}qi(t){const i=this.yi.firstElementChild,s=i.nextElementSibling;t?(s.style.display="none",i.style.display="block"):(s.style.display="block",i.style.display="none")}Xi(){const t=i.h;if(t.canvas=document.getElementById("canvas"),!(t.l=t.canvas.getContext("webgl2")||t.canvas.getContext("webgl")||t.canvas.getContext("experimental-webgl")))throw alert("您的瀏覽器不支援 WebGL"),"";const h=t.l;function e(t,i){const s=h.createShader(t);if(h.shaderSource(s,i),h.compileShader(s),!h.getShaderParameter(s,h.COMPILE_STATUS)){const t=h.getShaderInfoLog(s);throw alert(t),t}return s}const n=h.createProgram();h.attachShader(n,e(h.VERTEX_SHADER,"\nattribute vec2 vertexPosition;\nattribute vec2 texturePosition;\n\nuniform mat4 u_matrix;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n    gl_Position = u_matrix * vec4(vertexPosition, 0.0, 1.0);\n    vTexturePosition = texturePosition;\n}")),h.attachShader(n,e(h.FRAGMENT_SHADER,"\nprecision mediump float;\n\nuniform sampler2D sampler;\nuniform float v_alpha;\nuniform int mode;\nuniform float canvasH;\nuniform vec3 color1;\nuniform vec3 color2;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n    if (mode == 3) {\n        float frac = gl_FragCoord.y / canvasH;\n        if (frac > 0.5)\n            frac = 1.0 - frac;\n        gl_FragColor = vec4(color1 + (color2 * frac), 1.0);\n    } else {\n        vec4 c = texture2D(sampler, vTexturePosition);\n        c.xyz *= (v_alpha * c.a);\n        if (mode == 1) {\n            c.a*=v_alpha;\n            c.xyz*=v_alpha;\n        } else {\n            c.a*=v_alpha;\n            c.xyz=1.0-c.a+c.xyz*c.a;\n        }\n        gl_FragColor = c;\n    }\n}")),h.linkProgram(n),h.useProgram(n),t.o=n,t.position=h.getAttribLocation(n,"vertexPosition"),t.m=h.getAttribLocation(n,"texturePosition"),t.M=h.getUniformLocation(n,"mode"),t.I=h.getUniformLocation(n,"u_matrix"),t.u=h.createBuffer(),t.p=h.createBuffer(),t.v=h.getUniformLocation(n,"v_alpha"),t.A=h.getUniformLocation(n,"canvasH"),t._=h.getUniformLocation(n,"color1"),t.k=h.getUniformLocation(n,"color2"),h.bindBuffer(h.ARRAY_BUFFER,t.u),h.vertexAttribPointer(t.position,2,h.FLOAT,!1,0,0),h.enableVertexAttribArray(t.position),h.bindBuffer(h.ARRAY_BUFFER,t.p),h.vertexAttribPointer(t.m,2,h.FLOAT,!1,0,0),h.enableVertexAttribArray(t.m),h.bindBuffer(h.ARRAY_BUFFER,t.p),h.bufferData(h.ARRAY_BUFFER,s.h.H,h.STATIC_DRAW),h.uniform3f(t._,70/255,140/255,160/255),h.uniform3f(t.k,45/255,90/255,90/255),h.clearColor(1,1,1,1),h.enable(h.BLEND)}Yi(){this.bi=document.getElementById("start-play"),this.Mi=document.getElementById("animtype"),this.pi=document.getElementById("next"),this.gi=document.getElementById("prev"),this.yi=document.getElementById("pause"),this.xi=document.getElementById("unitid"),this.Ii=document.getElementById("range"),this.Pi=document.getElementById("downloadImg"),this._i=document.getElementById("downloadV"),this.ki=document.getElementById("icons"),this.Ai=document.getElementById("nframe"),this.loading=document.getElementById("loading")}Hi(t=!1){if(!this.loaded)return;const h=this.Oi[this.Di],e=this.Ci[this.Di][this.Li];this.Bi>e.bt&&(this.Bi=0),this.Ai.textContent=this.Bi.toString(),h.ii(e,this.Bi);const n=h.li(0);n.a.oi(h,n.d,n.e,this.Ui),t?i.h.l.clear(i.h.l.COLOR_BUFFER_BIT):s.h.K(),h.fi(i.h.F-this.Ui.x,i.h.$-this.Ui.y)}Gi(t){const s=i.h.canvas;s.width=t.width,s.height=t.height,i.h.l.viewport(0,0,s.width,s.height);window.devicePixelRatio;i.h.B(0,s.width,s.height,0,-1,1),i.h.l.uniformMatrix4fv(i.h.I,!1,i.h.P),i.h.T=1}async Vi(){let t=parseInt(this.xi.value);if(!isFinite(t))return;this.Ni=NaN,this.stop=!0;const i=new URL(location.href);i.searchParams.set("id",t.toString()),i.href!=location.href&&history.pushState({},"",i),await this.ji(t),this.Bi=0,this.Hi(),this.Bi=0,this.bi.style.display="block"}animate(t){if(null!=t&&(this.Ii.value=this.Bi.toString()),this.stop){if(isNaN(this.Ni)){this.stopped=!0;let t=parseInt(this.xi.value);if(!isFinite(t))return;this.Ni=t}else this.stop=!1,this.Bi=0,this.stopped=!1,this.animate();return}requestAnimationFrame(this.Si);const i=performance.now(),s=i-this.then;s>this.Ri&&(this.then=i-s%this.Ri,this.Hi(),++this.Bi)}async ji(t){if(this.Di=0,this.loaded=!1,this.loading.style.display="block",t<0){-0==(t=-(t+1))&&(t=0);let i=await fetch(`img/e/${t}/a`);if(!i.ok)throw"";let s=await i.json();await this.zi[0].load(`/img/e/${t}/c.png`,s[0]),this.Oi[0].ui(this.zi[0]),this.Oi[0].load(s[1]);for(let t=0;t<4;++t)this.Ci[0][t].load(s[t+2]);this.Ii.max=this.Ci[0][this.Li].bt.toString();const h=this.ki?.children;return h[0].style.display="none",h[1].style.display="none",h[2].style.display="none",this.loading.style.display="none",void(this.loaded=!0)}const i=eggs[t];let s=0;const h=this.ki?.children;for(const t of h)t.style.display="none";if(null!=i){for(const t of i){let i=await fetch(`/img/s/${t}/a`);if(!i.ok)throw"";let e=await i.json();await this.zi[s].load(`/img/s/${t}/c.png`,e[0]),this.Oi[s].ui(this.zi[s]),this.Oi[s].load(e[1]);for(let t=0;t<4;++t)this.Ci[s][t].load(e[t+2]);const n=h[s];n.style.display="block",n.src=`/img/s/${t}/${s}.png`,s+=1}try{let i=await fetch(`/img/u/${t}/a`),e=await i.json();await this.zi[2].load(`/img/u/${t}/c2.png`,e[0][0]),this.Oi[2].ui(this.zi[2]),this.Oi[2].load(e[0][1]);for(let t=0;t<4;++t)this.Ci[2][t].load(e[0][t+2]);const n=h[2];n.style.display="block",n.src=`/img/u/${t}/2.png`,n.className=s?"":"active"}catch(t){console.error(t)}}else{let i=await fetch(`/img/u/${t}/a`);if(!i.ok)throw"";let e=await i.json();for(const i of e){const e=h[s];e.style.display="block",e.src=`/img/u/${t}/${s}.png`,e.className=s?"":"active",await this.zi[s].load(`/img/u/${t}/c${s}.png`,i[0]),this.Oi[s].ui(this.zi[s]),this.Oi[s].load(i[1]);for(let t=0;t<4;++t)this.Ci[s][t].load(i[t+2]);s+=1}}this.Ii.max=this.Ci[0][this.Li].bt.toString(),this.loading.style.display="none",this.loaded=!0}}})();