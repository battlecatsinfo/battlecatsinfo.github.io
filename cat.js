var rwMap,tfMap,def_lv,plus_lv,my_curve,_info,unit_buy=null,skill_file=null,SkillLevel=null,uints_zip=null,t_unit=null,anim1=null,anim2=null,_eggs=null,enemy_descs=null;const BC_VER=120603,loader_text=document.getElementById("loader-text"),unit_counts=[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,2,2,3,3,3,3,3,3,3,2,3,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,2,2,3,3,3,3,3,3,3,3,3,3,2,2,3,3,3,3,3,2,3,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,3,3,3,3,2,2,2,2,2,2,3,3,3,3,3,3,3,2,2,3,2,3,3,2,2,3,2,3,2,3,3,2,2,3,2,2,3,3,3,3,3,3,2,3,2,3,2,2,2,2,2,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,2,2,2,2,2,2,2,2,3,3,3,3,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,3,3,2,3,3,3,3,2,2,3,2,2,2,2,2,3,3,3,2,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3,2,3,2,3,3,3,3,3,2,3,3,3,3,3,2,3,2,2,3,3,2,3,3,3,3,2,2,2,3,3,3,3,2,3,3,3,3,3,1,3,3,2,2,3,3,2,3,2,2,2,3,3,3,2,3,2,3,3,3,3,3,3,2,2,2,2,2,2,3,3,2,2,2,2,2,3,3,2,3,2,2,3,3,2,3,2,2,2,2,3,3,3,3,3,3,3,3,2,2,2,3,3,2,2,3,2,2,2,3,3,2,2,3,3,2,2,3,2,2,2,2,2,2,2,2,3,3,2,2,2,3,2,2,2,2,3,3,2,3,2,2,3,3,3,3,3,3,2,2,3,2,3,2,2,2,3,2,2,2,2,2,3,2,3,2,2,3,3,3,2,2,2,3,3,2,2,2,2,3,2,2,3,2,2,2,2,2,3,2,2,2,3,2,2,3,3,2,2,2,2,2,3,2,2,3,3,2,2,2,2,3,2,2,2,2,2,2,2,3,2,3,3,3,2,3,2,2,2,2,2,3,3,3,3,2,2,2,2,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,3,3,3,3,3,2,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,2,2,3,2,2,2,2,3,3,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,2,2,3,3,2,2,3,3,3,3,3,2,2,2,3,2,2,2,2,2,3,3,3,3,2,2,2,2,2,2,2,3,3,3,2,2,2,2,2,2,2,2,3,2,2,3,2,3,3,2,2,2,3,3,3,2,2,2,3,3,2,2,1,2,3,3,2,2,2,2,2,2,2,2,3,2,2,2,2,2,3,2,2,2,2,2,3,2,2,3,2,2,2,2,2,3,3,2,2,2,2,2,3,2,2,3,3,2,2,3],environment={ATK:300,DEF:300},catfruits={30:"紫色貓薄荷種子",31:"紅色貓薄荷種子",32:"藍色貓薄荷種子",33:"綠色貓薄荷種子",34:"黃色貓薄荷種子",35:"紫色貓薄荷果實",36:"紅色貓薄荷果實",37:"藍色貓薄荷果實",38:"綠色貓薄荷果實",39:"黃色貓薄荷種子",40:"彩虹貓薄荷果實",41:"古代貓薄荷種子",42:"古代貓薄荷果實",43:"彩虹貓薄荷種子",44:"黃金貓薄荷果實",160:"惡貓薄荷種子",161:"惡貓薄荷果實",164:"黃金貓薄荷種子",167:"紫獸石",168:"紅獸石",169:"蒼獸石",170:"翠獸石",171:"黃獸石",179:"紫獸石結晶",180:"紅獸石結晶",181:"蒼獸石結晶",182:"翠獸石結晶",183:"黃獸石結晶",184:"虹獸石"},C_ATK=0,C_DEF=1,C_SPE=2,C_C_INI=3,C_M_LV=4,C_M_INI=5,C_C_ATK=6,C_C_SPE=7,C_M_INC=8,C_M_MAX=9,C_BASE=10,C_RESP=11,C_MEAR=12,C_XP=13,C_GOOD=14,C_MASSIVE=15,C_RESIST=16,C_KB=17,C_SLOW=18,C_STOP=19,C_WEAK=20,C_STRONG=21,C_WKILL=22,C_EKILL=23,C_CRIT=24,C_TOT=25,combo_f=["角色攻擊力+$%","角色體力+$%","跑速+$%","貓砲初期能量+$格","工作狂貓初期等級+$","初期持有金錢+$元","貓砲攻擊力+$%","貓砲冷卻-$f","工作狂貓工作效率+$%","錢包上限+$%","城堡體力+$%","研究力-$f","打倒敵人獲得金錢+$%","通關xp+$%","善於攻擊效果+$%","超大傷害效果+$%","很耐打效果+$%","擊退距離上升+$%","緩速效果時間+$%","暫停效果時間+$%","降攻效果時間+$%","降血增攻幅度+$%","終結魔女","終結使徒","會心一擊機率+$%"],combo_params=[[10,15,20,30,-20],[10,20,30,50,-20],[10,15,20,30,-20],[20,40,60,100,0],[1,2,3,4,0],[300,500,1e3,2e3,0],[20,50,100,200,-50],[150,300,450,600,-20],[10,20,30,50,-20],[10,20,30,50,-20],[20,50,100,200,-90],[26.4,52.8,79.2,105.6,-20],[10,20,30,50,-20],[10,15,20,30,-90],[10,20,30,50,-20],[10,20,30,50,-20],[10,20,30,50,-20],[10,20,30,50,-20],[10,20,30,50,-20],[10,20,30,50,-20],[10,20,30,50,-20],[20,30,50,100,-20],[400,400,400,400,400],[400,400,400,400,400],[1,2,3,4,0]],ATK_SINGLE=1,ATK_RANGE=2,ATK_LD=4,ATK_OMNI=8,ATK_KB_REVENGE=16,TB_RED=1,TB_FLOAT=2,TB_BLACK=4,TB_METAL=8,TB_ANGEL=16,TB_ALIEN=32,TB_ZOMBIE=64,TB_RELIC=128,TB_WHITE=256,TB_EVA=512,TB_WITCH=1024,TB_DEMON=2048,TB_INFN=4096,TB_BEAST=8192,TB_BARON=16384,IMU_WAVE=1,IMU_STOP=2,IMU_SLOW=4,IMU_KB=8,IMU_VOLC=16,IMU_WEAK=32,IMU_WARP=64,IMU_CURSE=128,IMU_POIATK=256,IMU_LAST=IMU_POIATK,AB_STRONG=1,AB_LETHAL=2,AB_ATKBASE=3,AB_CRIT=4,AB_ZKILL=5,AB_CKILL=6,AB_BREAK=7,AB_SHIELDBREAK=8,AB_S=9,AB_BOUNTY=10,AB_METALIC=11,AB_MINIWAVE=12,AB_WAVE=13,AB_MINIVOLC=14,AB_VOLC=15,AB_WAVES=16,AB_BAIL=17,AB_BSTHUNT=18,AB_WKILL=19,AB_EKILL=20,AB_WEAK=21,AB_STOP=22,AB_SLOW=23,AB_ONLY=24,AB_GOOD=25,AB_RESIST=26,AB_RESISTS=27,AB_MASSIVE=28,AB_MASSIVES=29,AB_KB=30,AB_WARP=31,AB_IMUATK=32,AB_CURSE=33,AB_BURROW=34,AB_REVIVE=35,AB_POIATK=36,AB_GLASS=37,AB_SHIELD=38,AB_DSHIELD=39,AB_COUNTER=40,AB_AFTERMATH=41,RES_WEAK=0,RES_STOP=1,RES_SLOW=2,RES_KB=3,RES_WAVE=4,RES_SURGE=5,RES_CURSE=6,RES_TOXIC=7,RES_WARP=8,RES_LAST=RES_WARP,trait_short_names=["紅","浮","黑","鐵","天","星","屍","古","無","使徒","魔女","惡"],trait_no_treasure=TB_DEMON|TB_EVA|TB_WITCH|TB_WHITE|TB_RELIC,trait_treasure=TB_RED|TB_FLOAT|TB_BLACK|TB_ANGEL|TB_ALIEN|TB_ZOMBIE|TB_METAL;function t3str(x){var s=x.toString();switch(s.length){case 2:return"0"+s;case 1:return"00"+s}return s}function numStr(num){return(Math.round(100*(num+Number.EPSILON))/100).toString()}function numStrT(num){return(Math.round(100*(num/30+Number.EPSILON))/100).toString()+"秒"}function combineChances(count,chance){let x=1;for(let i=0;i<count;++i)x*=(100-chance)/100;return 1-x}function getChances(freq,pres,chance,duration){var segments=[];outer:for(let now=0;;now-=freq)for(let i=pres.length-1;0<=i;--i){if(!(0<=now+pres[i]+duration))break outer;var a=now+pres[i],z=Math.min(a+duration,freq);a!=z&&segments.push([Math.max(a,0),z])}var steps=[];let substeps=[];for(let i=0;i<=freq;++i){for(var x of segments)i!=x[0]&&i!=x[1]||(i==x[0]?substeps.push(!0):substeps.push(!1));substeps.length&&(steps.push([i,substeps]),substeps=[])}let cover=0,last=steps[0][0],count=0;for(let x of steps){var s,now=x[0];const substeps=x[1];cover+=combineChances(count,chance)*(now-last)/freq;for(s of substeps)s?++count:--count;last=now}return 100*Math.min(cover,1)}function getCover(p,durationF,attackF){p/=100;durationF/=attackF,attackF=~~durationF,durationF-=attackF;return 100*Math.min(1-durationF*Math.pow(1-p,1+attackF)-(1-durationF)*Math.pow(1-p,attackF),1)}function getCoverUnit(unit,chance,duration){if(unit.hasOwnProperty("trait")&&unit.trait&trait_treasure&&(duration*=1.2),!(unit.pre2+unit.pre1))return getCover(chance,duration,unit.attackF);var pres=[];for(let i=4;1<=i;i>>=1)if(unit.abi&i)switch(i){case 1:pres.push(unit.pre2);break;case 2:pres.push(unit.pre1);break;case 4:pres.push(unit.pre)}return getChances(unit.attackF,pres,chance,duration)}function get_trait_short_names(trait){var s="";let i=0;for(let x=1;x<=TB_DEMON;x<<=1)trait&x&&(s+=trait_short_names[i]),i++;return s}function getTraitNames(trait){if(255==(255&trait))return"所有敵人";if(127==(127&trait))return"有色敵人";let i=0;var idxs=[];for(let x=1;x<=TB_DEMON;x<<=1)trait&x&&idxs.push(i),i++;return 1==idxs.length?["紅色敵人","漂浮敵人","黑色敵人","鋼鐵敵人","天使敵人","異星戰士","不死生物","古代種","無屬性敵人","使徒","魔女","惡魔"][idxs[0]]:get_trait_short_names(trait)+"屬性敵人"}const _curves=[curveData0,curveData1,curveData2,curveData3,curveData4,curveData5];function useCurve(my_id){my_curve=_curves[curveMap[my_id]]}function getLevelMulti(level){var c,multi=.8;let n=0;for(c of my_curve){if(level<=n)break;multi+=Math.min(level-n,10)*(c/100),n+=10}return multi}class Form{constructor(name,jp_name,cat_id,level_count,data){if(data){2==level_count&&(this.data=Int16Array.from(data)),this.id=cat_id,this.lvc=level_count,this.name=name||"",this.jp_name=jp_name||"",this.trait=0,this.ab={},this.res={},this.imu=0,this.price=data[6],this.range=data[5],this.hp=data[0],this.kb=data[1],this.cd=Math.max(2*data[7]-264,60),this.atk=data[3],this.atk1=0|data[59],this.atk2=0|data[60],this.pre=data[13],this.pre1=data[61],this.pre2=data[62],this.tba=2*data[4],this.speed=data[2],this.abi=(data[63]<<2)+(data[64]<<1)+data[65];var time,jp_name=anim2[cat_id][level_count],jp_name=(this.backswing=jp_name[0],this.attackF=jp_name[1],"fcs"[level_count]),cat_id=t3str(cat_id),level_count=_eggs[level_count];if(0<=level_count?(level_count=t3str(level_count),this.icon=`./data/img/m/${level_count}/${level_count}_m.png`):this.icon=`./data/unit/${cat_id}/${jp_name}/uni${cat_id}_${jp_name}00.png`,data[10]&&(this.trait|=TB_RED),data[16]&&(this.trait|=TB_FLOAT),data[17]&&(this.trait|=TB_BLACK),data[18]&&(this.trait|=TB_METAL),data[19]&&(this.trait|=TB_WHITE),data[20]&&(this.trait|=TB_ANGEL),data[21]&&(this.trait|=TB_ALIEN),data[22]&&(this.trait|=TB_ZOMBIE),data[78]&&(this.trait|=TB_RELIC),data[96]&&(this.trait|=TB_DEMON),this.trait){level_count=[getTraitNames(this.trait)];if(data[23]&&(this.ab[AB_GOOD]=level_count),data[24]&&(this.ab[AB_KB]=[data[24],level_count[0]]),data[25]&&(cat_id=data[26],jp_name=getCoverUnit(this,data[25],cat_id),this.ab[AB_STOP]=[data[25],level_count[0],numStrT(cat_id),numStrT(1.2*cat_id),numStr(jp_name)+"%"]),data[27]){cat_id=data[28];let cover=getCoverUnit(this,data[27],cat_id);this.ab[AB_SLOW]=[data[27],level_count[0],numStrT(cat_id),numStrT(1.2*cat_id),numStr(cover)+"%"]}if(data[32]&&(this.ab[AB_ONLY]=level_count),data[37]){jp_name=data[38];let cover=getCoverUnit(this,data[37],jp_name);this.ab[AB_WEAK]=[data[37],level_count[0],data[39],numStrT(jp_name),numStrT(1.2*jp_name),numStr(cover)+"%"]}if(data[29]&&(this.ab[AB_RESIST]=level_count),data[30]&&(this.ab[AB_MASSIVE]=level_count),data[80]&&(this.ab[AB_RESISTS]=level_count),data[81]&&(this.ab[AB_MASSIVES]=level_count),data[92]){cat_id=data[93];let cover=getCoverUnit(this,data[92],cat_id);this.ab[AB_CURSE]=[data[92],level_count[0],numStrT(cat_id),numStrT(1.2*cat_id),numStr(cover)+"%"]}}data[31]&&(this.ab[AB_CRIT]=[data[31]]),data[33]&&(this.ab[AB_BOUNTY]=[]),data[34]&&(this.ab[AB_ATKBASE]=[300]),data[46]&&(this.imu|=IMU_WAVE),data[48]&&(this.imu|=IMU_KB),data[49]&&(this.imu|=IMU_STOP),data[50]&&(this.imu|=IMU_SLOW),data[51]&&(this.imu|=IMU_WEAK),data[75]&&(this.imu|=IMU_WARP),data[79]&&(this.imu|=IMU_CURSE),data[90]&&(this.imu|=IMU_POIATK),data[91]&&(this.imu|=IMU_VOLC),data[41]&&(this.ab[AB_STRONG]=[data[40],data[41]]),data[42]&&(this.ab[AB_LETHAL]=[data[42]]),data[43]&&(this.ab[AB_METALIC]=[]),data[47]&&(this.ab[AB_WAVES]=[]),data[35]&&(data.length<95||1!=data[94]?this.ab[AB_WAVE]=[data[35],data[36]]:this.ab[AB_MINIWAVE]=[data[35],data[36]]),52<=data.length&&(data[52]&&(this.ab[AB_ZKILL]=[]),data[53]&&(this.ab[AB_WKILL]=[]),data[77]&&(this.ab[AB_EKILL]=[]),data[70]&&(this.ab[AB_BREAK]=[data[70]]),data[84],data[85],data[82]&&(this.ab[AB_S]=[data[82],data[83]]),data[84]&&(this.ab[AB_IMUATK]=[data[84],numStrT(data[85])]),data[86]&&(jp_name=data[87]>>2,level_count=data[87]+data[88]>>2,time=20*(cat_id=data[89]),109<=data.length&&1==data[108]?this.ab[AB_MINIVOLC]=[data[86],jp_name,level_count,time,cat_id]:this.ab[AB_VOLC]=[data[86],jp_name,level_count,time,cat_id]),data[95]&&(this.ab[AB_SHIELDBREAK]=[data[95]]),data[97]&&(this.ab[AB_BAIL]=[]),data[98]&&(this.ab[AB_CKILL]=[]),data[105])&&(this.ab[AB_BSTHUNT]=[data[106],data[107]]),this.atkType=data[12]?ATK_RANGE:ATK_SINGLE;var x,atkCount=0==this.atk1?1:0==this.atk2?2:3;this.lds=new Array(atkCount),this.lds[0]=data[44],this.ldr=new Array(atkCount),this.ldr[0]=data[45];for(let i=1;i<atkCount;++i)1==data[99+3*(i-1)]?(this.lds[i]=data[99+3*(i-1)+1],this.ldr[i]=data[99+3*(i-1)+2]):(this.lds[i]=this.lds[0],this.ldr[i]=this.ldr[0]);for(x of this.ldr){if(x<0){this.atkType|=ATK_OMNI;break}if(0<x){this.atkType|=ATK_LD;break}}this.tba+this.pre<this.attackF/2&&(this.atkType|=ATK_KB_REVENGE)}else Object.assign(this,name)}updateTraitNames(){var new_names=getTraitNames(this.trait);this.ab.hasOwnProperty(AB_GOOD)&&(this.ab[AB_GOOD][0]=new_names),this.ab.hasOwnProperty(AB_KB)&&(this.ab[AB_KB][1]=new_names),this.ab.hasOwnProperty(AB_STOP)&&(this.ab[AB_STOP][1]=new_names),this.ab.hasOwnProperty(AB_WEAK)&&(this.ab[AB_WEAK][1]=new_names),this.ab.hasOwnProperty(AB_SLOW)&&(this.ab[AB_SLOW][1]=new_names),this.ab.hasOwnProperty(AB_ONLY)&&(this.ab[AB_ONLY][0]=new_names),this.ab.hasOwnProperty(AB_RESIST)&&(this.ab[AB_RESIST][0]=new_names),this.ab.hasOwnProperty(AB_RESISTS)&&(this.ab[AB_RESISTS][0]=new_names),this.ab.hasOwnProperty(AB_MASSIVE)&&(this.ab[AB_MASSIVE][0]=new_names),this.ab.hasOwnProperty(AB_MASSIVES)&&(this.ab[AB_MASSIVES][0]=new_names),this.ab.hasOwnProperty(AB_CURSE)&&(this.ab[AB_CURSE][1]=new_names)}applyTalent(talent,level){if(level)switch(talent[0]){case 1:if(this.data[37]){var o=this.ab[AB_WEAK];if(o[1]=getTraitNames(this.trait),talent[4]&&talent[4]!=talent[5]){var weak_time=this.data[38]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1),cover=getCoverUnit(this,this.data[37],weak_time);o[3]=numStrT(weak_time),o[4]=numStrT(1.2*weak_time),o[5]=numStr(cover)+"%"}else{const weak_time=this.data[38];var pos=this.data[37]+talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,weak_time);o[0]=pos,o[5]=numStr(cover)+"%"}}else if(talent[4]&&talent[4]!=talent[5]){const weak_time=this.data[38]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1),pos=talent[2];let cover=getCoverUnit(this,pos,weak_time);this.ab[AB_WEAK]=[pos,getTraitNames(this.trait),talent[7],numStrT(weak_time),numStrT(1.2*weak_time),numStr(cover)+"%"]}else{const weak_time=this.data[38],pos=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,weak_time);this.ab[AB_WEAK]=[pos,getTraitNames(this.trait),talent[7],numStrT(weak_time),numStrT(1.2*weak_time),numStr(cover)+"%"]}break;case 2:if(this.data[25]){const o=this.ab[AB_STOP];if(o[1]=getTraitNames(this.trait),talent[4]&&talent[4]!=talent[5]){weak_time=this.data[26]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1);let cover=getCoverUnit(this,this.data[25],weak_time);o[2]=numStrT(weak_time),o[3]=numStrT(1.2*weak_time),o[4]=numStr(cover)+"%"}else{const stop_time=this.data[26],pos=this.data[25]+talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,stop_time);o[0]=pos,o[4]=numStr(cover)+"%"}}else if(talent[4]&&talent[4]!=talent[5]){const stop_time=this.data[26]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1),pos=talent[2];let cover=getCoverUnit(this,pos,stop_time);this.ab[AB_STOP]=[pos,getTraitNames(this.trait),numStrT(stop_time),numStrT(1.2*stop_time),numStr(cover)+"%"]}else{const stop_time=this.data[26],pos=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,stop_time);this.ab[AB_STOP]=[pos,getTraitNames(this.trait),numStrT(stop_time),numStrT(1.2*stop_time),numStr(cover)+"%"]}break;case 3:if(this.data[27]){const o=this.ab[AB_SLOW];if(o[1]=getTraitNames(this.trait),talent[4]&&talent[4]!=talent[5]){pos=this.data[28]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1);let cover=getCoverUnit(this,this.data[27],pos);o[2]=numStrT(pos),o[3]=numStrT(1.2*pos),o[4]=numStr(cover)+"%"}else{const slow_time=this.data[28],pos=this.data[27]+talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,slow_time);o[0]=pos,o[4]=numStr(cover)+"%"}}else if(talent[4]&&talent[4]!=talent[5]){const slow_time=this.data[28]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1),pos=talent[2];let cover=getCoverUnit(this,pos,slow_time);this.ab[AB_SLOW]=[pos,getTraitNames(this.trait),numStrT(slow_time),numStrT(1.2*slow_time),numStr(cover)+"%"]}else{const slow_time=this.data[28],pos=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,slow_time);this.ab[AB_SLOW]=[pos,getTraitNames(this.trait),numStrT(slow_time),numStrT(1.2*slow_time),numStr(cover)+"%"]}break;case 4:this.ab[AB_ONLY]=[getTraitNames(this.trait)];break;case 5:this.ab[AB_GOOD]=[getTraitNames(this.trait)];break;case 6:this.ab[AB_RESIST]=[getTraitNames(this.trait)];break;case 7:this.ab[AB_MASSIVE]=[getTraitNames(this.trait)];break;case 8:this.data[24]?this.ab[AB_KB][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_KB]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1),getTraitNames(this.trait)];break;case 10:this.data[40]?this.ab[AB_STRONG][1]+=talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1):this.ab[AB_STRONG]=[100-talent[2],talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1)];break;case 11:this.data[42]?this.ab[AB_LETHAL][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_LETHAL]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1)];break;case 12:this.ab[AB_ATKBASE]=[];break;case 13:this.data[31]?this.ab[AB_CRIT][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_CRIT]=[talent[2]];break;case 14:this.ab[AB_ZKILL]=[];break;case 15:this.data[70]?this.ab[AB_BREAK]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_BREAK]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1)];break;case 16:this.ab[AB_BOUNTY]=[];break;case 17:this.data[35]?this.ab[AB_WAVE][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_WAVE]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1),talent[4]];break;case 18:this.res[RES_WEAK]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 19:this.res[RES_STOP]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 20:this.res[RES_SLOW]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 21:this.res[RES_KB]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 22:this.res[RES_WAVE]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 23:this.ab[AB_WAVES]=[];case 24:this.res[RES_WARP]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);case 25:this.price=this.price-talent[2]*level;break;case 26:this.cd=Math.max(2*this.data[7]-264-level*talent[2],60);break;case 27:this.speed+=level*talent[2];break;case 29:this.imu|=IMU_CURSE;break;case 30:this.res[RES_CURSE]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 31:this.atkM=1+.01*(talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1));break;case 32:this.hpM=1+.01*(talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1));break;case 33:this.trait|=TB_RED,this.updateTraitNames();break;case 34:this.trait|=TB_FLOAT,this.updateTraitNames();break;case 35:this.trait|=TB_BLACK,this.updateTraitNames();break;case 36:this.trait|=TB_METAL,this.updateTraitNames();break;case 37:this.trait|=TB_ANGEL,this.updateTraitNames();case 38:this.trait|=TB_ALIEN,this.updateTraitNames();break;case 39:this.trait|=TB_ZOMBIE,this.updateTraitNames();break;case 40:this.trait|=TB_RELIC,this.updateTraitNames();break;case 41:this.trait|=TB_WHITE,this.updateTraitNames();break;case 42:this.trait|=TB_WITCH,this.updateTraitNames();break;case 43:this.trait|=TB_EVA,this.updateTraitNames();break;case 44:this.imu|=IMU_WEAK;break;case 45:this.imu|=IMU_STOP;break;case 46:this.imu|=IMU_SLOW;break;case 47:this.imu|=IMU_KB;break;case 48:this.imu|=IMU_WAVE;break;case 49:this.imu|=IMU_WARP;break;case 50:this.data[82]?this.ab[AB_S][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_S]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1),talent[4]];break;case 51:this.data[84]?talent[4]&&talent[4]!=talent[5]?this.ab[AB_IMUATK][1]=numStrT(data[85]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1)):this.ab[AB_IMUATK][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):talent[4]&&talent[4]!=talent[5]?this.ab[AB_IMUATK]=[talent[2],numStrT(talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1))]:this.ab[AB_IMUATK]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1),numStrT(talent[4])];break;case 52:this.res[RES_TOXIC]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 53:this.imu|=IMU_CURSE;break;case 54:this.res[RES_SURGE]=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);break;case 55:this.imu|=IMU_VOLC;break;case 56:this.data[86]?this.ab[AB_VOLC][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):(cover=talent[6]>>2,o=talent[6]+talent[8]>>2,weak_time=talent[4],this.ab[AB_VOLC]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1),cover,o,20*weak_time,weak_time]);break;case 57:this.trait|=TB_DEMON,this.updateTraitNames();break;case 58:this.data[95]?this.ab[AB_SHIELDBREAK][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_SHIELDBREAK]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1)];break;case 59:this.ab[AB_CKILL]=[];break;case 60:if(this.data[92]){const o=this.ab[AB_CURSE];if(talent[4]&&talent[4]!=talent[5]){o[1]=getTraitNames(this.trait);pos=this.data[93]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1);let cover=getCoverUnit(this,this.data[92],pos);o[2]=numStrT(pos),o[3]=numStrT(1.2*pos),o[4]=numStr(cover)+"%"}else{const curse_time=this.data[93],pos=this.data[92]+talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,curse_time);o[0]=pos,o[4]=numStr(cover)+"%"}}else if(talent[4]&&talent[4]!=talent[5]){const curse_time=this.data[93]+talent[4]+(level-1)*(talent[5]-talent[4])/(talent[1]-1),pos=this.data[92];let cover=getCoverUnit(this,pos,curse_time);this.ab[AB_CURSE]=[pos,getTraitNames(this.trait),numStrT(curse_time),numStrT(1.2*curse_time),numStr(cover)+"%"]}else{const curse_time=this.data[93],pos=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);let cover=getCoverUnit(this,pos,curse_time);this.ab[AB_CURSE]=[pos,getTraitNames(this.trait),numStrT(curse_time),numStrT(1.2*curse_time),numStr(cover)+"%"]}break;case 61:this.tba-=this.tba*(talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1))/100,this.attackF=(this.pre2||this.pre1||this.pre)+Math.max(this.backswing,this.tba-1);break;case 62:this.data[94]?this.ab[AB_MINIWAVE][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1):this.ab[AB_MINIWAVE]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1),talent[4]];break;case 63:this.ab[AB_BAIL]=[];break;case 64:this.ab[AB_BSTHUNT]=[5,30];break;case 65:if(this.data[108])this.ab[AB_MINIVOLC][0]+=talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1);else{const des1=talent[6]>>2,des2=talent[6]+talent[8]>>2,lv=talent[4];this.ab[AB_MINIVOLC]=[talent[2]+(level-1)*(talent[3]-talent[2])/(talent[1]-1),des1,des2,20*lv,lv]}break;default:console.assert(!1)}}applyAllTalents(talents){this.res={};for(let i=0;i<112&&talents[i];i+=14)this.applyTalent(talents.subarray(i,i+14),talents[i+1]||1)}applySuperTalents(talents,levels){let j=0;for(let i=0;i<112&&talents[i];i+=14)1==talents[i+13]&&this.applyTalent(talents.subarray(i,i+14),levels[j++])}applyTalents(talents,levels){let _super=!(this.res={}),j=0;for(let i=0;i<112&&talents[i];i+=14)1==talents[i+13]?_super=!0:this.applyTalent(talents.subarray(i,i+14),levels[j++]);return _super}hasres(r){return this.res&&this.res.hasOwnProperty(r)}hasab(ab){return this.ab.hasOwnProperty(ab)}getid(){return this.id}gettba(){return this.tba}getpre(){return this.pre}getpre1(){return this.pre1}getpre2(){return this.pre2}getTotalLv(){return Math.min(def_lv,_info.maxBase)+Math.min(plus_lv,_info.maxPlus)}getformc(){return this.lvc+1}getkb(){return this.kb}getrarity(){return _info.rarity}gettrait(){return this.trait}getrange(){return this.range}getattackf(){return this.attackF}getattacks(){return this.attackF/30}getrevenge(){return 0!=(this.atkType&ATK_KB_REVENGE)}getbackswing(){return this.backswing}gethp(){return~~(~~(2.5*Math.round(this.hp*getLevelMulti(this.getTotalLv())))*this.hpM)}getatk(){return~~(~~(2.5*Math.round((this.atk+this.atk1+this.atk2)*getLevelMulti(this.getTotalLv())))*this.atkM)}getdps(){return 30*this.getatk()/this.attackF}getthp(){let hp=this.gethp();return this.ab.hasOwnProperty(AB_EKILL)?5*hp:this.ab.hasOwnProperty(AB_WKILL)?10*hp:(this.ab.hasOwnProperty(AB_RESIST)?hp*=this.trait&trait_treasure?5:4:this.ab.hasOwnProperty(AB_RESISTS)&&(hp*=this.trait&trait_treasure?7:6),this.ab.hasOwnProperty(AB_GOOD)&&(hp*=this.trait&trait_treasure?2.5:2),this.ab.hasOwnProperty(AB_BSTHUNT)&&(hp/=.6),this.ab.hasOwnProperty(AB_BAIL)&&(hp/=.7),hp)}getwavelv(){return this.ab.hasOwnProperty(AB_WAVE)?this.ab[AB_WAVE][1]:0}getvolclv(){return this.ab.hasOwnProperty(AB_VOLC)?this.ab[AB_VOLC][4]:0}getcrit(){return this.ab.hasOwnProperty(AB_CRIT)?this.ab[AB_CRIT][0]:0}hpagainst(traits){let hp=this.gethp();var t=this.trait&traits;return traits&TB_EVA&&this.ab.hasOwnProperty(AB_EKILL)&&(hp*=5),traits&TB_WITCH&&this.ab.hasOwnProperty(AB_WKILL)?10*hp:(t&&(this.ab.hasOwnProperty(AB_RESIST)?hp*=t&trait_treasure?5:4:this.ab.hasOwnProperty(AB_RESISTS)&&(hp*=t&trait_treasure?7:6),this.ab.hasOwnProperty(AB_GOOD))&&(hp*=t&trait_treasure?2.5:2),traits&TB_BEAST&&this.ab.hasOwnProperty(AB_BSTHUNT)&&(hp/=.6),traits&TB_BARON&&this.ab.hasOwnProperty(AB_BAIL)&&(hp/=.7),hp)}dpsagainst(traits){if(traits&TB_METAL){if(this.ab.hasOwnProperty(AB_CRIT)){var rate=.01*this.ab[AB_CRIT][0];let atk=this.getatk();return this.ab.hasOwnProperty(AB_S)&&(atk*=this.ab[AB_S][1]/100),this.ab.hasOwnProperty(AB_STRONG)&&(atk*=1+this.ab[AB_STRONG][1]/100),this.ab.hasOwnProperty(AB_MASSIVE)?atk*=4:this.ab.hasOwnProperty(AB_MASSIVES)&&(atk*=6),this.ab.hasOwnProperty(AB_GOOD)&&(atk*=1.8),30*(1-rate+(atk+=atk)*rate)/this.attackF}return 30/this.attackF}let dps=this.getdps();this.ab.hasOwnProperty(AB_S)&&(rate=this.ab[AB_S],dps+=dps*(rate[0]*rate[1]/1e4)),this.ab.hasOwnProperty(AB_CRIT)&&(dps+=dps*(this.ab[AB_CRIT][0]/100)),this.ab.hasOwnProperty(AB_STRONG)&&(dps*=1+this.ab[AB_STRONG][1]/100);rate=this.trait&traits;return rate&&(this.ab.hasOwnProperty(AB_MASSIVE)?dps*=rate&trait_treasure?4:3:this.ab.hasOwnProperty(AB_MASSIVES)&&(dps*=rate&trait_treasure?6:5),this.ab.hasOwnProperty(AB_GOOD))&&(dps*=rate&trait_treasure?1.8:1.5),traits&TB_BEAST&&this.ab.hasOwnProperty(AB_BSTHUNT)&&(dps*=2.5),traits&TB_BARON&&this.ab.hasOwnProperty(AB_BAIL)&&(dps*=1.6),traits&TB_EVA&&this.ab.hasOwnProperty(AB_EKILL)&&(dps*=5),traits&TB_WITCH&&this.ab.hasOwnProperty(AB_WKILL)&&(dps*=5),dps}gettdps(){let dps=this.getdps();if(this.ab.hasOwnProperty(AB_ATKBASE))return 4*dps;if(this.ab.hasOwnProperty(AB_S)&&(s=this.ab[AB_S],dps*=1+s[0]*s[1]/1e4),this.ab.hasOwnProperty(AB_VOLC)){var s=this.ab[AB_VOLC];dps*=1+s[4]*s[0]/100}else if(this.ab.hasOwnProperty(AB_MINIVOLC)){const x=this.ab[AB_MINIVOLC];dps*=1+x[4]*x[0]/500}return this.ab.hasOwnProperty(AB_WAVE)?dps*=1+this.ab[AB_WAVE][0]/100:this.ab.hasOwnProperty(AB_MINIWAVE)&&(dps*=1+this.ab[AB_MINIWAVE][0]/500),this.ab.hasOwnProperty(AB_CRIT)&&(dps+=dps*(this.ab[AB_CRIT][0]/100)),this.ab.hasOwnProperty(AB_EKILL)||this.ab.hasOwnProperty(AB_WKILL)?5*dps:(this.ab.hasOwnProperty(AB_STRONG)&&(dps*=1+this.ab[AB_STRONG][1]/100),this.ab.hasOwnProperty(AB_MASSIVE)?dps*=this.trait&trait_treasure?4:3:this.ab.hasOwnProperty(AB_MASSIVES)&&(dps*=this.trait&trait_treasure?6:5),this.ab.hasOwnProperty(AB_GOOD)&&(dps*=this.trait&trait_treasure?1.8:1.5),this.ab.hasOwnProperty(AB_BSTHUNT)&&(dps*=2.5),this.ab.hasOwnProperty(AB_BAIL)&&(dps*=1.6),dps)}gettatk(){let atk=this.getatk();if(this.ab.hasOwnProperty(AB_ATKBASE))return 4*atk;if(this.ab.hasOwnProperty(AB_VOLC)){var x=this.ab[AB_VOLC];atk*=1+x[4]}else if(this.ab.hasOwnProperty(AB_MINIVOLC)){const x=this.ab[AB_MINIVOLC];atk*=1+.2*x[4]}return this.ab.hasOwnProperty(AB_WAVE)?atk+=atk:this.ab.hasOwnProperty(AB_MINIWAVE)&&(atk*=1.2),this.ab.hasOwnProperty(AB_S)&&(atk*=1+this.ab[AB_S][1]/100),this.ab.hasOwnProperty(AB_CRIT)&&(atk+=atk),this.ab.hasOwnProperty(AB_EKILL)||this.ab.hasOwnProperty(AB_WKILL)?5*atk:(this.ab.hasOwnProperty(AB_STRONG)&&(atk*=1+this.ab[AB_STRONG][1]/100),this.ab.hasOwnProperty(AB_MASSIVE)?atk*=this.trait&trait_treasure?4:3:this.ab.hasOwnProperty(AB_MASSIVES)&&(atk*=this.trait&trait_treasure?6:5),this.ab.hasOwnProperty(AB_GOOD)&&(atk*=this.trait&trait_treasure?1.8:1.5),this.ab.hasOwnProperty(AB_BSTHUNT)&&(atk*=2.5),this.ab.hasOwnProperty(AB_BAIL)&&(atk*=1.6),atk)}getspeed(){return this.speed}getprice(){return 1.5*this.price}getcost(){return 1.5*this.price}getcd(){return this.cd/30}getimu(){return this.imu}getatktype(){return this.atkType}}class CatInfo{constructor(id){id instanceof Object?Object.assign(this,id):(this.loadTalents(id),this.loadAttitional(id))}getRarityString(cat_id){return["基本","EX","稀有","激稀有","超激稀有","傳說稀有"][this.rarity]}loadAttitional(my_id){for(var end,text=unit_buy,i=0,start=0;i<my_id;){for(var j=start;"\n"!=text[j];++j);start=j+1,++i}for(end=start;"\n"!=text[end];++end);var data=text.slice(start,end).split(",").map(x=>parseInt(x)),version=(data[0]&&(this.unclockS=data[0]),data[1]&&(this.unclockFood=data[1]),rwMap.hasOwnProperty(my_id.toString())&&(this.rw=rwMap[my_id]),tfMap.hasOwnProperty(my_id.toString())&&(this.tf=tfMap[my_id]),this.rarity=data[13],this.maxBase=data[50],this.maxPlus=data[51],data[data.length-6]);if(1e5<=version&&(this.version=version),data[23]&&(this.tfmethod=data[23]),data[27]){this.upReqs=[[data[27],0]];for(let i=28;i<=38;i+=2){var amount=data[i+1];amount&&this.upReqs.push([amount,data[i]])}}this.crazed=5e4<data[3]&&3==data[13],this.xp_data=data.slice(2,12).join(","),_eggs=data.slice(data.length-2)}loadTalents(my_id){my_id=skill_file.indexOf(`
${my_id},`);if(-1!=my_id){++my_id;let end;for(end=my_id;"\n"!=skill_file[end]&&skill_file[end];++end);var data=skill_file.slice(my_id,end).split(",");this.talents=new Int16Array(112);for(let i=0;i<112;++i)this.talents[i]=data[2+i]}}}class Enemy{constructor(id,name,jp_name,data){if(id instanceof Object)Object.assign(this,id);else{this.id=id,id-=2,this.name=name||"",this.jp_name=jp_name||"",this.desc=enemy_descs[id],this.backswing=anim1[id][0],this.attackF=anim1[id][1],this.hp=data[0],this.kb=data[1],this.speed=data[2],this.atk=data[3],this.tba=2*data[4],this.atkType=data[11]?ATK_RANGE:ATK_SINGLE,this.earn=data[6],this.range=data[5],this.trait=0,this.isrange=0!=data[11],this.pre=data[12],this.death=data[54],this.atk1=data[55],this.atk2=data[56],this.pre1=data[57],this.pre2=data[58],this.abi=(data[59]<<2)+(data[60]<<1)+data[61],data[69]&&(this.star=!0),this.ab={},this.imu=0,data[10]&&(this.trait|=TB_RED),data[13]&&(this.trait|=TB_FLOAT),data[14]&&(this.trait|=TB_BLACK),data[15]&&(this.trait|=TB_METAL),data[16]&&(this.trait|=TB_WHITE),data[17]&&(this.trait|=TB_ANGEL),data[18]&&(this.trait|=TB_ALIEN),data[19]&&(this.trait|=TB_ZOMBIE),data[48]&&(this.trait|=TB_WITCH),data[49]&&(this.trait|=TB_INFN),data[71]&&(this.trait|=TB_EVA),data[72]&&(this.trait|=TB_RELIC),data[93]&&(this.trait|=TB_DEMON),data[94]&&(this.trait|=TB_BARON),data[101]&&(this.trait|=TB_BEAST),data[20]&&(this.ab[AB_KB]=[data[20]]),data[29]&&(this.ab[AB_WEAK]=[data[29],data[30],data[31],getCoverUnit(this,data[29],data[30])]),data[21]&&(this.ab[AB_STOP]=[data[21],data[22],getCoverUnit(this,data[21],data[22])]),data[23]&&(this.ab[AB_SLOW]=[data[23],data[24],getCoverUnit(this,data[23],data[24])]),data[73]&&(this.ab[AB_CURSE]=[data[73],data[74],getCoverUnit(this,data[73],data[74])]),data[25]&&(this.ab[AB_CRIT]=[data[25]]),data[26]&&(this.ab[AB_ATKBASE]=[]),data[32]&&(this.ab[AB_STRONG]=[data[32],data[33]]),data[34]&&(this.ab[AB_LETHAL]=[data[34]]),data[38]&&(this.ab[AB_WAVES]=[]),data[43]&&(this.ab[AB_BURROW]=[data[43],data[44]/4]),data[45]&&(this.ab[AB_REVIVE]=[data[45],data[46],data[47]]),2==data[52]&&(this.ab[AB_GLASS]=[]),data[64]&&(this.ab[AB_SHIELD]=[data[64]]),data[65]&&(this.ab[AB_WARP]=[data[65],data[66],data[67]/4]),data[75]&&(this.ab[AB_S]=[data[75],data[76]]),data[77]&&(this.ab[AB_IMUATK]=[data[77],data[78]]),data[79]&&(this.ab[AB_POIATK]=[data[79],data[80]]),data[87]&&(this.ab[AB_DSHIELD]=[data[87],data[88]]),data[89]&&(this.ab[AB_AFTERMATH]=[data[89],data[90]/4,data[91]/4+data[90],20*data[92]]),data[103]&&(this.ab[AB_COUNTER]=[]),data[27]&&(data[86]?this.ab[AB_MINIWAVE]=[data[27],data[28]]:this.ab[AB_WAVE]=[data[27],data[28]]),data[81]&&(data[102]?this.ab[AB_MINIVOLC]=[data[81],data[82]>>2,data[83]+data[82]>>2,data[84]]:this.ab[AB_VOLC]=[data[81],data[82]>>2,data[83]+data[82]>>2,data[84]]),data[37]&&(this.imu|=IMU_WAVE),data[39]&&(this.imu|=IMU_KB),data[40]&&(this.imu|=IMU_STOP),data[41]&&(this.imu|=IMU_SLOW),data[42]&&(this.imu|=IMU_WEAK),data[85]&&(this.imu|=IMU_VOLC);var x,atkCount=0==this.atk1?1:0==this.atk2?2:3;this.lds=new Array(atkCount),this.lds[0]=data[35],this.ldr=new Array(atkCount),this.ldr[0]=data[36];for(let i=1;i<atkCount;++i)1==data[95+3*(i-1)]?(this.lds[i]=data[95+3*(i-1)+1],this.ldr[i]=data[95+3*(i-1)+2]):(this.lds[i]=this.lds[0],this.ldr[i]=this.ldr[0]);for(x of this.ldr){if(x<0){this.atkType|=ATK_OMNI;break}if(0<x){this.atkType|=ATK_LD;break}}this.tba+this.pre<this.attackF/2&&(this.atkType|=ATK_KB_REVENGE)}}gethp(){return this.hp}getthp(){return this.hp}getatk(){return this.atk+this.atk1+this.atk2}gettatk(){return this.getatk()}getdps(){return 30*this.getatk()/this.attackF}gettdps(){return this.getdps()}getimu(){return this.imu}hasab(i){return this.ab.hasOwnProperty(i)}dpsagainst(){return 0}hpagainst(){return 0}getid(){return this.id-2}hasres(){return 0}gettba(){return this.tba}getpre(){return this.pre}getpre1(){return this.pre1}getpre2(){return this.pre2}getTotalLv(){return 0}getkb(){return this.kb}getrarity(){return 0}gettrait(){return this.trait}getrange(){return this.range}getattackf(){return this.attackF}getattacks(){return this.attackF/30}getrevenge(){return 0!=(this.atkType&ATK_KB_REVENGE)}getbackswing(){return this.backswing}getcost(){return this.earn}getprice(){return this.earn}getspeed(){return this.speed}getatktype(){return this.atkType}getcd(){return 0}}class Cat{constructor(id,unit_file){if(id instanceof Object){this.forms=new Array(id.forms.length);for(let i=0;i<id.forms.length;++i)this.forms[i]=new Form(id.forms[i]);this.info=new CatInfo(id.info)}else{this.info=new CatInfo(id);var my_name=unit_names[id]||[],my_name_jp=unit_names_jp[id]||[],unit_levels=unit_counts[id],datas=(this.forms=new Array(unit_levels),unit_file.replace("\r","").split("\n").filter(x=>x.trim()).map(line=>line.split(",").map(x=>parseInt(x))));for(let i=0;i<unit_levels;++i)this.forms[i]=new Form(my_name[i]||"",my_name_jp[i]||"",id,i,datas[i])}}init(){for(var f of this.forms)f.hpM=1,f.atkM=1}getObj(){return{info:this.info,forms:this.forms}}}async function getAllEnemies(){enemy_descs=await(await fetch("./enemyDescs.json")).json(),t_unit=(await(await fetch("./data/data/t_unit.csv")).text()).replace("\r","").split("\n").filter(x=>x.trim()).map(line=>line.split(",").map(x=>parseInt(x))),anim1=await(await fetch("./anim1")).json();var enemies_names=await(await fetch("enemyName.json")).json(),jp_names=await(await fetch("enemyNameJP.json")).json(),enemies=new Array(t_unit.length);for(let id=2;id<enemies.length;++id){var unit_file=t_unit[id],y=id-2;enemies[id]=new Enemy(id,enemies_names[y],jp_names[y],unit_file),loader_text.innerText=`Loading Enemies (${id+1}/${enemies.length})`}return anim1=t_unit=enemy_descs=null,enemies}async function getAllCats(){anim2=await(await fetch("./anim2")).json(),unit_buy=await(await fetch("./data/data/unitbuy.csv")).text(),skill_file=await(await fetch("./data/data/SkillAcquisition.csv")).text(),rwMap=await(await fetch("./rwMap")).json(),tfMap=await(await fetch("./tfMap")).json(),uints_zip=await JSZip.loadAsync(await(await fetch("./all_units.zip")).blob());var cats=new Array(unit_counts.length);try{for(let id=0;id<cats.length;++id){var unit_file=await uints_zip.file("all/"+id).async("string");cats[id]=new Cat(id,unit_file),loader_text.innerText=`Loading Units (${id+1}/${cats.length})`}}catch(e){console.error(e)}return uint_buy=tfMap=rwMap=skill_file=uints_zip=null,cats}function onupgradeneeded(event){event=event.target.result;try{event.deleteObjectStore("cats")}catch(e){}try{event.deleteObjectStore("enemy")}catch(e){}let store=event.createObjectStore("cats",{keyPath:"id"});store.createIndex("data","",{unique:!1}),(store=event.createObjectStore("enemy",{keyPath:"id"})).createIndex("data","",{unique:!1})}async function loadCat(id){return new Promise(resolve=>{var req=indexedDB.open("db",BC_VER);req.onupgradeneeded=onupgradeneeded,req.onsuccess=function(event){const db=event.target.result;db.transaction(["cats"],"readwrite").objectStore("cats").get(id).onsuccess=function(event){var event=event.target.result;if(event)return(event=new Cat(event.data)).init(),resolve(event);getAllCats().then(cats=>{var tx=db.transaction(["cats"],"readwrite"),store=tx.objectStore("cats");for(let i=0;i<cats.length;++i)store.put({id:i,data:cats[i].getObj()});tx.oncomplete=function(){var c=cats[id];c.init(),resolve(c),db.close()}})}}})}async function loadEnemy(id){return new Promise((resolve,reject)=>{var req=indexedDB.open("db",BC_VER);req.onupgradeneeded=onupgradeneeded,req.onsuccess=function(event){const db=event.target.result;db.transaction(["enemy"],"readwrite").objectStore("enemy").get(id).onsuccess=function(event){event=event.target.result;if(event)return event.data?resolve(new Enemy(event.data)):reject();getAllEnemies().then(es=>{var tx=db.transaction(["enemy"],"readwrite"),store=tx.objectStore("enemy");for(let i=0;i<es.length;++i)store.put({id:i,data:es[i]});tx.oncomplete=function(){resolve(es[id]),db.close()}})}}})}async function loadAllEnemies(){return new Promise(resolve=>{var req=indexedDB.open("db",BC_VER);req.onupgradeneeded=onupgradeneeded,req.onsuccess=function(event){const db=event.target.result;db.transaction(["enemy"],"readwrite").objectStore("enemy").get(651).onsuccess=function(event){if(event.target.result){let es=new Array(652);db.transaction(["enemy"],"readwrite").objectStore("enemy").openCursor().onsuccess=function(event){event=event.target.result;event?(event.value.data&&(es[event.value.id]=new Enemy(event.value.data)),event.continue()):(resolve(es),db.close())}}else getAllEnemies().then(es=>{var tx=db.transaction(["enemy"],"readwrite"),store=tx.objectStore("enemy");for(let i=0;i<es.length;++i)store.put({id:i,data:es[i]});tx.oncomplete=function(){resolve(es),db.close()}})}}})}async function loadAllCats(){return new Promise(resolve=>{var req=indexedDB.open("db",BC_VER);req.onupgradeneeded=onupgradeneeded,req.onsuccess=function(event){const db=event.target.result;db.transaction(["cats"],"readwrite").objectStore("cats").get(717).onsuccess=function(event){if(event.target.result){let cats=new Array(unit_names.length);db.transaction(["cats"],"readwrite").objectStore("cats").openCursor().onsuccess=function(event){var c,event=event.target.result;event?((c=new Cat(event.value.data)).init(),cats[event.value.id]=c,event.continue()):(resolve(cats),db.close())}}else getAllCats().then(cats=>{var c,tx=db.transaction(["cats"],"readwrite"),store=tx.objectStore("cats");for(let i=0;i<cats.length;++i)store.put({id:i,data:cats[i].getObj()});for(c of cats)c.init();tx.oncomplete=function(){resolve(cats),db.close()}})}}})}const res_icon_names=["weak","freeze","slow","kb","wave","surge","curse","toxic","warp"],res_descs=["降攻耐性(受到降攻時間減少$%)","暫停耐性(受到暫停時間減少$%)","緩速耐性(受到緩速時間減少$%)","擊退耐性(受到擊退距離減少$%)","波動耐性(受到波動傷害減少$%)","烈波耐性(受到烈波傷害減少$%)","詛咒耐性(受到詛咒時間減少$%)","毒擊耐性(受到毒擊傷害減少$%)","抗傳耐性(??未知的能力??)"];function createResIcons(res,parent){for(let i=1;i<=RES_LAST;++i){var e;res.hasOwnProperty(i)&&((e=document.createElement("span")).classList.add("bc-icon",`bc-icon-res-${res_icon_names[i-1]}2`),parent.appendChild(e),(e=document.createElement("span")).innerText=res_descs[i].replace("$",res[i]),parent.appendChild(e),parent.appendChild(document.createElement("br")))}}const icon_names=["strong","lethal","atkbase","crit","z-kill","ckill","break","shield-break","s","bounty","metalic","mini-wave","wave","mini-volc","volc","waves","bail","bsthunt","wkill","ekill","weak","stop","slow","only","good","resist","resists","massive","massives","kb","warp","imu-atk","curse"],icon_descs=["血量{1}%以下攻擊力增加{2}%","{1}%機率以1血存活一次","善於攻城({1}%倍s傷害)","{1}%機率會心一擊","終結不死\t","靈魂攻擊","{1}%機率打破宇宙盾","{1}%機率打破惡魔盾","{1}%機率渾身一擊(攻擊力增加{2}%)","擊倒敵人獲得兩倍金錢","鋼鐵特性(爆擊、毒擊之外攻擊只會受1傷害)","{1}%機率放出Lv{2}小波動","{1}%機率放出Lv{2}波動","{1}%機率放出Lv{5}小烈波(出現位置{2}~{3}，持續{4}f)","{1}%機率放出Lv{5}烈波(出現位置{2}~{3}，持續{4}f)","波動滅止\t","超生命體特效(傷害1.6倍、受傷害減少30%)","超獸特效(對超獸敵人傷害2.5倍、減傷40%、{1}%攻擊無效{2}f)","終結魔女\t","終結使徒","{1}%機率降低{2}攻擊力至{3}%持續{4}({5}，控場覆蓋率{6})","{1}%機率暫停{2}持續{3}({4}，控場覆蓋率{5})","{1}%機率緩速{2}持續{3}({4}，控場覆蓋率{5})","只能攻擊{1}","對{1}傷害傷害1.5倍(1.8倍)，受到傷害減少50%(60%)","受到{1}攻擊的傷害減至1/4(1/5)","受到{1}攻擊的傷害減至1/6(1/7)","對{1}造成3倍(4倍)傷害","對{1}造成5倍(6倍)傷害","{1}%機率擊退{2}","{1}%機率傳送{2}","{1}%攻擊無效{2}","{1}%機率詛咒{2}持續{3}({4}，控場覆蓋率{5})"];function createAbIcons1(ab,parent){for(let i=1;i<=AB_CURSE;++i)if(i<20&&ab.hasOwnProperty(i)){var e=document.createElement("span"),e=(e.classList.add("bc-icon","bc-icon-"+icon_names[i-1]),parent.appendChild(e),document.createElement("span")),s=icon_descs[i-1],o=ab[i];for(let j=1;j<=o.length;++j)s=s.replace("{"+j.toString()+"}",o[j-1]);e.innerText=s,parent.appendChild(e),parent.appendChild(document.createElement("br"))}}function createAbIcons2(ab,parent){for(let i=1;i<=AB_CURSE;++i)if(20<=i&&ab.hasOwnProperty(i)){var e=document.createElement("span"),e=(e.classList.add("bc-icon","bc-icon-"+icon_names[i-1]),parent.appendChild(e),document.createElement("span")),s=icon_descs[i-1],o=ab[i];for(let j=1;j<=o.length;++j)s=s.replace("{"+j.toString()+"}",o[j-1]);e.innerText=s,parent.appendChild(e),parent.appendChild(document.createElement("br"))}}function createImuIcons(imu,parent){if(imu){var e,names=["波動無效","暫停無效","緩速無效","擊退無效","烈波無效","降攻無效","傳送無效","詛咒無效","毒擊無效"],icon_names=["wave","stop","slow","kb","volc","weak","warp","curse","poiatk"];let i=0;for(let x=1;x<=IMU_LAST;x<<=1)imu&x&&((e=document.createElement("span")).classList.add("bc-icon","bc-icon-imu-"+icon_names[i]),parent.appendChild(e),(e=document.createElement("span")).innerText=names[i],parent.appendChild(e),parent.appendChild(document.createElement("br"))),i++}}function createTraitIcons(trait,parent){if(trait){var e,names=["red","float","black","metal","angel","alien","zombie","relic","white","eva","witch","demon"];let i=0;for(let x=1;x<=TB_DEMON;x<<=1)trait&x&&((e=document.createElement("span")).classList.add("bc-icon","bc-icon-trait-"+names[i]),parent.appendChild(e)),++i;parent.appendChild(document.createElement("br"))}}function getAbiString(abi){var strs;return abi?(strs=[],4&abi&&strs.push("第一擊"),2&abi&&strs.push("第二擊"),1&abi&&strs.push("第三擊"),"，"+strs.join("/")+"附加能力"):""}